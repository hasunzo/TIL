## AWS Regions
- 데이터 센터의 집합
- 한 리전에서 어떤 서비스를 사용하다 다른 리전에서 그 서비스 사용하려고 하면, 서비스를 처음 사용하는 것
- 어떤 리전을 사용해야할까?
  - 상황에 따라 다르지만 몇 가지 요인들이 있다
    - 법률 준수
    - 지연 시간(사용자의 시간에 따라)
    - 모든 리전이 모든 서비스를 갖고 있지 않음
    - 요금 (리전마다 요금이 다름
  
## IAM: Users & Groups
- IAM = Identity and Access Management, Global service
- Root account - default
  - shouldn't be used or shared
- Users
  - your organization and can be grouped
- 사용자와 그룹을 생성하는 이유
  - 사용자 또는 그룹에게 권한을 부여
  - JSON 문서를 통해 관리
  - AWS 에서는 최소 권한 원칙

### MFA: Multi Factor Authentication
- 루트 계정은 보호해야 한다
  - MFA = 비밀번호 + security device
  - 비밀번호가 누출되어도 물리적 장치가 추가로 필요하기 때문에 계정이 침해되지 않음
- MFA 장치
  - Virtual MFA device
    - Google Authenticator 
    - Authy
    - 가상 MFA 장치에 원하는 수 만큼 계정 등록 가능
- Universal 2nd Factor (U2F) Security Key
  - YubiKey
  - 하나의 보안 키에서 여러 루트 계정과 IAM 사용자 지원하기 때문에 하나의 키로도 충분
- Hardware Key Fob MFA Device
  - Provided by Gemalto
- Hardware Key Fob MFA Device for AWS Go`vCloud (US)

### EC2 Spot Instance Requests
- 온디맨드와 비교해 최대 90% 할인
- 어떤 스팟 인스턴스에 지불할 의향이 있는 최고가를 정의 후 지불 의향있는 최고가보다 낮은 한 계속해서 사용
- 정의된 최고가 보다 높아졌을 경우 아래 두가지 중 선택
  - 인스턴스 중단하여 가격이 낮아질때까지 기다렸다가 재시작하는 방법
  - 완전히 종요하는 방법
- 스팟 블록
  - 1 to 6 시간 동안 회수 - 현재는 종료된 서비스

### EC2 배치 그룹
- 클러스터 배치그룹
  - 단일 가용 영역 내에서 지연 시간이 짧은 하드웨어 설정으로 인스턴스를 그룹화
  - 동일한 랙에 배치함.
  - 랙에 실패가 발생하면(하드웨어에 실패) 모든 EC2 인스턴스가 죽음
  - 엄청난 네트워크. 빅데이터 작업시 유용
  - 극히 짧은 지연시간과 높은 네트워크 처리량을 필요로하는 애플리케이션에 유용
  - 높은 대역폭과 짧은 시연시간
- 분산 배치 그룹
  - 인스턴스가 다른 하드웨어에 분산됨
  - 가용 영역별로 분산된 배치 그룹 7개의 EC2 인스턴스만 가질 수 있음
  - 실패위험 최소화
  - 모든 EC2 인스턴스가 다른 하드웨어에 위치
  - 여러 가용 영역에 걸쳐 있고 동시 실패 위험이 줄어듦
  - 가용성을 극대화하고 위험을 줄여야 하는 애플리케이션
  - 오류를 서로 격리해야하는 크리티컬 애플리케이션
- 분할 배치 그룹
  - 여러 파티션에 인스턴스가 분할
  - 가용 영역 내의 다양한 하드웨어 랙 세트에 의존
  - 가용 영역당 최대 7개의 파티션이 가능
  - 각 파티션에는 많은 EC2 인스턴스가 있을 수 있다
  - 각 파티션은 AWS의 랙을 의미
  - 여러 하드웨어 랙에 분산되어 랙 실패로부터 안전
  - 파티션들 전반에 걸쳐 데이터와 서버를 퍼트려 두도록 파티션 인식 가능한 애플리케이션
  - HDFS, HBase, Cassandra, Kafka

### ENI (Elastic Network Interfaces)
- 탄력적 네트워크 인터페이스
- VPC의 논리적 구성 요소이며 가상 네트워크 카드를 나타냄
- EC2 인스턴스가 네트워크에 액세스 할 수 있도록
- 주요 사설 IPv4와 하나 이상의 보조 IPv4를 가질 수 있음
- 각 ENI는 사설 IPv4당 탄력적 IPv4를 갖거나 혹은 하나의 공용 IPv4
- 사설 및 공용 IP가 하나씩 제공
- 하나 이상의 보안 그룹을 연결할 수 있음
- EC2 인스턴스와 독립적으로 ENI를 생성하고 즉시 연결하거나 장애 조치를 위해 EC2 인스턴스에서 이동시킬 수 있음
- ENI는 특정 가용 영역 즉 AZ에 바인딩됨
- 특정 AZ에서 ENI를 생성하면 해당 AZ에만 바인딩할 수 있다

### EBS Volume (Elastic Block Store)
- 인스턴스가 실행 중인 동안 연결 가능한 네트워크 드라이브
- 인스턴스가 종료된 후에도 데이터를 지속할 수 있음
- 인스턴스를 재생성하고 이전 EBS 볼륨을 마운트하면 데이터를 다시 받을 수 있음
- CCP 레벨의 EBS 볼륨은 한 번에 하나의 인스터스에만 마운트 할 수 있다
* 어소시에이트 레벨: 일부 EBS 다중 연결
- 네트워크 USB 스틱
- 네트워크 드라이브. 물리적 드라이브가 아님
- EBS 볼륨은 네트워크 드라이브이므로 EC2 인스턴스에서 분리될 수 있고 매우 빠르게 다른 인스턴스로 연결될 수 있음
- EBS 볼륨은 특정한 가용 영역에 고정되어 있으므로 다른 가용영역에 연결 불가
- 스냅샷을 이용하면 다른 가용 영역으로 볼륨을 옮길 수 있음
- 미리 용량을 정해야 함.
- 종료 시 삭제 기능
  - EC2 인스턴스를 생성할 때 종료 시 삭제 옵션을 체크하면 EC2 인스턴스 종료 시 함께 삭제된다

### EBS 다중연결 (Multi-Attach)
- 하나의 EBS 볼륨을 같은 가용 영역에 있는 여러 EC2 인스턴스에 연결하게 해줌
- 애플리케이션 가용성을 높이기위해 Teradata처럼 클러스터링된 Linux 애플리케이션에서 사용
- 애플리케이션이 동시 쓰기 작업을 관리해야 할 때 사용
- 해당 가용 영역 내에서만 사용할 수 있다
- 한 AZ -> 다른 AZ 연결 불가
- 한 번에 16개의 EC2 인스턴스만 같은 볼륨에 연결할 수 있다
- 다중 연결을 하려면 반드시 클러스터 인식 파일 시스템을 사용해야 한다

### EBS 암호화 (Encryption)
- EBS 볼륨을 생성하면 다음과 같은 일이 일어남
  - 저장 데이터가 볼륨 내부에 암호화
  - 인스턴스와 볼륨 간의 전송 데이터 암호화
  - 스냅샷뿐 아니라 스냅샷으롯 생성한 볼륨 역시 암호화
- 이때 함호화 및 복호화 메커니즘은 보이지 않게 처리되고 아무것도 하지 않아도 됨
- 백그라운드에서 EBS, EC2가 다 처리
- EBS 볼륨 암호화 및 암호화 풀기
  - 볼륨의 EBS 스냅샷 생성
  - 복사 기능을 통해 EBS 스냅샷 암호화
  - 스냅샷을 이용해 새 EBS 볼륨 생성 -> 해당 볼륨도 암호화
  - 암호화된 볼륨을 인스턴스 원본에 연결

### EFS (Elastic File System)
- 관리형 NFS
- 네트워크 파일 시스템
- 여러 EC2 인스턴스에 마운트될 수 있음
- 이 EC2 인스턴스들은 여러 가용 영역에 있을 수 있음
- 가용성이 높고 확장성도 높음 가격도 비쌈 gp2 EBS 볼륨의 2배
- 사용량만큼 지불
- 콘텐츠 관리, 웹 서버, 데이터 공유...등
- 내부적으로 NFS 프로토콜 사용
- 윈도우가 아닌 리눅스 기반 AMI와 호환됨
- 미리 용량을 계획하지 않아도 됨
- 파일 시스템이 자동으로 확장되고 사용량에 따라 요금이 부과됨
- EFS 성능
  - 수천 개의 NFS 클라이언트에서 EFS에 동시 액세스할 수 있게 확장
  - 처리량은 초당 10GB
  - 용량을 미리 프로비저닝하지 않아도 네트워크 파일 시스템이 PB 규모로 자동 확장
- 범용 모드
  - 기본 설정으로 지연 시간에 민감한 웹서버 , CMS 사용 사례
  - I/O 최대화하고 싶다면 최대 I/O 사용
  - 지연시간, 처리량 병렬 처리 성능이 향상
  - 파일 시스템에 빅데이터나 미디어 처리 작업이 있을 때 유용
- 처리량 모드
  - 버스팅 모드가 기본값 1TB 파일 시스템의 데이터 전송 속도는 초당 50MiB
  - 초당 100MiB까지 버스트할 수 있음
  - 버스팅 모드에서는 사용 공간이 많을수록 용량과 처리량이 늘어나는데
  - 프로버저닝모드에서는 스토리지 크기에 상관없이 처리량을 설정할 수 있음 

### 확장성과 고가용성 (Scalability & High Availability)
- 확장성은 조정을 통해 더 많은 양을 처리할 수 있다는 의미
  - 확장성의 종류
    - Vertical Scalability 수직확장
      - 인스턴스의 크기를 확장하는 것
      - t2.micro -> t2.large
      - 데이터베이스와 같은 분산되지 않은..
      - 확장 정도의 한계가 있음
    - Horizontal Scalability (= elasticity) 수평확장
      - 인스턴스의 수를 늘리는 것
      - 분배 시스템이 있다는 걸 의미
      - 웹이나 현대적 애플리케이션 등
- 고가용성 != 확장성
  - 애플리케이션 또는 시스템을 적어도 둘 이상의 aws의 AZ나 데이터 센터에서 가동 중이라는 걸 의미
  - 고가용성의 목표는 데이터 선터에서의 손실에서 살아남는 것 센터 하나가 멈춰도 계속 작동이 가능하도록

### 로드밸런서가 필요한 이유
- 부하를 다수의 다운스트림 인스턴스로 분산하기 위함
- 애플리케이션에 단일 액세스 지점을 노출하게되고 다운스트림 인스턴스의 장애를 원활히 처리
- 로드밸런서가 상태 확인 매커니즘으로 어떤 인스턴스로 트래픽을 보낼 수 없는 지 알려줌
- 인스턴스의 상태를 확인
- SSL 종료도 할 수 있음 웹 사이트에 암호화된 HTTPS 트래픽을 가질 수 있음
- 쿠키로 고정도를 강화할 수 있고 영역에 걸친 고가용성을 가지며 클라우드 내에서 개인 트래픽과 공공 트래픽을 분리할 수 있음
- 일래스틱 로드 밸런서는 관리형 로드 밸런서이기도 함
  - AWS가 관리하며, 어떤 경우에도 작동할 것을 보장
  - AWS가 업그레이드와 유지 관리 및 고가용성을 책임지며 그리고 로드 밸런서의 작동 방식을 수정할 수 있게끔 일부 구성 놉도 제공
- 자체 로드밸런서 -> 확장성 측면에서 불편
- 로드 밸런서는 다수의 AWS의 서비스들과 통합되어 있음
  - EC2, EC2 Auto Scaling Groups, Amazon ECS
  - AWS Certificate Manager (ACM), CloudWatch
  - Route 53, AWS WAF, AWS Global Accelerator

### AWS의 관리형 로드 밸런서 네종류
1. Classic Load Balancer - CLB
  - HTTP, HTTPS, TCP, SSL (secure TCP)
2. Application Load Balancer - ALB
  - HTTP, HTTPS, WebSocket
3. Network Load Balancer - NLB
  - TCP, TLS (secure TCP), UDP
4. Gateway Load Balancer - GWLB
  - Operates at layer 3 (Network layer) - IP Protocol

### SSL - Server Name Indication
- SNI는 아주 중대한 문제의 해결책
- 여러 개의 SSL 인증서를 하나의 웹 서버에 로드해 하나의 웹 서버가 여러 개의 웹 사이트 지원할 수 있게 해줌
- 이건 확자오딘 프로토콜로 클라이언트가 대상 서버의 호스트 이름을 지정하도록 함
- 최초 SSL 핸드셰이크 단클라이언트가 접속할 웹사이트를 말했을 때 서버는 어떤 인증서를 로드해야할 지 알 수 있음
- 모든 클라이언트가 지원하진 않음
- 애플리케이션 로드밸런서와 네트워크 로드 밸런서 그리고 클라우드 프론트에서만 작동
- 그러니까 어떤 로드 밸런서에 SSL 인증서가 여러 개 있다면 ALB/NLB 둘 중 하나이다

### Aurora 기능
- 자동 장애 조치
- 백업 및 복구
- 격리 및 보안
- 산업 규정 준수
- 자동 스케일링을 통한 버튼식 스케일링
- 제로 다운타임 자동 패치 설치
- 고급 모니터링
- 통상 유지 관리
- 백트랙(과거 어떤 시점의 데이터로도 복원)

### Amazon Fsx
- FSx for Lustre
  - 원래 분산 파일 시스템으로 대형 연산에 쓰였음
  - Linux + 클러스터(Cluster)
  - 머신 러닝과 HPC, 고성능 연산
  - 동영상 처리나 금융 모델링 전자 설계 자동화 등의 애플리케이션에 쓰임
  - 확장성이 높음
  - 성능 : 초당 수백 GB의 데이터에 수백만 IOPS로 확장, 밀리초보다 짧은 지연 시간
  - 낮은 지연 시간의 SSD나 워크로드가 많거나, 크기가 작은 무작위 파일 작업이 많으면 IOPS도 사용 가능
  - 처리량이 많은 워크로드나 크기가 큰 시퀀스 파일 작업에는 HDD
  - 비용 : SSD > HDD
  - Amazon S3와 무결절성 통합 가능
  - FSx로 S3를 파일 시스템처럼 읽어들일 수 있음
  - VPN과 직접 연결 통해 온프레미스 서버에서 사용 가능


- FSx for NetApp ONTAP
  - NFS, SMB, iSCSI 프로토콜과 호환 가능
  - FSx for NetAPP ONTAP 파일 시스템 활용하여 온프레미스 시스템의 ONTAP이나 NAS에서 실행중인 워크로드를 AWS로 옮길 수 있음
  - Linux, Windows, MacOS Aws의 VMWare Cloud, Workspaces, Appstream EC2, ECS, EKS...
  - 호환 가능한 폭이 아주 넓고 스토리지는 자동으로 확장 및 축소 됨 : 오토스케일링
  - 복제와 스냅샷 기능도 지원
  - 비용도 적게 들고 데이터 압축이나 데이터 중복제거도 가능
  - NetApp ONTAP에서 중복 파일을 찾을 수 있음
  - 지정 시간 복제 기능
    - 새 워크로드 등을 테스트할 때 상당히 유용
    - 파일 시스템에서 신속히 복제가 가능
    - 스테이징 파일 시스템을 둘 수 있음
  

- FSx for Windows File Server
  - 완전 관리형 Windows 파일 서버 공유 드라이브
  - SMB 프로토콜, Windows NTFS 지원
  - Microsoft Active Directory 통합 지원 > 자용자 보안 추가, ACL로 사용자 할당량 추가해 액세스 제어 가능
  - Linux EC2 인스턴스에도 마운트 가능
  - 온프레미스 등에 Windows File Server 가 있는 경우 Microsoft 분산 파일 시스템인 DFS 기능을 이용해 파일 시스템을 그룹화
    - 온프레미스의 Windows File Server 와 FSx for Windows File Server 결합 가능
  - 성능 : 초당 수십 GB에 수백만 IOPS 그리고 수백 PB의 데이터까지 확장
  - FSx for Windows File Server의 스토리지 옵션 : SSD로 지연 시간이 짧아야 하는 워크로드를 저장할 수 있음
  - 데이터베이스, 미디어 처리 데이터 분석 등
  - 혹은 더 비용이 싼 HDD로 넓은 스펙트럼의 워크로드 저장
  - 디렉터리나 CMS도 가능
  - 프라이빗 연결로 온프레미스 인프라에 액세스 가능
  - 다중 AZ에 대해 FSx for Windows File Server 구성 가능
  - 모든 데이터는 재해 복구 목적으로 Amazon S3에 매일 백업됨


- FSx for OpenZFS
  - AWS의 관리형 OpenZFS 파일 시스템
  - 여러 버전에서의 NFS 프로토콜과 호환 가능
  - 주로 ZFS에서 실행되는 워크로드를 내부적으로 AWS로 옮길 때 사용
  - Linux, Mac, Windows에서 사용할 수 있음
  - 성능이 상당히 좋아서 백만 IOPS까지 확장 가능 지연 시간은 0.5 밀리초 이하
  - 스냅샷, 압축 지원 비용이 적지만 데이터 중복제거 기능은 없음
  - NetApp ONTAP처럼 지정 시간 동시 복제 기능이 있어서 새 워크로드 테스트 시에 유용