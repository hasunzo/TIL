## 애플리케이션 커뮤니케이션
### 동기 커뮤니케이션
- 애플리케이션이 또 다른 애플리케이션과 직접적으로 연결
- 구매 서비스가 배송 서비스에게 사건이 발생했으니 배송을 하라고 얘기
### 비동기 커뮤니케이션
- 대기열 등으로 불리는 미들웨어가 애플리케이션들을 연결
- 구매 서비스가 '누군가가 어떤 물건을 구매했으니 이를 대기열에 포함시키겠다' 라고 하고 끝
- 그러면 배송 서비스가 대기열에게 최근 구매 내역이 있는지 물어보고
- 대기열이 해당 요소를 반환하면 배송 서비스는 자기가 원하는 것을 무엇이든지 할 수 있음
- 구매 서비스와 배송 서비스가 직접적으로 연결되어 있지 않음
- 그 사이에 대기열이 있을 뿐.
### 동기화가 문제가 되는 경우
- 구매가 갑자기 너무 증가
- 한 서비스가 다른 서비스를 압도
- 트래픽이 갑자기 급증하거나 아무것도 예측할 수 없을 때 일반적으로 애플리케이션을 분리하고 분리 계층을 확장하는 것이 좋음
- 대기열 모델 : SQS
- pub/sub 모델 : SNS
- 실시간 스트리밍, 대용량 데이터 : Kinesis


## SQS
- AWS에서 가장 오래된 서비스
- 간단한 대기 서비스
- SQS 대기열에는 메시지를 포함
- 메시지를 담기 위해서는 무언가 SQS 대기열에 메시지를 전송해야 하는데,
- 대기열에 메시지를 보내는 주체 : 생산자
  - 여러 생산자가 여러 개의 메시지를 SQS 대기열에 보내게 할 수 있음
- 메시지를 수신하는 대상 : 소비자
  - 소비자는 대기열에서 메시지를 폴링함
  - 이는 대기열에게 소비자 앞으로 온 메시지가 있는지를 물어보는 것
  - 만일 대기열에 메시지가 있으면 소비자는 이 메시지를 폴링해서 정보를 얻음
  - 그리고 그 메시지로 처리를 하고 대기열에서 해당 메시지를 삭제함
  - 여러 소비자가 SQS 대기열에서 메시지를 소비할 수 있도록 할 수도 있음
- 대기열 서비스는 생산자와 소비자 사이를 분리하는 버퍼 약할을 함
- 애플리케이션 분리에 대한 문제가 보이면 Amazon SQS 생각하기
### SQS의 특별한 점
- 무제한 처리량을 얻을 수 있음
- 초당 원하는 만큼 메시지를 보낼 수 있고 대기열에도 원하는 만큼 메시지를 포함시킬 수 있음
- 처리량에 제한이 없고 대기열에 있는 메시지 수에도 제한이 없음
- 각 메시지는 수명이 짧아, 대기열에 메시지를 보내자마자 소비자가 읽고 해당 보존기간 내에 처리 후 삭제해야 함
- 기본값은 4일, 최대 14일 동안 대기열에 있을 수 있음
- 지연 시간이 짧음 : 게시 및 수신 시 10밀리초 이내로 빠르게 응답
- SQS 메시지는 작아야 함
  - 전송된 메시지당 256KB 미만이어야 함
- SQS는 중복 메시지가 있을 수 있음
  - 대기열 서비스이므로 높은 처리량, 높은 볼륨 등이 있기 때문에
- SQS 대기열에서 더 많은 메시지가 있어서 처리량을 늘려야 하면 소비자를 추가하고 수평 확장을 수행해서 처리량을 개선할 수 있음
- 대기열의 길이가 특정 수준을 넘어가면 CloudWatch Alarm을 설정
  - 이 알람은 오토 스케일링 그룹의 용량을 X만큼 증가시킴
### SQS 보안
- 메시지를 보내고 생성함으로써 비행 중 암호화를 하고 KMS 키를 사용하여 미사용 암호화를 얻고 원한다면 클라이언트 측 암호화를 할 수도 있는데
- 이는 클라이언트가 자체적으로 암호화 및 암호 해독을 수행해야 함을 의미함
- SQS 에서 기본적으로 지원하는 것은 아님
- 액세스 제어를 위해 IAM 정책은 SQS API에 대한 액세스를 규제할 수 있고
- S3 버킷 정책과 유사한 SQS 액세스 정책도 있음
  - SQS 대기열에 대한 교차 계정 액세스를 수행하려는 경우나
  - SNS 혹은 Amazon S3 같은 다른 서비스가 SQS 대기열에 S3 이벤트 같은 것을 쓸 수 있도록 허용하려는 경우에 유용