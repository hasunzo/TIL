# 1장 카프카 개요

작성 일: 2021-12-27
책 제목: 실전 카프카 개발부터 운영까지

### 🛠 잘란도와 트위터의 카프카 도입 사례

💬 **유럽 최대 온라인 패션몰 잘란도의 도입 사례**

- 회사의 규모 ⬆ + 사업의 다각화 + 데이터에 대한 요구사항 ⬆
    - 다양한 데이터 요구사항을 근본적으로 해결하기 위한 대책을 강구
    - 이벤트 드리븐 시스템으로의 전환
- 위기에 봉착한 잘란도
    - 여러 네트워크를 이용하는 환경에서 모든 데이터 변경에 대한 올바른 전달 보장 문제
    - 동일한 데이터를 동시에 수정하면서 정확하게 순서를 보장해야 하는 문제
    - 수정된 이벤트들을 정확한 순서대로 아웃바운드 전송하는 문제
    - 다양한 클라이언트드르이 요구사항을 효율적으로 지원하기 어려운 문제
    - 빠른 전송을 위한 클라이언트 또는 대량의 배치 전송을 위한 클라이언트를 지원하기 어려운 문제
- 비동기 방식의 대표 스트리밍 플랫폼, 카프카 도입
    - 빠른 데이터 수집이 가능한 높은 처리량
        - 카프카로 처리되는 응답시간은 불과 한 자릿수의 밀리초 단위
    - 순서 보장
        - 이벤트 처리 순서 보장 → 엔티티의 복잡성 제거 → 구조 간결
    - 적어도 한 번 전송 방식
        - 멱등성 → 동일한 작업을 여러 번 수행하더라도 결과가 달라지지 않음
    - 자연스러운 백프레셔 핸들링
        - 카프카의 클라이언트 풀 방식으로 동작 → 자기 자신의 속도로 데이터 처리
    - 강력한 파티셔닝
        - 논리적으로 토픽을 여러 개로 나눌 수 있음 → 효과적인 수평 확장 가능
    - 그 외 여러 가지 기능
        - 로그 컴팩션 기능을 통해 스냅샷 역할 가능
        - 프로듀서와 컨슈머가 완벽하게 분리된 비동기식 방식 → 애플리케이션 병목 현상 정확하게 파악 가능 → 모니터링을 통해 지연에 대한 문제를 빠르게 해결

**💬 SNS 절대 강자 트위터의 카프카 활용 사례**

- 트위터의 고민
    - 속보를 빠르게 노출해야 함
    - 관련 광고를 사용자들에게 제공
    - 많은 실시간 사용 사례들 다루기
- 카프카로 유턴한 트위터
    - 왜 카프카를 포기하였나?
        - 카프카 0.7 버전에서의 문제점 (I/O 오퍼레이션 문제 발생, 내구성 및 리플리케이션의 미구현으로 인한 불안정성)
    - 다시 카프카로 전환한 이유는?
        - 카프카의 진전 (빠른 응답시간, 높은 처리량 → 메시징 시스템의 업계 표준 자리매김)
        - 펍/섭 모델을 지원하는 시스템으로 수평 확장 용이, 고가용성을 갖춘 시스템으로의 성장
- 비용 절감 효과
    - 이벤트 버스에 비해 카프카의 응답 속도가 빠르다는 사실을 발견
    - 카프카는 BFS와 상관없이 지연의 거의 발생하지 않음
    - 카프카는 하나의 프로세스에서 스토리지와 요청을 모두 처리함
    - 카프카는 OS에 의존해 백그라운드로 fsync()를 처리하고 제로카피를 사용
    - 이벤트 버스를 운영하려면 더 많은 하드웨어 필요 vs 카프카는 많은 하드웨어가 필요치않음
- 강력한 커뮤니티

### 카프카의 주요 특징

1. 높은 처리량과 낮은 지연시간
2. 높은 확장성
3. 고가용성
4. 내구성
    - 전통적인 메시징 시스템은 메시지를 가져감과 동시에 메시지 삭제
    - 카프카는 지정된 설정 시간 또는 로그의 크기만큼 로컬디스크에 보관
5. 개발편의성
    - 프로듀서와 컨슈머가 완벽하게 분리되어 동작하고 서로 영향을 주고 받지 않음
6. 운영 및 관리 편의성