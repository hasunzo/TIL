# 10 ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´
- JPAëŠ” ë³µì¡í•œ ê²€ìƒ‰ ì¡°ê±´ì„ ì‚¬ìš©í•´ì„œ ì—”í‹°í‹° ê°ì²´ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ì¿¼ë¦¬ ê¸°ìˆ ì„ ì§€ì›í•¨.
- JPQLì€ ê°€ì¥ ì¤‘ìš”í•œ ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ì´ë‹¤.

## 10.1 ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì†Œê°œ
- em.find() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ì‹ë³„ìë¡œ ì—”í‹°í‹° í•˜ë‚˜ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŒ
    - ì´ë ‡ê²Œ ì¡°íšŒí•œ ì—”í‹°í‹°ì— ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ì„ ì‚¬ìš©í•˜ë©´ -> ì—°ê´€ëœ ì—”í‹°í‹°ë“¤ì„ ì°¾ì„ ìˆ˜ ìˆë‹¤.

- ì‹ë³„ìë¡œ ì¡°íšŒ EntityManager.find()
- ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ a.getB(), getC()

- but, ì´ ê¸°ëŠ¥ë§Œìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•˜ê¸°ëŠ” ì–´ë ¤ì›€
    - ì˜ˆë¥¼ ë“¤ì–´ ë‚˜ì´ê°€ 30ì‚´ì¸ íšŒì›ì„ ëª¨ë‘ ê²€ìƒ‰í•˜ê³  ì‹¶ë‹¤ë©´?
        - ëª¨ë“  íšŒì› ì—”í‹°í‹°ë¥¼ ë©”ëª¨ë¦¬ì— ì˜¬ë ¤ë‘ê³ 
        - ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ 30ì‚´ ì´ìƒì¸ íšŒì›ì„ ê²€ìƒ‰í•˜ëŠ” ê²ƒì€ í˜„ì‹¤ì„± ì—†ìŒ
        - ê²°êµ­ -> ë°ì´í„°ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ìˆìœ¼ë¯€ë¡œ SLQë¡œ í•„ìš”í•œ ë‚´ìš©ì„ ìµœëŒ€í•œ ê±¸ëŸ¬ì„œ ì¡°íšŒí•´ì•¼ í•¨.
    - ORMì„ ì‚¬ìš©í•˜ë©´?
        - ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê°œë°œ.
        - ê²€ìƒ‰ë˜í•œ í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ë°©ë²•ì´ í•„ìš”.

- JPQLì˜ íŠ¹ì§•
    - í…Œì´ë¸”ì´ ì•„ë‹Œ ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ê°ì²´ì§€í–¥ ì¿¼ë¦¬
    - SLQì„ ì¶”ìƒí™”í•´ì„œ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ SQLì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ

- SQL -> ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ë°ì´í„° ì¤‘ì‹¬ì˜ ì¿¼ë¦¬
- JPQL -> ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ê°ì²´ì§€í–¥ ì¿¼ë¦¬
- JPQLì„ ì‚¬ìš©í•˜ë©´ JPAëŠ” ì´ JPQLì„ ë¶„ì„ í•œ ë‹¤ìŒ -> ì ì ˆí•œ SQLì„ ë§Œë“¤ì–´ ì¡°íšŒí•¨.
    - ì¡°íšŒí•œ ê²°ê³¼ë¡œ ì—”í‹°í‹° ê°¤ì²´ë¥¼ ìƒì„±í•´ì„œ ë°˜í™˜.

- JPQL = "ê°ì²´ì§€í–¥ SQL"

#### JPAê°€ ê³µì‹ ì§€ì›í•˜ëŠ” ê¸°ëŠ¥
- JPQL(Java Persistence Query Language)
- Criteria ì¿¼ë¦¬ : JPQLì„ í¸í•˜ê²Œ ì‘ì„±í•˜ë„ë¡ ë„ì™€ì£¼ëŠ” API, ë¹Œë” í´ë˜ìŠ¤ ëª¨ìŒ
- ë„¤ì´í‹°ë¸Œ SLQ : JPAì—ì„œ JPQL ëŒ€ì‹  ì§ì ‘ SQLì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

#### JPQê°€ ê³µì‹ ì§€ì›í•˜ëŠ” ê¸°ëŠ¥ì€ ì•„ë‹ˆì§€ë§Œ ì•Œì•„ë‘˜ ê°€ì¹˜ê°€ ìˆëŠ” ê²ƒë“¤
- QueryDSL : Criteria ì¿¼ë¦¬ì²˜ëŸ¼ JPQLì„ í¸í•˜ê²Œ ì‘ì„±í•˜ë„ë¡ ë„ì™€ì£¼ëŠ” ë¹Œë” í´ë˜ìŠ¤ ëª¨ìŒ. ë¹„í‘œì¤€ ì˜¤í”ˆì†ŒìŠ¤ í”„ë ˆì„ì›Œí¬
- JDBC ì§ì ‘ ì‚¬ìš©, MyBatis ê°™ì€ SQL ë§¤í¼ í”„ë ˆì„ì›Œí¬ ì‚¬ìš©

### 10.1.1 JPQL ì†Œê°œ
- JPQLì€ ì—”í‹°í‹° ê°ì²´ë¥¼ ì¡°íšŒí•˜ëŠ” ê°ì²´ì§€í–¥ ì¿¼ë¦¬.
- ë¬¸ë²•ì€ SQLê³¼ ë¹„ìŠ·í•˜ê³  ANSI í‘œì¤€ SQLì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ìœ ì‚¬í•˜ê²Œ ì§€ì›í•¨.
- JPQLì€ SQLì„ ì¶”ìƒí™”í•´ì„œ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ
- ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ë§Œ ë³€ê²½í•˜ë©´ JPQLì„ ìˆ˜ì •í•˜ì§€ ì•Šì•„ë„ ìì—°ìŠ¤ëŸ½ê²Œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŒ.
### JPQLì€ SQLë³´ë‹¤ ê°„ê²°í•˜ë‹¤!

- íšŒì› ì—”í‹°í‹°ë¥¼ ëŒ€ìƒìœ¼ë¡œ JPQLì„ ì‚¬ìš©í•˜ëŠ” ê°„ë‹¨í•œ ì˜ˆì œ
```java
@Entity(name = "Member")    //name ì†ì„±ì˜ ê¸°ë³¸ê°’ì€ í´ë˜ìŠ¤ ëª…
public class Memebr {
    
    @Column(name = "name")
    private String username;
    //...
}
```
- JPQL ì‚¬ìš©
```java
//ì¿¼ë¦¬ ìƒì„±
String jpql = "select m from Member as m where m.username = 'kim'";
List<Member> resultList = em.createQuery(jpql, Member.class).getResultList();
```
- ì˜ˆì œ ì½”ë“œëŠ” íšŒì›ì´ë¦„ì´ kimì¸ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•¨
- JPQLì—ì„œ MemberëŠ” ì—”í‹°í‹° ì´ë¦„ì´ë‹¤.
- m.usernameì€ í…Œì´ë¸” ì»¬ëŸ¼ëª…ì´ ì•„ë‹Œ, ì—”í‹°í‹° ê°ì²´ì˜ í•„ë“œëª…ì´ë‹¤.
- em.createQuery() ë©”ì†Œë“œì— ì‹¤í–‰í•  JPQLê³¼ ë°˜í™˜í•  ì—”í‹°í‹°ì˜ í´ë˜ìŠ¤ íƒ€ì…ì¸ Member.classë¥¼ ë„˜ê²¨ì£¼ê³ 
  getResultList() ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•˜ë©´ JPAëŠ” JPQLì„ SQLë¡œ ë³€í™˜í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¡°íšŒí•¨.

- ê·¸ë¦¬ê³  ì¡°íšŒí•œ ê²°ê³¼ë¡œ Member ì—”í‹°í‹°ë¥¼ ìƒì„±í•˜ì—¬ ë°˜í™˜í•¨

- ì‹¤í–‰í•œ JPQL
```h2
select m 
from Member as m 
where m.username = 'kim'
```
- ì‹¤ì œ ì‹¤í–‰ëœ SQL
```h2
select
    member.id as id,
    member.age as age,
    member.team_id as team,
    member.name as name
from 
    Member member
where
    member.name='kim'
```

### 10.1.2 Criteria ì¿¼ë¦¬ ì†Œê°œ
- CriteriaëŠ” JPQLì„ ìƒì„±í•˜ëŠ” ë¹Œë” í´ë˜ìŠ¤
- Criteriaì˜ ì¥ì 
    - ë¬¸ìê°€ ì•„ë‹Œ query.select(m).where(...)ì²˜ëŸ¼ í”„ë¡œê·¸ë˜ë° ì½”ë“œë¡œ JPQLì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤ëŠ” ì 

- ë¬¸ìë¡œ ì‘ì„±í•œ JPQLë³´ë‹¤ ì½”ë“œë¡œ ì‘ì„±í•œ Criteriaì˜ ì¥ì 
- ì»´íŒŒì¼ ì‹œì ì— ì˜¤ë¥˜ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆìŒ
- IDEë¥¼ ì‚¬ìš©í•˜ë©´ ì½”ë“œ ìë™ì™„ì„±ì„ ì§€ì›í•¨
- ë™ì  ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê¸° í¸í•¨

- ë°©ê¸ˆ ë³¸ JPQLì„ Criteriaë¡œ ì‘ì„±í•˜ë©´?
```h2
select m from Member as m where m.username = 'kim'
```

- Criteria ì¿¼ë¦¬
```h2
//Criteria ì‚¬ìš© ì¤€ë¹„
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Member> query = cb.createQuery(Member.class);

//ë£¨íŠ¸ í´ë˜ìŠ¤(ì¡°íšŒë¥¼ ì‹œì‘í•  í´ë˜ìŠ¤)
Root<Member> m = query.from(Member.class);

//ì¿¼ë¦¬ ìƒì„±
CriteriaQuery<Member> cq =
    query.select(m).where(cb.equal(m.get("username"), "kim"));
List<Member> resultList = em.createQuery(cq).getResultList();    
```
- ì¿¼ë¦¬ë¥¼ ë¬¸ìê°€ ì•„ë‹Œ ì½”ë“œë¡œ ì‘ì„±í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ.
- ì•„ì‰¬ìš´ ì  -> m.get("username") -> í•„ë“œ ëª…ì„ ë¬¸ìë¡œ ì‘ì„±
    - ì´ ë¶€ë¶„ë„ ë¬¸ìê°€ ì•„ë‹Œ ì½”ë“œë¡œ ì‘ì„±í•˜ê³  ì‹¶ë‹¤ë©´?
        - ë©”íƒ€ ëª¨ë¸ì„ ì‚¬ìš©!

- ë©”íƒ€ ëª¨ë¸ API?
    - ìë°”ê°€ ì œê³µí•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ í”„ë¡œì„¸ì„œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ ì–´ë…¸í…Œì´ì…˜ì„ ë¶„ì„í•´ì„œ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŒ
    - JPAëŠ” ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì„œ Member ì—”í‹°í‹° í´ë˜ìŠ¤ë¡œë¶€í„° Member_ë¼ëŠ” Criteria ì „ìš© í´ë˜ìŠ¤ë¥¼ ìƒì„±
        - ì´ê²ƒì„ ë©”íƒ€ ëª¨ë¸ì´ë¼ í•¨

```java
//ë©”íƒ€ ëª¨ë¸ ì‚¬ìš© ì „ -> ì‚¬ìš© í›„
m.get("username") -> m.get(Member_.username)
```

### 10.1.3 QueryDSL ì†Œê°œ
- QueryDSLë„ Criteriaì²˜ëŸ¼ JPQL ë¹Œë” ì—­í• ì„ í•¨
- QUeryDSLì˜ ì¥ì 
    - ì½”ë“œ ê¸°ë°˜ì´ë©´ì„œ ë‹¨ìˆœí•˜ê³  ì‚¬ìš©í•˜ê¸° ì‰¬ì›€
    - ì‘ì„±í•œ ì½”ë“œë„ JPQLê³¼ ë¹„ìŠ·í•˜ì—¬ í•œëˆˆì— ë“¤ì–´ì˜´

- QueryDSLë¡œ ì‘ì„±í•œ ì½”ë“œ
```java
//ì¤€ë¹„
JPAQuery query = new JPAQuery(em);
QMember member = QMember.member;

//ì¿¼ë¦¬, ê²°ê³¼ì¡°íšŒ
List<Member> members =
    query.from(member)
    .where(member.username.eq("kim"))
    .list(member);
```

- QueryDSLë„ ì–´ë…¸í…Œì´ì…˜ í”„ë¡œì„¸ì„œë¥¼ ì‚¬ìš©í•´ì„œ ì¿¼ë¦¬ ì „ìš© í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼ í•¨
- QMemberëŠ” Member ì—”í‹°í‹° í´ë˜ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±í•œ QueryDSL ì¿¼ë¦¬ ì „ìš© í´ë˜ìŠ¤

### 10.1.4 ë„¤ì´í‹°ë¸Œ SQL ì†Œê°œ
- JPAê°€ ì œê³µí•˜ëŠ” SQLì„ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥
- JPQLì„ ì‚¬ìš©í•´ë„ ê°€ë”ì€ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì˜ì¡´í•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì•¼ í•  ë•Œê°€ ìˆìŒ
    - ì˜ˆ) ì˜¤ë¼í´ ë°ì´í„°ë² ì´ìŠ¤ë§Œ ì‚¬ìš©í•˜ëŠ” CONNECT BY ê¸°ëŠ¥
    - íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì—ì„œë§Œ ë™ì‘í•˜ëŠ” SQL íŒíŠ¸...

- ë„¤ì´í‹°ë¸Œ SQLì˜ ë‹¨ì  -> íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì˜ì¡´í•˜ëŠ” SQLì„ ì‘ì„±í•´ì•¼ í•œë‹¤ëŠ” ê²ƒ.
- ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë³€ê²½í•˜ë©´ ë„¤ì´í‹°ë¸Œ SQLë„ ìˆ˜ì •í•´ì•¼ í•¨
- ë„¤ì´í‹°ë¸Œ SQL

```java
String sql = "SELECT ID, AGE, TEAM_ID, NAME FROM MEMBER WHERE NAME = 'kim'";
List<Member> resultList = 
    em.createNativeQuery(sql, Member.class).getResultList();
```
- ë„¤ì´í‹°ë¸Œ SQLì€ em.createNativeQuery()ë¥¼ ì‚¬ìš©í•˜ë©´ ë¨
- ì‹¤í–‰í•˜ë©´ ì§ì ‘ ì‘ì„±í•œ SQLì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ë‹¬í•¨

## 10.2 JPQL
- JPQLì˜ íŠ¹ì§•
    - JPQLì€ ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ ->
        - í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ X ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒ
    - JPQLì€ SQLì„ ì¶”ìƒí™” -> íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ SQLì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ
    - JPQLì€ ê²°êµ­ SQLë¡œ ë³€í™˜

### 10.2.1 ê¸°ë³¸ ë¬¸ë²•ê³¼ ì¿¼ë¦¬ API
#### SELECT ë¬¸
```java
SELECT m FROM Member AS m where m.username = 'hello'
```
- ëŒ€ì†Œë¬¸ì êµ¬ë¶„
    - ì—”í‹°í‹°ì™€ ì†ì„±ì€ ëŒ€ì†Œë¬¸ì êµ¬ë¶„ O
        - Member, username
    - SELECT, FROM, AS -> JPQL í‚¤ì›Œë“œëŠ” ëŒ€ì†Œë¬¸ì êµ¬ë¶„ X

- ì—”í‹°í‹° ì´ë¦„
    - JPQLì˜ MemberëŠ” í´ë˜ìŠ¤ ëª… X ì—”í‹°í‹° ëª…ì„
    - ì—”í‹°í‹° ëª… ì§€ì • -> @Entity(name="XXX")
    - ë¯¸ì§€ì • ì‹œ -> í´ë˜ìŠ¤ ëª…ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ

- ë³„ì¹­ì€ í•„ìˆ˜
    - Member AS m
        - JPQLì€ ë³„ì¹­ì„ í•„ìˆ˜ë¡œ ì‚¬ìš©
        - AS ìƒëµ ê°€ëŠ¥

```java
SELECT username FROM Member m // ì˜ëª»ëœ í‘œí˜„ m.usernameìœ¼ë¡œ ê³ ì³ì•¼í•¨
```

#### TypeQuery, Query
- ì‘ì„±í•œ JPQLì„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì¿¼ë¦¬ ê°ì²´
- TypeQuery
    - ë°˜í™˜í•  íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ì§€ì •í•  ìˆ˜ ìˆì„ ë•Œ
```java
TypedQuery<Member> query = 
        em.createQuery("SELECT m FROM Member m", Member.class);

List<Member> resultList = query.getResultList();
for(Member member : resultList) {
    System.out.println("Member = "+ member);
}
```
- em.createQuery()ì˜ ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì— ë°˜í™˜í•  íƒ€ì…ì„ ì§€ì •
    - ì¡°íšŒ ëŒ€ìƒì´ Member ì—”í‹°í‹°ì´ë¯€ë¡œ ì¡°íšŒ ëŒ€ìƒ íƒ€ì…ì´ ëª…í™•í•¨


- Query
    - ë°˜í™˜ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ì§€ì •í•  ìˆ˜ ì—†ì„ ë•Œ
```java
Query query = em.createQuery("SELECT m.username, m.age from Member m");
List resultList = query.getResultList();
        
for(Object o : resultList) {
    Object[] result = (Object[]) o; //ê²°ê³¼ê°€ ë‘˜ ì´ìƒì´ë©´ Object[] ë°˜í™˜
    System.out.println("username = " + result[0]);
    System.out.println("age = " + result[1]);
}
```
- ì¡°íšŒ ëŒ€ìƒì´ ëª…í™•í•˜ì§€ ì•ŠìŒ - Query ê°ì²´ ì‚¬ìš©
    - username : String íƒ€ì…
    - age : Integer íƒ€ì…

#### ê²°ê³¼ ì¡°íšŒ
- query.getResultList() : ê²°ê³¼ë¥¼ ì˜ˆì œë¡œ ë°˜í™˜í•¨.
    - ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë¹ˆ ì»¬ë ‰ì…˜ ë°˜í™˜

- query.getSingleResult() : ê²°ê³¼ê°€ ì •í™•íˆ í•˜ë‚˜ì¼ ë•Œ ì‚¬ìš©
    - ê²°ê³¼ê°€ ì—†ìœ¼ë©´ javax.persistence.NoResultException ì˜ˆì™¸ ë°œìƒ
    - ê²°ê³¼ê°€ 1ê°œë³´ë‹¤ ë§ìœ¼ë©´ javax.persistence.NonUniqueResultException ì˜ˆì™¸ ë°œìƒ

- getStringResult()ëŠ” ê²°ê³¼ê°€ ì •í™•íˆ 1ê°œê°€ ì•„ë‹ˆë©´ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤ëŠ” ì ì— ì£¼ì˜
```java
Member member = query.getSingleResult();
```

### 10.2.2 íŒŒë¼ë¯¸í„° ë°”ì¸ë”©
- JDBC : ìœ„ì¹˜ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ë§Œ ì§€ì›
- JPQL : ì´ë¦„ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ë„ ì§€ì›

#### ì´ë¦„ ê¸°ì¤€ íŒŒë¼ë¯¸í„°
- íŒŒë¼ë¯¸í„°ë¥¼ ì´ë¦„ìœ¼ë¡œ êµ¬ë¶„í•˜ëŠ” ë°©ë²•
- ì´ë¦„ ê¸°ì¤€ íŒŒë¼ë¯¸í„°ëŠ” ì•ì— :ë¥¼ ì‚¬ìš©í•¨
```java
String usernameParam = "User1";
        
TypedQuery<Member> query = 
        em.createQuery("SELECT m FROM member m where m.username = :username", Member.class);
        
query.setParameter("username", usernameParam);
List<Member> resultList = query.getResultList();

```
- :usernameì´ë¼ëŠ” ì´ë¦„ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ì •ì˜
- query.setParameter() ì—ì„œ usernameì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ íŒŒë¼ë¯¸í„°ë¥¼ ë°”ì¸ë”©
- ì°¸ê³ ) JPQL APIëŠ” ëŒ€ë¶€ë¶„ ë©”ì†Œë“œ ì²´ì¸ ë°©ì‹ìœ¼ë¡œ ì„¤ê³„ - ì—°ì†í•´ì„œ ì‘ì„±ê°€ëŠ¥
#### ìœ„ì¹˜ ê¸°ì¤€ íŒŒë¼ë¯¸í„°
```java
List<Member> resultList = em.createQuery("SELECT m FROM Member m where m.username = ?1", Member.class)
        .setParameter(1, usernameParam)
        .getResultList();
```
- ìœ„ì¹˜ ê¸°ì¤€ íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ '?' ë‹¤ìŒì— ìœ„ì¹˜ ê°’ì„ ì£¼ë©´ ë¨
    - ìœ„ì¹˜ ê°’ì€ 1ë¶€í„° ì‹œì‘

- ìœ„ì¹˜ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ë°©ì‹ë³´ë‹¤ëŠ” ì´ë¦„ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ë°©ì‹ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ëª…í™•í•¨

### 10.2.3 í”„ë¡œì ì…˜
- SELECT ì ˆì— ì¡°íšŒí•  ëŒ€ìƒì„ ì§€ì •í•˜ëŠ” ê²ƒì„ í”„ë¡œì ì…˜ì´ë¼ í•œë‹¤.
    - (SELECT (í”„ë¡œì ì…˜ ëŒ€ìƒ) FROM)ìœ¼ë¡œ ëŒ€ìƒì„ ì„ íƒ
- í”„ë¡œì ì…˜ ëŒ€ìƒ
    - ì—”í‹°í‹°
    - ì— ë¹„ë””ë“œ íƒ€ì…
    - ìŠ¤ì¹¼ë¼ íƒ€ì… (ìˆ«ì, ë¬¸ì ë“± ê¸°ë³¸ ë°ì´í„° íƒ€ì…)

ğŸ”½ ì—”í‹°í‹° í”„ë¡œì ì…˜
```java
SELECT m FROM Member m          //íšŒì›
SELECT m.team FROM Member m     //íŒ€
```
- ì»¬ëŸ¼ì„ í•˜ë‚˜í•˜ë‚˜ ë‚˜ì—´í•´ì„œ ì¡°íšŒí•´ì•¼ í•˜ëŠ” SQLê³¼ ì°¨ì´ê°€ ìˆìŒ
- ì´ë ‡ê²Œ ì¡°íšŒí•œ ì—”í‹°í‹°ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ë¨


ğŸ”½ ì„ë² ë””ë“œ íƒ€ì… í”„ë¡œì ì…˜
```java
String query = "SELECT a FROM Address a";
```
- ì˜ëª»ëœ ì¿¼ë¦¬
- ì„ë² ë””ë“œ íƒ€ì…ì€ ì¡°íšŒì˜ ì‹œì‘ì ì´ ë  ìˆ˜ ì—†ìŒ
- ìœ„ ì½”ë“œëŠ” Address(Orderì˜ ê°ì²´íƒ€ì…)ë¥¼ ì¡°íšŒì˜ ì‹œì‘ì ìœ¼ë¡œ ì‚¬ìš©í•¨

```java
String query = "SELECT o.address FROM Order o";
List<Address> address = em.createQuery(query, Address.class)
                            .getResultList();
```
- Order ì—”í‹°í‹°ê°€ ì‹œì‘ì .
- ì—”í‹°í‹°ë¥¼ í†µí•´ ì„ë² ë””ë“œ íƒ€ì…ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŒ

ğŸ‘‰ ì‹¤í–‰ëœ SQL
```h2
select
    order.city,
    order.street,
    order.zipcode
from
    Orders order
```
- ì„ë² ë””ë“œ íƒ€ì…ì€ ì—”í‹°í‹° íƒ€ì…ì´ ì•„ë‹Œ ê°’ íƒ€ì….
- ì´ë ‡ê²Œ ì¡°íšŒí•œ ì„ë² ë””ë“œ íƒ€ì…ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ë˜ì§€ ì•ŠëŠ”ë‹¤.

ğŸ”½ ìŠ¤ì¹¼ë¼ íƒ€ì… í”„ë¡œì ì…˜
```java
List<String> username = 
        em.createQuery("SELECT m.username FROM Member m", String.class)
        .getResultList();
```
- ğŸ‘† ì „ì²´ íšŒì›ì˜ ì´ë¦„ ì¡°íšŒ
- ìˆ«ì, ë¬¸ì, ë‚ ì§œì™€ ê°™ì€ ê¸°ë³¸ ë°ì´í„° íƒ€ì…ë“¤ì„ ìŠ¤ì¹¼ë¼ íƒ€ì…ì´ë¼ í•¨

```java
SELECT DISTINCT username FROM Member m
```
- ì¤‘ë³µ ë°ì´í„° ì œê±°ì‹œ DISTINCT ì‚¬ìš©

```java
Double orderAmountAvg =
        em.createQuery("SELECT AVG(o.orderAmount) FROM Order o", Double.class)
        .getSingleResult();
```
- ìœ„ì™€ ê°™ì€ í†µê³„ ì¿¼ë¦¬ë„ ì£¼ë¡œ ìŠ¤ì¹¼ë¼ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒ

ğŸ”½ ì—¬ëŸ¬ ê°’ ì¡°íšŒ
- ê¼­ í•„ìš”í•œ ë°ì´í„°ë“¤ë§Œ ì„ íƒí•´ì„œ ì¡°íšŒí•´ì•¼ í•  ë•Œ ì‚¬ìš©
- í”„ë¡œì ì…˜ì— ì—¬ëŸ¬ ê°’ì„ ì„ íƒí•˜ë©´ TypeQueryë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ê³  Query ì‚¬ìš©

```java
Query query = em.createQuery("SELECT m.username, m.age FROM Member m");
List resultList = query.getResultList();

Iterator iterator = resultList.iterator();
while (iterator.hasNext()) {
    Object[] row = (Object[]) iterator.next();
    String username = (String) row[0];
    Integer age = (Integer) row[1];
}
```
- ì œë„¤ë¦­ì— Object[] ì‚¬ìš© ì‹œ ì½”ë“œ ê°„ê²°í•´ì§
```java
List<Object[]> resultList = 
        em.createQuery("SELECT m.username, m.age FROM Member m")
        .getResultList();

for (Object[] row : resultList){
    String username = (String) row[0];
    Integer age = (Integer) row[1];
}
```
- ì—”í‹°í‹° íƒ€ì…ë„ ì—¬ëŸ¬ ê°’ì„ í•¨ê»˜ ì¡°íšŒí•  ìˆ˜ ìˆìŒ
```java
List<Object[]> resultList = 
        em.createQuery("SELECT o.member, o.product, o.orderAmount From Order o")
        .getResultList();
        
for(Object[] row : resultList) {
    Member member = (Member) row[0];    //ì—”í‹°í‹°
    Product product = (Product) row[1]; //ì—”í‹°í‹°
    int orderAmount = (Integer) row[2]; //ìŠ¤ì¹¼ë¼
}
```
- ë¬¼ë¡  ì´ë•Œë„ ì¡°íšŒí•œ ì—”í‹°í‹°ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬í•¨

ğŸ”½ NEW ëª…ë ¹ì–´
```java
List<Object[]> resultList = em.createQuery("SELECT m.username, m.age FROM Member m").getResultList();
        
//ê°ì²´ ë³€í™˜ ì‘ì—…
List<UserDTO> userDTOs = new ArrayList<UserDTO>();
for (Object[] row : resultList) {
    UserDTO userDTO = new UserDTO((String)row[0], (Integer)row[1]);
    userDTOs.add(userDTO);
}
return userDTOs;
```
```java
public class UserDTO {
    
    private String username;
    private int age;
    
    public UserDTO(String username, int age) {
        this.username = username;
        this.age = age;
    }
    
    //...
}
```
- username, age ë‘ í•„ë“œë¥¼ í”„ë¡œì ì…˜í•´ì„œ íƒ€ì…ì„ ì§€ì •í•  ìˆ˜ ì—†ë‹¤ë©´ TypeQueryë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ.
- ë”°ë¼ì„œ TypeQuery ì‚¬ìš© ë¶ˆê°€
    - Object[] ë°˜í™˜ë°›ìŒ
- ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì‹œ Object[] ì§ì ‘ ì‚¬ìš© X
    - UserDTOì²˜ëŸ¼ ì˜ë¯¸ ìˆëŠ” ê°ì²´ë¡œ ë³€í™˜ í›„ ì‚¬ìš©

- ìœ„ì™€ ê°™ì€ ê°ì²´ ë³€í™˜ ì‘ì—…ì€ ë¶ˆí¸ -> NEW ëª…ë ¹ì–´ ì‚¬ìš©í•˜ê¸°
```java
TypedQuery<UserDTO> query = 
    em.createQuery("SELECT new com.hasun.study.domain.member.UserDTO(m.username, m.age)
    FROM Member m", UserDTO.class);
        
List<UserDTO> resultList = query.getResultList();
```
- SELECT ë‹¤ìŒì— NEW ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ë°˜í™˜ë°›ì„ í´ë˜ìŠ¤ë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤.
    - ì´ í´ë˜ìŠ¤ì˜ ìƒì„±ìì— JPQL ì¡°íšŒ ê²°ê³¼ë¥¼ ë„˜ê²¨ì¤„ ìˆ˜ ìˆìŒ
- NEW ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•œ í´ë˜ìŠ¤ë¡œ TypeQuery ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

â— ì£¼ì˜
1. íŒ¨í‚¤ì§€ ëª…ì„ í¬í•¨í•œ ì „ì²´ í´ë˜ìŠ¤ ëª…ì„ ì…ë ¥
2. ìˆœì„œì™€ íƒ€ì…ì´ ì¼ì¹˜í•˜ëŠ” ìƒì„±ì í•„ìš”

### 10.2.4 í˜ì´ì§• API
- í˜ì´ì§•ì„ ì²˜ë¦¬í•˜ëŠ” SQL ë¬¸ë²•ì´ ë°ì´í„°ë² ì´ìŠ¤ë§ˆë‹¤ ë‹¤ë¥¸ ë¬¸ì œë¥¼ JPQLì„ ì‚¬ìš©í•˜ì—¬ í•´ê²°í•  ìˆ˜ ìˆìŒ
- JPAëŠ” í˜ì´ì§•ì„ ë‹¤ìŒ ë‘ APIë¡œ ì¶”ìƒí™”í–ˆìŒ
    - setFirstReulst(int startPostition): ì¡°íšŒ ì‹œì‘ ìœ„ì¹˜ (0ë¶€í„° ì‹œì‘)
    - setMaxResults(int maxResult): ì¡°íšŒí•  ë°ì´í„° ìˆ˜

```java
TypedQuery<Member> query = 
        em.createQuery("SELECT m FROM Member m ORDER BY m.username DESC", 
        Member.class);
        
query.setFirstResult(10);
query.setMaxResults(20);
query.getResultList();
```
- 10ë²ˆ ë¶€í„° ì‹œì‘í•´ì„œ ì´ 20ê±´ì˜ ë°ì´í„° ì¡°íšŒ
    - 11~30ë²ˆ ë°ì´í„° ì¡°íšŒ

### 10.2.5 ì§‘í•©ê³¼ ì •ë ¬
p367 ~ 369 ì°¸ê³ 

### 10.2.6 JPQL ì¡°ì¸
#### ë‚´ë¶€ ì¡°ì¸
- ë‚´ë¶€ ì¡°ì¸ì€ INNER JOINì„ ì‚¬ìš©í•¨ (INNER ìƒëµê°€ëŠ¥)
```java
String teamName = "íŒ€A";
String query = "SELECT m FROM Member m INNER JOIN m.team t " +
                "WHERE t.name = :teamName";
        
List<Member> members = em.createQuery(query, Member.class)
      .setParameter("teamName", teamName)
      .getResultList();
```
- ìƒì„±ëœ ë‚´ë¶€ ì¡°ì¸ SQL
```h2
SELECT
    M.ID AS ID,
    M.AGE AS AGE,
    M.TEAM_ID AS TEAM_ID,
    M.NAME AS NAME
FROM
    MEMBER M INNER JOIN TEAM T ON M.TEAM_ID=T.ID
WHERE
    T.NAME=?
```
- JPQL ì¡°ì¸ì˜ ê°€ì¥ í° íŠ¹ì§• -> ì—°ê´€ í•„ë“œë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒ
- ìœ„ ì½”ë“œì—ì„œ m.teamì´ ì—°ê´€ í•„ë“œ
    - ì—°ê´€ í•„ë“œëŠ” ë‹¤ë¥¸ ì—”í‹°í‹°ì™€ ì—°ê´€ê´€ê³„ë¥¼ ê°€ì§€ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” í•„ë“œë¥¼ ë§í•¨

- FROM Member m - íšŒì›ì„ ì„ íƒí•˜ê³  m ì´ë¼ëŠ” ë³„ì¹­ì„ ì¤Œ
- Member m JOIN m.team t - íšŒì›ì´ ê°€ì§€ê³  ìˆëŠ” ì—°ê´€ í•„ë“œë¡œ íŒ€ê³¼ ì¡°ì¸í•¨. ì¡°ì¸í•œ íŒ€ì—ëŠ” të¼ëŠ” ë³„ì¹­ì„ ì¤Œ
- ì°¸ê³ ) JPQL ì¡°ì¸ì„ ì•„ë˜ì™€ ê°™ì´ SQL ì¡°ì¸ì²˜ëŸ¼ ì‚¬ìš©í•˜ë©´ ë¬¸ë²• ì˜¤ë¥˜ ë°œìƒ
    - JPQLì€ JOIN ëª…ë ¹ì–´ ë‹¤ìŒì— ì¡°ì¸í•  ê°ì²´ì˜ ì—°ê´€ í•„ë“œë¥¼ ì‚¬ìš©í•¨
```java
FROM Member m JOIN Team t   //ì˜ëª»ëœ JPQL ì¡°ì¸, ì˜¤ë¥˜!
```

- ì¡°ì¸ ê²°ê³¼ í™œìš©
```jpaql
SELECT m.username, t.name
FROM Member m JOIN m.team t
WHERE t.name = 'íŒ€A'
ORDER BY m.age DESC
```
- ì¿¼ë¦¬ëŠ” 'íŒ€A'ì†Œì†ì¸ íšŒì›ì„ ë‚˜ì´ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬ -> íšŒì›ëª…ê³¼ íŒ€ëª…ì„ ì¡°íšŒí•¨
- ë§Œì•½ ì¡°ì¸í•œ ë‘ ê°œì˜ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ë ¤ë©° ë‹¤ìŒê³¼ ê°™ì´ JPQLì„ ì‘ì„±

```jpaql
SELECT m, t
FROM Member m JOIN m.team t
```

- ì„œë¡œ ë‹¤ë¥¸ íƒ€ì…ì˜ ë‘ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí–ˆìœ¼ë¯€ë¡œ TypeQueryë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ
- ë”°ë¼ì„œ ë‹¤ìŒì²˜ëŸ¼ ì¡°íšŒí•´ì•¼ í•¨

```java
String query = "SELECT m, t FROM Member m JOIN m.team t";
List<Object[]> result = em.createQuery(query).getResultList();

for(Object[] row : result) {
    Member member = (Member) row[0];
    Team team = (Team) row[1];
}
```

#### ì™¸ë¶€ ì¡°ì¸
```jpaql
SELECT m
FROM Member m LEFT [OUTER] JOIN m.team t
```
- ì™¸ë¶€ ì¡°ì¸ì€ ê¸°ëŠ¥ìƒ SQLì˜ ì™¸ë¶€ ì¡°ì¸ê³¼ ê°™ìŒ
- OUTERëŠ” ìƒëµ ê°€ëŠ¥í•´ì„œ ë³´í†µ LEFT JOINìœ¼ë¡œ ì‚¬ìš©í•¨

#### ì»¬ë ‰ì…˜ ì¡°ì¸
- ì¼ëŒ€ë‹¤ ê´€ê³„ë‚˜ ë‹¤ëŒ€ë‹¤ ê´€ê³„ì²˜ëŸ¼ ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ê³³ì— ì¡°ì¸í•˜ëŠ” ê²ƒ
- [íšŒì› -> íŒ€]ìœ¼ë¡œì˜ ì¡°ì¸ì€ ë‹¤ëŒ€ì¼ ì¡°ì¸ì´ë©´ì„œ ë‹¨ì¼ ê°’ ì—°ê´€ í•„ë“œ(m.team)ë¥¼ ì‚¬ìš©
- [íŒ€ -> íšŒì›]ì€ ë°˜ëŒ€ë¡œ ì¼ëŒ€ë‹¤ ì¡°ì¸ì´ë©´ì„œ ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ í•„ë“œ(m.members)ë¥¼ ì‚¬ìš©

```jpaql
SELECT t, m FROM Team t LEFT JOIN t.members m
```
- ì—¬ê¸°ì„œ t LEFT JOIN t.membersëŠ” íŒ€ê³¼ íŒ€ì´ ë³´ìœ í•œ íšŒì›ëª©ë¡ì„ ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ í•„ë“œë¡œ ì™¸ë¶€ ì¡°ì¸í–ˆë‹¤.

#### ì„¸íƒ€ ì¡°ì¸
- WHERE ì ˆì„ ì‚¬ìš©í•´ì„œ ì„¸íƒ€ ì¡°ì¸ì„ í•  ìˆ˜ ìˆìŒ
- ì°¸ê³ ë¡œ ì„¸íƒ€ ì¡°ì¸ì€ ë‚´ë¶€ ì¡°ì¸ë§Œ ì§€ì›í•¨.
- ì„¸íƒ€ ì¡°ì¸ì„ ì‚¬ìš©í•˜ë©´ ì „í˜€ ê´€ê³„ì—†ëŠ” ì—”í‹°í‹°ë„ ì¡°ì¸í•  ìˆ˜ ìˆìŒ

```jpaql
//íšŒì› ì´ë¦„ì´ íŒ€ ì´ë¦„ê³¼ ë˜‘ê°™ì€ ì‚¬ëŒ ìˆ˜ë¥¼ êµ¬í•˜ëŠ” ì˜ˆ
//JPQL
select count (m) from Member m, Team t
where m.username = t.name

//SQL
SELECT COUNT(M.ID)
FROM
    MEMBER M CROSS JOIN TEAM T
WHERE
    M.USERNAME=T.NAME    
```

#### JOIN ON ì ˆ(JPA 2.1)
- ON ì ˆì„ ì‚¬ìš©í•˜ë©´ ì¡°ì¸ ëŒ€ìƒì„ í•„í„°ë§í•˜ê³  ì¡°ì¸í•  ìˆ˜ ìˆìŒ
- ì°¸ê³ ë¡œ ë‚´ë¶€ ì¡°ì¸ì˜ ON ì ˆì€ WHERE ì ˆì„ ì‚¬ìš©í•  ë–„ì™€ ê²°ê³¼ê°€ ê°™ìœ¼ë¯€ë¡œ ë³´í†µ ON ì ˆì€ ì™¸ë¶€ ì¡°ì¸ì—ì„œë§Œ ì‚¬ìš©í•¨

```jpaql
//JPQL
select m, t from Member m
left join m.team t on t.name = 'A'

//SQL
SELECT m.*, t.* FROM Member m
LEFT JOIN Team t ON m.TEAM_ID=t.id and t.name='A'
```
- ëª¨ë“  íšŒì›ì„ ì¡°íšŒí•˜ë©´ì„œ íšŒì›ê³¼ ì—°ê´€ëœ íŒ€ë„ ì¡°íšŒ, ì´ë•Œ íŒ€ì€ ì´ë¦„ì´ 'A'ì¸ íŒ€ë§Œ ì¡°íšŒ


### 10.2.7 í˜ì¹˜ ì¡°ì¸
- í˜ì¹˜ ì¡°ì¸ì€ SQLì—ì„œ ì´ì•¼ê¸°í•˜ëŠ” ì¡°ì¸ì˜ ì¢…ë¥˜ X
- JPQLì—ì„œ ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥
- ì—°ê´€ëœ ì—”í‹°í‹°ë‚˜ ì»¬ë ‰ì…˜ì„ í•œ ë²ˆì— ê°™ì´ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥
- join fetch ëª…ë ¹ì–´ë¡œ ì‚¬ìš©
```jpaql
í˜ì¹˜ ì¡°ì¸ ::= [ LEFT [OUTER] | INNER ] JOIN FETCH ì¡°ì¸ê²½ë¡œ
```

#### ì—”í‹°í‹° í˜ì¹˜ ì¡°ì¸
- í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•´ì„œ íšŒì› ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ë©´ì„œ ì—°ê´€ëœ íŒ€ ì—”í‹°í‹°ë„ í•¨ê»˜ ì¡°íšŒí•˜ëŠ” JPQL
```jpaql
select m
from Member m join fetch m.team
```
- ì´ë ‡ê²Œ í•˜ë©´ ì—°ê´€ëœ ì—”í‹°í‹°ë‚˜ ì»¬ë ‰ì…˜ì„ í•¨ê»˜ ì¡°íšŒí•¨
- ì—¬ê¸°ì„  íšŒì›(m)ê³¼ íŒ€(m.team)ì„ í•¨ê»˜ ì¡°íšŒ
- í˜ì¹˜ ì¡°ì¸ì€ ë³„ì¹­ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

- ì‹¤í–‰ëœ SQL
```h2
SELECT
    M.*, T.*
FROM MEMBER T
INNER JOIN TEAM T ON M.TEAM_ID=T.ID
```


![img.png](img/ì—”í‹°í‹°_í˜ì¹˜_ì¡°ì¸ì‹œë„.png)
![img_1.png](img/ì—”í‹°í‹°_í˜ì¹˜_ì¡°ì¸_ê²°ê³¼_í…Œì´ë¸”.png)
![img_2.png](img/ì—”í‹°í‹°_í˜ì¹˜_ì¡°ì¸_ê²°ê³¼_ê°ì²´.png)

- ì—”í‹°í‹° í˜ì¹˜ ì¡°ì¸ JPQLì—ì„œ select mìœ¼ë¡œ íšŒì› ì—”í‹°í‹°ë§Œ ì„ íƒí–ˆëŠ”ë°
  ì‹¤í–‰ëœ SQLì—ì„œëŠ” SELECT M.* T.*ë¡œ íšŒì›ê³¼ ì—°ê´€ëœ íŒ€ë„ í•¨ê»˜ ì¡°íšŒí•¨.

- ê·¸ë¦¼ 10.5 ì—ì„œëŠ” íšŒì›ê³¼ íŒ€ ê°ì²´ê°€ ê°ì²´ ê·¸ë˜í”„ë¥¼ ìœ ì§€í•˜ë©´ì„œ ì¡°íšŒëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ.
```java
String jpql = "select m from Member m join fetch m.team";
        
List<Member> members = em.createQuery(jpql, Member.class).getResultList();
        
for (Member member : members) {
    //í˜ì¹˜ ì¡°ì¸ìœ¼ë¡œ íšŒì›ê³¼ íŒ€ì„ í•¨ê»˜ ì¡°íšŒí•´ì„œ ì§€ì—° ë¡œë”© ë°œìƒ ì•ˆí•¨
    System.out.println("username = "+member.getUsername()+", " +
}
```
- ì¶œë ¥ ê²°ê³¼
```java
username = íšŒì›1, teamname = íŒ€A
username = íšŒì›2, teamname = íŒ€A
username = íšŒì›3, teamname = íŒ€B
```

#### ì»¬ë ‰ì…˜ í˜ì¹˜ ì¡°ì¸
- ì¼ëŒ€ë‹¤ ê´€ê³„ì¸ ì»¬ë ‰ì…˜ì„ í˜ì¹˜ ì¡°ì¸í•´ë³´ì
```jpaql
select t
from Team t join fetch t.members
where t.name = 'íŒ€A'
```
- íŒ€(t)ì„ ì¡°íšŒí•˜ë©´ì„œ í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•´ì„œ ì—°ê´€ëœ íšŒì› ì»¬ë ‰ì…˜(t.members)ë„ í•¨ê»˜ ì¡°íšŒí•¨
```h2
SELECT T.*, M.*
FROM TEAM T 
INNER JOIN MEMBER M ON T.ID=M.TEAM_ID
WHERE T.NAME = 'íŒ€A'
```
![img_3.png](img/ì»¬ë ‰ì…˜_í˜ì¹˜_ì¡°ì¸_ì‹œë„.png)
![img_4.png](img/ì»¬ë ‰ì…˜_í˜ì¹˜_ì¡°ì¸_ê²°ê³¼_í…Œì´ë¸”.png)
![img_5.png](img/ì»¬ë ‰ì…˜_í˜ì¹˜_ì¡°ì¸_ê²°ê³¼_ê°ì²´.png)

- ì»¬ë ‰ì…˜ì„ í˜ì¹˜ ì¡°ì¸í•œ JPQLì—ì„œ select të¡œ íŒ€ë§Œ ì„ íƒí–ˆëŠ”ë° ì˜ˆì œì˜ ì‹¤í–‰ëœ SQLì„ ë³´ë©´
  T.*. M.*ë¡œ íŒ€ê³¼ ì—°ê´€ëœ íšŒì›ë„ í•¨ê»˜ ì¡°íšŒí•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ.

- ë˜ ê·¸ë¦¼ 10.6ì˜ TEAM í…Œì´ë¸”ì—ì„œ 'íŒ€A'ëŠ” í•˜ë‚˜ì§€ë§Œ MEMBERí…Œì´ë¸”ê³¼ ì¡°ì¸í•˜ë©´ì„œ
  ê²°ê³¼ê°€ ì¦ê°€í•˜ì—¬ ê·¸ë¦¼ 10.7ì˜ ì¡°ì¸ ê²°ê³¼ í…Œì´ë¸”ì„ ë³´ë©´ ê°™ì€ 'íŒ€A'ê°€ 2ê±´ ì¡°íšŒë˜ì—ˆìŒ

- ë”°ë¼ì„œ ê·¸ë¦¼ 10.8ì˜ ì»¬ë ‰ì…˜ íŒ¨ì¹˜ ì¡°ì¸ ê²°ê³¼ ê°ì²´ì—ì„œ teams ê²°ê³¼ ì˜ˆì œë¥¼ ë³´ë©´ ì£¼ì†Œê°€ 0x100ìœ¼ë¡œ ê°™ì€ 'íŒ€A'ë¥¼ 2ê±´ ê°€ì§€ê²Œ ë¨
```java
String jpql = "select t from Team t join fetch t.members where t.name = 'íŒ€A'";
List<Team> teams = em.createQuery(jpql, Team.class).getResultList();
        
for (Team team : teams) {

System.out.println("teamname = "+team.getName() + ", team = "+team);
            
    for (Member member : team.getMember()) {
                    
    //í˜ì¹˜ ì¡°ì¸ìœ¼ë¡œ íŒ€ê³¼ íšŒì›ì„ í•¨ê»˜ ì¡°íšŒí•´ì„œ ì§€ì—° ë¡œë”© ë°œìƒ ì•ˆ í•¨
    System.out.println("->username = "+member.getUsername()+", member = "+member);
    }
}
```

- ì¶œë ¥ ê²°ê³¼
```java
teamname = íŒ€A, team = Team@0x100
->username = íšŒì›1, member = Member@0x200
->username = íšŒì›2, member = Member@0x300
teamname = íŒ€A, team = Team@0x100
->username = íšŒì›1, member = Member@0x200
->username = íšŒì›2, member = Member@0x300
```
- ì¶œë ¥ ê²°ê³¼ë¥¼ ë³´ë©´ ê°™ì€ 'íŒ€A'ê°€ 2ê±´ ì¡°íšŒëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

#### í˜ì¹˜ ì¡°ì¸ê³¼ DISTINCT
- DISTINCTëŠ” ì¤‘ë³µëœ ê²°ê³¼ë¥¼ ì œê±°í•˜ëŠ” ëª…ë ¹
- JPQLì˜ DISTINCT ëª…ë ¹ì–´ëŠ” SQLì— DISTINCTë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì€ ë¬¼ë¡ ì´ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ í•œ ë²ˆ ë” ì¤‘ë³µì„ ì œê±°í•¨
```jpaql
select distinct t 
from Team t join fetch t.members
where t.name = 'íŒ€A'
```
- ë¨¼ì € DISTINCTë¥¼ ì‚¬ìš©í•˜ë©´ SQLì— SELECT DISTINCTê°€ ì¶”ê°€ë¨
- í•˜ì§€ë§Œ ì§€ê¸ˆì€ ê° ë¡œìš°ì˜ ë°ì´í„°ê°€ ë‹¤ë¥´ë¯€ë¡œ SQLì˜ DISTINCTëŠ” íš¨ê³¼ê°€ ì—†ìŒ
- ë‹¤ìŒìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ distinct ëª…ë ¹ì–´ë¥¼ ë³´ê³  ì¤‘ë³µëœ ë°ì´í„°ë¥¼ ê±¸ëŸ¬ëƒ„
- select distinct tì˜ ì˜ë¯¸ëŠ” íŒ€ ì—”í‹°í‹°ì˜ ì¤‘ë³µì„ ì œê±°í•˜ë¼ëŠ” ê²ƒ.
- ë”°ë¼ì„œ ì¤‘ë³µì¸ íŒ€AëŠ” í•˜ë‚˜ë§Œ ì¡°íšŒëœë‹¤.

![img_6.png](img/í˜ì¹˜_ì¡°ì¸_DISTINCT_ê²°ê³¼.png)


#### í˜ì¹˜ ì¡°ì¸ì˜ íŠ¹ì§•ê³¼ í•œê³„
- í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•˜ë©´ SQL í•œ ë²ˆìœ¼ë¡œ ì—°ê´€ëœ ì—”í‹°í‹°ë“¤ì„ í•¨ê»˜ ì¡°íšŒí•  ìˆ˜ ìˆì–´ì„œ SQL í˜¸ì¶œ íšŸìˆ˜ë¥¼ ì¤„ì—¬ ì„±ëŠ¥ì„ ìµœì í™”í•  ìˆ˜ ìˆìŒ
- ë‹¤ìŒì²˜ëŸ¼ ì—”í‹°í‹°ì— ì§ì ‘ ì ìš©í•˜ëŠ” ë¡œë”© ì „ëµì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì— ì˜í–¥ì„ ë¯¸ì¹˜ë¯€ë¡œ ê¸€ë¡œë²Œ ë¡œë”© ì „ëµì´ë¼ ë¶€ë¦„
- í˜ì¹˜ ì¡°ì¸ì€ ê¸€ë¡œë²Œ ë¡œë”© ì „ëµë³´ë‹¤ ìš°ì„ í•¨
- ì˜ˆë¥¼ ë“¤ì–´ ê¸€ë¡œë²Œ ë¡œë”© ì „ëµì„ ì§€ì—° ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•´ë„ JPQLì—ì„œ í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•˜ë©´ í˜ì¹˜ ì¡°ì¸ì„ ì ìš©í•´ì„œ í•¨ê»˜ ì¡°íšŒí•¨
```java
@OneToMany(fetch = FetchType.LAZY)  //ê¸€ë¡œë²Œ ë¡œë”© ì „ëµ
```

- ìµœì í™”ë¥¼ ìœ„í•´ ê¸€ë¡œë²Œ ë¡œë”© ì „ëµì„ ì¦‰ì‹œ ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ í•­ìƒ ì¦‰ì‹œ ë¡œë”©ì´ ì¼ì–´ë‚¨.
- ì¼ë¶€ëŠ” ë¹ ë¥¼ ìˆ˜ëŠ” ìˆì§€ë§Œ ì „ì²´ë¡œ ë³´ë©´ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì—”í‹°í‹°ë¥¼ ìì£¼ ë¡œë”©í•˜ë¯€ë¡œ
  ì„±ëŠ¥ì— ì•…ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆìŒ
    - ë”°ë¼ì„œ ê¸€ë¡œë²Œ ë¡œë”© ì „ëµì€ ë  ìˆ˜ ìˆìœ¼ë©´ ì§€ì—° ë¡œë”©ì„ ì‚¬ìš©
    - ìµœì í™”ê°€ í•„ìš”í•˜ë©´ í˜ì¹˜ ì¡°ì¸ì„ ì ìš©í•˜ëŠ” ê²ƒì´ íš¨ê³¼ì 

- ë˜í•œ í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•˜ë©´ ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì¿¼ë¦¬ ì‹œì ì— ì¡°íšŒí•˜ë¯€ë¡œ
  ì§€ì—° ë¡œë”©ì´ ë°œìƒí•˜ì§€ ì•ŠìŒ
    - ë”°ë¼ì„œ ì¤€ì˜ì† ìƒíƒœì—ì„œë„ ê°ì²´ ê·¸ë˜í”„ë¥¼ íƒìƒ‰í•  ìˆ˜ ìˆìŒ

#### í˜ì¹˜ ì¡°ì¸ì˜ í•œê³„
- í˜ì¹˜ ì¡°ì¸ ëŒ€ìƒì—ëŠ” ë³„ì¹­ì„ ì¤„ ìˆ˜ ì—†ë‹¤
- ë‘˜ ì´ìƒì˜ ì»¬ë ‰ì…˜ì„ í˜ì¹˜í•  ìˆ˜ ì—†ë‹¤
- ì»¬ë ‰ì…˜ì„ í˜ì¹˜ ì¡°ì¸í•˜ë©´ í˜ì´ì§• APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤

- ì—¬ëŸ¬ í…Œì´ë¸”ì„ ì¡°ì¸í•´ì„œ ì—”í‹°í‹°ê°€ ê°€ì§„ ëª¨ì–‘ì´ ì•„ë‹Œ ì „í˜€ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ë‚´ì•¼ í•œë‹¤ë©´?
    - ì–µì§€ë¡œ í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•˜ê¸°ë³´ë‹¤ëŠ” ì—¬ëŸ¬ í…Œì´ë¸”ì—ì„œ í•„ìš”í•œ í•„ë“œë“¤ë§Œ ì¡°íšŒí•´ì„œ DTOë¡œ ë°˜í™˜í•˜ëŠ” ê²ƒì´ ë” íš¨ê³¼ì ì„.
  

### 10.2.8 ê²½ë¡œ í‘œí˜„ì‹
- .(ì )ì„ ì°ì–´ ê°ì²´ ê·¸ë˜í”„ë¥¼ íƒìƒ‰í•˜ëŠ” ê²ƒ
```jpaql
select m.username
from Member m
    join m.team t
    join m.orders o
where t.name = 'íŒ€A'    
```
- m.username, m.team, m.orders, t.name ì´ ê²½ë¡œ í‘œí˜„ì‹ì´ë‹¤.

#### ê²½ë¡œ í‘œí˜„ì‹ì˜ ìš©ì–´ ì •ë¦¬
- ìƒíƒœ í•„ë“œ : ê°’ì„ ì €ì¥í•˜ê¸° ìœ„í•œ í•„ë“œ (í•„ë“œ or í”„ë¡œí¼í‹°)
- ì—°ê´€ í•„ë“œ : ì—°ê´€ê´€ê³„ë¥¼ ìœ„í•œ í•„ë“œ, ì„ë² ë””ë“œ íƒ€ì… í¬í•¨ (í•„ë“œ or í”„ë¡œí¼í‹°)
  - ë‹¨ì¼ ê°’ ì—°ê´€ í•„ë“œ : @ManyToOne, @OneToOne, ëŒ€ìƒì´ ì—”í‹°í‹°
  - ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ í•„ë“œ : @OneToMany, @ManyToMany, ëŒ€ìƒì´ ì»¬ë ‰ì…˜
  
#### ê²½ë¡œ í‘œí˜„ì‹ê³¼ íŠ¹ì§•
- JPQLì—ì„œ ê²½ë¡œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ ê²½ë¡œ íƒìƒ‰ì„ í•˜ë ¤ë©´ ë‹¤ìŒ 3ê°€ì§€ ê²½ë¡œì— ë”°ë¼
ì–´ë–¤ íŠ¹ì§•ì´ ìˆëŠ”ì§€ ì´í•´í•´ì•¼ í•¨
  - ìƒíƒœ í•„ë“œ ê²½ë¡œ: ê²½ë¡œ íƒìƒ‰ì˜ ë. ë”ëŠ” íƒìƒ‰í•  ìˆ˜ ì—†ìŒ
      - ì˜ˆ) select m.username, m.age from Member m
        - m.username, m.age -> ìƒíƒœ í•„ë“œ ê²½ë¡œ íƒìƒ‰
  - ë‹¨ì¼ ê°’ ì—°ê´€ ê²½ë¡œ: ë¬µì‹œì ìœ¼ë¡œ ë‚´ë¶€ ì¡°ì¸ì´ ì¼ì–´ë‚¨. ë‹¨ì¼ ê°’ ì—°ê´€ ê²½ë¡œëŠ” ê³„ì† íƒìƒ‰ ê°€ëŠ¥
  - ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ ê²½ë¡œ: ë¬µì‹œì ìœ¼ë¡œ ë‚´ë¶€ ì¡°ì¸ì´ ì¼ì–´ë‚¨. ë”ëŠ” íƒìƒ‰í•  ìˆ˜ ì—†ìŒ.
    - ë‹¨ FROM ì ˆì—ì„œ ì¡°ì¸ì„ í†µí•´ ë³„ì¹­ì„ ì–»ìœ¼ë©´ ë³„ì¹­ìœ¼ë¡œ íƒìƒ‰ ê°€ëŠ¥
  
#### ë‹¨ì¼ ê°’ ì—°ê´€ ê²½ë¡œ íƒìƒ‰
- select o.member from Order o
  - JPQLì„ ì‹¤í–‰í•œ ê²°ê³¼ >
```sql
select m.* 
from Orders o
    inner join Member m on o.member_id = m.id
```
- ë¬µì‹œì  ì¡°ì¸
  - ìœ„ì™€ ê°™ì´ ë‹¨ì¼ ê°’ ì—°ê´€ í•„ë“œë¡œ ê²½ë¡œ íƒìƒ‰ì„ í•  ì‹œ SQLì—ì„œ ë‚´ë¶€ ì¡°ì¸ì´ ì¼ì–´ë‚¨
    - ì˜ˆ) select m.team from Member m
- ëª…ì‹œì  ì¡°ì¸
  - JOINì„ ì§ì ‘ ì ì–´ì£¼ëŠ” ê²ƒ
    - ì˜ˆ) select m from Member m Join m.team t
  
```jpaql
select o.member.team
from Order o
where o.product.name = 'productA' and o.address.city = 'JINJU'
```
- ì£¼ë¬¸ ì¤‘ì—ì„œ ìƒí’ˆëª…ì´ 'productA', ë°°ì†¡ì§€ê°€ 'JINJU'ì¸ íšŒì›ì´ ì†Œì†ëœ íŒ€ì„ ì¡°íšŒí•˜ëŠ” ì˜ˆì‹œ

ğŸ”½ ì‹¤í–‰ëœ SQL
```sql
select t.*
from Orders o
inner join Member m on o.member_id = m.id
inner join Team t on o.team_id = t.id
inner join Product p on o.product_id = p.id
where p.name = 'productA' and o.city = 'JINJU'
```  

#### ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ ê²½ë¡œ íƒìƒ‰
```jpaql
select t.members from Team t; //ì„±ê³µ
select t.members.username from Team t; //ì‹¤íŒ¨
```
- ì»¬ë ‰ì…˜ê¹Œì§€ëŠ” ê²½ë¡œ íƒìƒ‰ì´ ê°€ëŠ¥í•˜ë‚˜, ì•„ë˜ ì‹¤íŒ¨ ì½”ë“œ ì²˜ëŸ¼
ì»¬ë ‰ì…˜ì—ì„œ ê²½ë¡œ íƒìƒ‰ì„ ì‹œì‘í•˜ëŠ” ê²ƒì€ í—ˆë½í•˜ì§€ ì•ŠìŒ.
  
- ì»¬ë ‰ì…˜ì—ì„œ ê²½ë¡œ íƒìƒ‰ì´ í•„ìš”í•˜ë‹¤ë©´?
```jpaql
select m.username from Team t join t.members m
```
- ì¡°ì¸ì„ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ ë³„ì¹­ì„ íšë“í•´ì•¼ í•¨

- ì°¸ê³ ) ì»¬ë ‰ì…˜ì€ ì»¬ë ‰ì…˜ì˜ í¬ê¸°ë¥¼ êµ¬í•  ìˆ˜ ìˆëŠ” sizeë¼ëŠ” ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥
  - size -> COUNT í•¨ìˆ˜ SQLë¡œ ë³€í™˜
```jpaql
select t.members.size from Team t
```  

#### ê²½ë¡œ íƒìƒ‰ì„ ì‚¬ìš©í•œ ë¬µì‹œì  ì¡°ì¸ ì‹œ ì£¼ì˜ì‚¬í•­
- í•­ìƒ ë‚´ë¶€ ì¡°ì¸ì„
- ì»¬ë ‰ì…˜ì€ ê²½ë¡œ íƒìƒ‰ì˜ ë. ì»¬ë ‰ì…˜ì—ì„œ ê²½ë¡œ íƒìƒ‰ì„ í•˜ê¸° ìœ„í•´ì„  ëª…ì‹œì ìœ¼ë¡œ ì¡°ì¸í•´ì„œ ë³„ì¹­ì„ ì–»ì–´ì•¼ í•¨
- ê²½ë¡œ íƒìƒ‰ì€ ì£¼ë¡œ SELECT, WHERE ì ˆì—ì„œ ì‚¬ìš©í•˜ì§€ë§Œ ë¬µì‹œì  ì¡°ì¸ìœ¼ë¡œ ì¸í•´ SQLì˜ FROM ì ˆì— ì˜í–¥ì„ ì¤Œ

- ë¬µì‹œì  ì¡°ì¸ì€ ì¡°ì¸ì´ ì¼ì–´ë‚˜ëŠ” ìƒí™©ì„ í•œëˆˆì— íŒŒì•…í•˜ê¸° ì–´ë ¤ì›€
- ì„±ëŠ¥ì´ ì¤‘ìš”í•˜ë©´ ë¶„ì„í•˜ê¸° ì‰½ë„ë¡ ë¬µì‹œì  ì¡°ì¸ë³´ë‹¤ëŠ” ëª…ì‹œì  ì¡°ì¸ì„ ì‚¬ìš©í•˜ì


### 10.2.9 ì„œë¸Œì¿¼ë¦¬
- JPQLì˜ ì„œë¸Œì¿¼ë¦¬ëŠ” WHERE, HAVING ì ˆì—ì„œë§Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•¨
- FROM ì ˆì—ì„œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

ğŸ”½ EXITS
- ë¬¸ë²• ğŸ‘‰ [NOT] EXISTS (subquery)
- ì„œë¸Œì¿¼ë¦¬ì— ê²°ê³¼ê°€ ì¡´ì¬í•˜ë©´ ì°¸. NOTì€ ë°˜ëŒ€
- ì˜ˆ) íŒ€A ì†Œì†ì¸ íšŒì›
```jpaql
select m from Member m
where exists (select t from m.team t where t.name = 'íŒ€A')
```

ğŸ”½ {ALL | ANY | SOME}
- ë¬¸ë²• ğŸ‘‰ {ALL | ANY | SOME} (subquery)
- ë¹„êµ ì—°ì‚°ìì™€ ê°™ì´ ì‚¬ìš© {= | > | >= | < | <= | <>}
  - ALL: ì¡°ê±´ì„ ëª¨ë‘ ë§Œì¡±í•˜ë©´ ì°¸
  - ANY or SOME: ë‘˜ì€ ê°™ì€ ì˜ë¯¸. ì¡°ê±´ì„ í•˜ë‚˜ë¼ë„ ë§Œì¡±í•˜ë©´ ì°¸
- ì˜ˆ) ì „ì²´ ìƒí’ˆ ê°ê°ì˜ ì¬ê³ ë³´ë‹¤ ì£¼ë¬¸ëŸ‰ì´ ë§ì€ ì£¼ë¬¸ë“¤
```jpaql
select o from Order o
where o.orderAmount > ALL (select p.stockAmount from Product p)
```
- ì˜ˆ) ì–´ë–¤ íŒ€ì´ë“  íŒ€ì— ì†Œì†ëœ íšŒì›
```jpaql
select m from Member m
where m.team = ANY (select t from Team t)
```

ğŸ”½ IN
- ë¬¸ë²• ğŸ‘‰ [NOT] IN (subquery)
- ì„œë¸Œì¿¼ë¦¬ì˜ ê²°ê³¼ ì¤‘ í•˜ë‚˜ë¼ë„ ê°™ì€ ê²ƒì´ ìˆìœ¼ë©´ ì°¸.
- ì°¸ê³ ) ì„œë¸Œì¿¼ë¦¬ê°€ ì•„ë‹Œ ê³³ì—ì„œë„ ì‚¬ìš©ë¨
- ì˜ˆ) 20ì„¸ ì´ìƒì„ ë³´ìœ í•œ íŒ€
```jpaql
select t from Team t
where t IN (select t2 From Team t2 JOIN t2.members m2 where m2.age >= 20)
```


### 10.2.10 ì¡°ê±´ì‹
- ì—°ì‚°ì ìš°ì„  ìˆœìœ„
- ë…¼ë¦¬ ì—°ì‚°ê³¼ ë¹„êµì‹
- Between, IN, Like, NULL ë¹„êµ
- ì»¬ë ‰ì…˜ ì‹
- ìŠ¤ì¹¼ë¼ ì‹
- CASE ì‹
p.388 ~ p.396

### 10.2.11 ë‹¤í˜•ì„± ì¿¼ë¦¬
- JPQLë¡œ ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ë©´ ê·¸ ìì‹ ì—”í‹°í‹°ë„ í•¨ê»˜ ì¡°íšŒ
```java
List resultList = em.createQuery("select i from Item i").getResultList();
```
- ë‹¨ì¼ í…Œì´ë¸” ì „ëµ ì‚¬ìš© ì‹œ ì‹¤í–‰ëœ SQL
```sql
SELECT * FROM ITEM
```
- ì¡°ì¸ ì „ëµ ì‚¬ìš© ì‹œ ì‹¤í–‰ëœ SQL
```sql
SELECT
    i.ITEM_ID, i.DTYPE, i.name, i.price, i.stockQuantity,
    b.author, b.isbn,
    a.artist, a.etc,
    m.actor, m.director
FROM
    Item i
left outer join
    Book b on i.ITEM_ID=b.ITEM_ID
left outer join
    Album a on i.ITEM_ID=a.ITEM_ID
left outer join
    MOVIE m on i.ITEM_ID=m.ITEM_ID
```

#### TYPE
- ì—”í‹°í‹°ì˜ ìƒì† êµ¬ì¡°ì—ì„œ ì¡°íšŒ ëŒ€ìƒì„ íŠ¹ì • ìì‹ íƒ€ì…ìœ¼ë¡œ í•œì •í•  ë•Œ ì£¼ë¡œ ì‚¬ìš©
- ì˜ˆ) Item ì¤‘ì— Book, Movie ì¡°íšŒ
```jpaql
//JPQL
select i from Item i
where type(i) IN (Book, Movie)
```
```sql
//SQL
SELECT i FROM Item i
WHERE i.DTYPE in ('B', 'N')
```

#### TREAT(JPA 2.1)
- ìë°”ì˜ íƒ€ì… ìºìŠ¤íŒ…ê³¼ ë¹„ìŠ·
- ìƒì† êµ¬ì¡°ì—ì„œ ë¶€ëª¨ íƒ€ì…ì„ íŠ¹ì • ìì‹ íƒ€ì…ìœ¼ë¡œ ë‹¤ë£° ë•Œ ì‚¬ìš©
- JPA í‘œì¤€ì€ FROM , WHEREì ˆì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ,
í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” SELECT ì ˆì—ì„œë„ TREAT ì‚¬ìš©ê°€ëŠ¥
  
- ì˜ˆ) ë¶€ëª¨ì¸ Item ìì‹ì¸ Book
```jpaql
//JPQL
select i from Item i where treat(i as Book).author = 'kim'
```
```sql
//SQL
select i.* from Item i
where
    i.DTYPE = 'B'
    and i.author = 'kim'
```

### 10.2.12 ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ í˜¸ì¶œ
- ë¬¸ë²• ğŸ‘‰ function_invocation::= FUNCTION(function_name (, function_arg)*)
- ì˜ˆ) select function("group_concat", i.name) from Item i

- í•˜ì´ë²„ë„¤ì´íŠ¸ êµ¬í˜„ì²´ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë°©ì–¸ í´ë˜ìŠ¤ë¥¼ ìƒì†í•´ì„œ êµ¬í˜„í•˜ê³ 
ì‚¬ìš©í•  ë°ì´í„°ë² ì´ìŠ¤ í•¨ìˆ˜ë¥¼ ë¯¸ë¦¬ ë“±ë¡í•´ì•¼ í•¨
  
- p.398 - 399 ì°¸ê³ 

### 10.2.13 ê¸°íƒ€ ì •ë¦¬
- enumì€ = ë¹„êµ ì—°ì‚°ë§Œ ì§€ì›
- ì„ë² ë””ë“œ íƒ€ì…ì€ ë¹„êµ ì§€ì› X

#### EMPTY STRING
- ë°ì´í„°ë² ì´ìŠ¤ì— ë”°ë¼ '' -> NULL í˜¹ì€ ê¸¸ì´ 0ì¸ Empty String

#### NULL ì •ì˜
- ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë°ì´í„°ê°€ í•˜ë‚˜ë„ ì—†ìŒ
- NULLê³¼ì˜ ëª¨ë“  ìˆ˜í•™ì  ê³„ì‚° ê²°ê³¼ëŠ” NULL
- Null == Null -> ì•Œ ìˆ˜ ì—†ëŠ” ê°’
- Null is Null -> ì°¸

### 10.2.14 ì—”í‹°í‹° ì§ì ‘ ì‚¬ìš©
#### ê¸°ë³¸ í‚¤ ê°’
- ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ : ì°¸ì¡° ê°’ìœ¼ë¡œ ì‹ë³„
- í…Œì´ë¸” ë¡œìš° : ê¸°ë³¸ í‚¤ ê°’ìœ¼ë¡œ ì‹ë³„
- JPQLì—ì„œ ì—”í‹°í‹° ê°ì²´ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ë©´ SQLì—ì„œëŠ” í•´ë‹¹ ì—”í‹°í‹°ì˜ ê¸°ë³¸ í‚¤ê°’ì„ ì‚¬ìš©
```sql
select count(m.id) from Member m    //ì—”í‹°í‹°ì˜ ì•„ì´ë””ë¥¼ ì‚¬ìš©
select count(m) from Member m       //ì—”í‹°í‹°ë¥¼ ì§ì ‘ ì‚¬ìš©
```
- ì—”í‹°í‹° ì§ì ‘ ì‚¬ìš© ì‹œ JPQL-> SQL ë³€í™˜ ê³¼ì •ì—ì„œ ì—”í‹°í‹°ì˜ ê¸°ë³¸ í‚¤ë¥¼ ì‚¬ìš©í•¨
- ë”°ë¼ì„œ ì‹¤ì œ ì‹¤í–‰ëœ SQLì€ ë‘˜ ë‹¤ ê°™ìŒ

### 10.2.15 Named ì¿¼ë¦¬: ì •ì  ì¿¼ë¦¬
- ë™ì  ì¿¼ë¦¬: em.createQuery("select ..") -> JPQLì„ ë¬¸ìë¡œ ì™„ì„±í•´ì„œ ë„˜ê¸°ëŠ” ê²ƒ
- ì •ì  ì¿¼ë¦¬: ë¯¸ë¦¬ ì •ì˜í•œ ì¿¼ë¦¬ì— ì´ë¦„ì„ ë¶€ì—¬í•´ì„œ í•„ìš”í•  ë•Œ ì‚¬ìš©ê°€ëŠ¥ (Named ì¿¼ë¦¬)

```java
@Entity
@NamedQuery(
        name = "Member.findByUsername",
        query = "select m from Member m where m.username = :username"
)
public class Member { ... }
```
- Named ì¿¼ë¦¬ ì‚¬ìš©
```java
List<Member> resultList = em.createNamedQuery("Member.findByUsername",
        Member.class)
                .setParameter("username", "íšŒì›1")
                .getResultList();
```
- 2ê°œ ì´ìƒì˜ Named ì¿¼ë¦¬
```java
@NamedQueries({
        @NamedQuery(
                name = "Member.findByUsername",
                query = "select m from Member m where m.username = :username"),
        @NamedQuery(
                name = "Member.count",
                query = "select count(m) from Member m")
})
```