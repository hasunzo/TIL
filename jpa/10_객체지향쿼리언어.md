# 10 ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´
- JPAëŠ” ë³µì¡í•œ ê²€ìƒ‰ ì¡°ê±´ì„ ì‚¬ìš©í•´ì„œ ì—”í‹°í‹° ê°ì²´ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ì¿¼ë¦¬ ê¸°ìˆ ì„ ì§€ì›í•¨.
- JPQLì€ ê°€ì¥ ì¤‘ìš”í•œ ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ì´ë‹¤.

## 10.1 ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì†Œê°œ
- em.find() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ì‹ë³„ìë¡œ ì—”í‹°í‹° í•˜ë‚˜ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŒ
    - ì´ë ‡ê²Œ ì¡°íšŒí•œ ì—”í‹°í‹°ì— ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ì„ ì‚¬ìš©í•˜ë©´ -> ì—°ê´€ëœ ì—”í‹°í‹°ë“¤ì„ ì°¾ì„ ìˆ˜ ìˆë‹¤.

- ì‹ë³„ìë¡œ ì¡°íšŒ EntityManager.find()
- ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ a.getB(), getC()

- but, ì´ ê¸°ëŠ¥ë§Œìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•˜ê¸°ëŠ” ì–´ë ¤ì›€
    - ì˜ˆë¥¼ ë“¤ì–´ ë‚˜ì´ê°€ 30ì‚´ì¸ íšŒì›ì„ ëª¨ë‘ ê²€ìƒ‰í•˜ê³  ì‹¶ë‹¤ë©´?
        - ëª¨ë“  íšŒì› ì—”í‹°í‹°ë¥¼ ë©”ëª¨ë¦¬ì— ì˜¬ë ¤ë‘ê³ 
        - ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ 30ì‚´ ì´ìƒì¸ íšŒì›ì„ ê²€ìƒ‰í•˜ëŠ” ê²ƒì€ í˜„ì‹¤ì„± ì—†ìŒ
        - ê²°êµ­ -> ë°ì´í„°ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ìˆìœ¼ë¯€ë¡œ SLQë¡œ í•„ìš”í•œ ë‚´ìš©ì„ ìµœëŒ€í•œ ê±¸ëŸ¬ì„œ ì¡°íšŒí•´ì•¼ í•¨.
    - ORMì„ ì‚¬ìš©í•˜ë©´?
        - ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê°œë°œ.
        - ê²€ìƒ‰ë˜í•œ í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ë°©ë²•ì´ í•„ìš”.

- JPQLì˜ íŠ¹ì§•
    - í…Œì´ë¸”ì´ ì•„ë‹Œ ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ê°ì²´ì§€í–¥ ì¿¼ë¦¬
    - SLQì„ ì¶”ìƒí™”í•´ì„œ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ SQLì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ

- SQL -> ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ë°ì´í„° ì¤‘ì‹¬ì˜ ì¿¼ë¦¬
- JPQL -> ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ê°ì²´ì§€í–¥ ì¿¼ë¦¬
- JPQLì„ ì‚¬ìš©í•˜ë©´ JPAëŠ” ì´ JPQLì„ ë¶„ì„ í•œ ë‹¤ìŒ -> ì ì ˆí•œ SQLì„ ë§Œë“¤ì–´ ì¡°íšŒí•¨.
    - ì¡°íšŒí•œ ê²°ê³¼ë¡œ ì—”í‹°í‹° ê°¤ì²´ë¥¼ ìƒì„±í•´ì„œ ë°˜í™˜.

- JPQL = "ê°ì²´ì§€í–¥ SQL"

#### JPAê°€ ê³µì‹ ì§€ì›í•˜ëŠ” ê¸°ëŠ¥
- JPQL(Java Persistence Query Language)
- Criteria ì¿¼ë¦¬ : JPQLì„ í¸í•˜ê²Œ ì‘ì„±í•˜ë„ë¡ ë„ì™€ì£¼ëŠ” API, ë¹Œë” í´ë˜ìŠ¤ ëª¨ìŒ
- ë„¤ì´í‹°ë¸Œ SLQ : JPAì—ì„œ JPQL ëŒ€ì‹  ì§ì ‘ SQLì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

#### JPQê°€ ê³µì‹ ì§€ì›í•˜ëŠ” ê¸°ëŠ¥ì€ ì•„ë‹ˆì§€ë§Œ ì•Œì•„ë‘˜ ê°€ì¹˜ê°€ ìˆëŠ” ê²ƒë“¤
- QueryDSL : Criteria ì¿¼ë¦¬ì²˜ëŸ¼ JPQLì„ í¸í•˜ê²Œ ì‘ì„±í•˜ë„ë¡ ë„ì™€ì£¼ëŠ” ë¹Œë” í´ë˜ìŠ¤ ëª¨ìŒ. ë¹„í‘œì¤€ ì˜¤í”ˆì†ŒìŠ¤ í”„ë ˆì„ì›Œí¬
- JDBC ì§ì ‘ ì‚¬ìš©, MyBatis ê°™ì€ SQL ë§¤í¼ í”„ë ˆì„ì›Œí¬ ì‚¬ìš©

### 10.1.1 JPQL ì†Œê°œ
- JPQLì€ ì—”í‹°í‹° ê°ì²´ë¥¼ ì¡°íšŒí•˜ëŠ” ê°ì²´ì§€í–¥ ì¿¼ë¦¬.
- ë¬¸ë²•ì€ SQLê³¼ ë¹„ìŠ·í•˜ê³  ANSI í‘œì¤€ SQLì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ìœ ì‚¬í•˜ê²Œ ì§€ì›í•¨.
- JPQLì€ SQLì„ ì¶”ìƒí™”í•´ì„œ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ
- ë°ì´í„°ë² ì´ìŠ¤ ë°©ì–¸ë§Œ ë³€ê²½í•˜ë©´ JPQLì„ ìˆ˜ì •í•˜ì§€ ì•Šì•„ë„ ìì—°ìŠ¤ëŸ½ê²Œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŒ.
### JPQLì€ SQLë³´ë‹¤ ê°„ê²°í•˜ë‹¤!

- íšŒì› ì—”í‹°í‹°ë¥¼ ëŒ€ìƒìœ¼ë¡œ JPQLì„ ì‚¬ìš©í•˜ëŠ” ê°„ë‹¨í•œ ì˜ˆì œ
```java
@Entity(name = "Member")    //name ì†ì„±ì˜ ê¸°ë³¸ê°’ì€ í´ë˜ìŠ¤ ëª…
public class Memebr {
    
    @Column(name = "name")
    private String username;
    //...
}
```
- JPQL ì‚¬ìš©
```java
//ì¿¼ë¦¬ ìƒì„±
String jpql = "select m from Member as m where m.username = 'kim'";
List<Member> resultList = em.createQuery(jpql, Member.class).getResultList();
```
- ì˜ˆì œ ì½”ë“œëŠ” íšŒì›ì´ë¦„ì´ kimì¸ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•¨
- JPQLì—ì„œ MemberëŠ” ì—”í‹°í‹° ì´ë¦„ì´ë‹¤.
- m.usernameì€ í…Œì´ë¸” ì»¬ëŸ¼ëª…ì´ ì•„ë‹Œ, ì—”í‹°í‹° ê°ì²´ì˜ í•„ë“œëª…ì´ë‹¤.
- em.createQuery() ë©”ì†Œë“œì— ì‹¤í–‰í•  JPQLê³¼ ë°˜í™˜í•  ì—”í‹°í‹°ì˜ í´ë˜ìŠ¤ íƒ€ì…ì¸ Member.classë¥¼ ë„˜ê²¨ì£¼ê³ 
  getResultList() ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•˜ë©´ JPAëŠ” JPQLì„ SQLë¡œ ë³€í™˜í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¡°íšŒí•¨.

- ê·¸ë¦¬ê³  ì¡°íšŒí•œ ê²°ê³¼ë¡œ Member ì—”í‹°í‹°ë¥¼ ìƒì„±í•˜ì—¬ ë°˜í™˜í•¨

- ì‹¤í–‰í•œ JPQL
```h2
select m 
from Member as m 
where m.username = 'kim'
```
- ì‹¤ì œ ì‹¤í–‰ëœ SQL
```h2
select
    member.id as id,
    member.age as age,
    member.team_id as team,
    member.name as name
from 
    Member member
where
    member.name='kim'
```

### 10.1.2 Criteria ì¿¼ë¦¬ ì†Œê°œ
- CriteriaëŠ” JPQLì„ ìƒì„±í•˜ëŠ” ë¹Œë” í´ë˜ìŠ¤
- Criteriaì˜ ì¥ì 
    - ë¬¸ìê°€ ì•„ë‹Œ query.select(m).where(...)ì²˜ëŸ¼ í”„ë¡œê·¸ë˜ë° ì½”ë“œë¡œ JPQLì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤ëŠ” ì 

- ë¬¸ìë¡œ ì‘ì„±í•œ JPQLë³´ë‹¤ ì½”ë“œë¡œ ì‘ì„±í•œ Criteriaì˜ ì¥ì 
- ì»´íŒŒì¼ ì‹œì ì— ì˜¤ë¥˜ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆìŒ
- IDEë¥¼ ì‚¬ìš©í•˜ë©´ ì½”ë“œ ìë™ì™„ì„±ì„ ì§€ì›í•¨
- ë™ì  ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê¸° í¸í•¨

- ë°©ê¸ˆ ë³¸ JPQLì„ Criteriaë¡œ ì‘ì„±í•˜ë©´?
```h2
select m from Member as m where m.username = 'kim'
```

- Criteria ì¿¼ë¦¬
```h2
//Criteria ì‚¬ìš© ì¤€ë¹„
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Member> query = cb.createQuery(Member.class);

//ë£¨íŠ¸ í´ë˜ìŠ¤(ì¡°íšŒë¥¼ ì‹œì‘í•  í´ë˜ìŠ¤)
Root<Member> m = query.from(Member.class);

//ì¿¼ë¦¬ ìƒì„±
CriteriaQuery<Member> cq =
    query.select(m).where(cb.equal(m.get("username"), "kim"));
List<Member> resultList = em.createQuery(cq).getResultList();    
```
- ì¿¼ë¦¬ë¥¼ ë¬¸ìê°€ ì•„ë‹Œ ì½”ë“œë¡œ ì‘ì„±í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ.
- ì•„ì‰¬ìš´ ì  -> m.get("username") -> í•„ë“œ ëª…ì„ ë¬¸ìë¡œ ì‘ì„±
    - ì´ ë¶€ë¶„ë„ ë¬¸ìê°€ ì•„ë‹Œ ì½”ë“œë¡œ ì‘ì„±í•˜ê³  ì‹¶ë‹¤ë©´?
        - ë©”íƒ€ ëª¨ë¸ì„ ì‚¬ìš©!

- ë©”íƒ€ ëª¨ë¸ API?
    - ìë°”ê°€ ì œê³µí•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ í”„ë¡œì„¸ì„œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ ì–´ë…¸í…Œì´ì…˜ì„ ë¶„ì„í•´ì„œ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŒ
    - JPAëŠ” ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì„œ Member ì—”í‹°í‹° í´ë˜ìŠ¤ë¡œë¶€í„° Member_ë¼ëŠ” Criteria ì „ìš© í´ë˜ìŠ¤ë¥¼ ìƒì„±
        - ì´ê²ƒì„ ë©”íƒ€ ëª¨ë¸ì´ë¼ í•¨

```java
//ë©”íƒ€ ëª¨ë¸ ì‚¬ìš© ì „ -> ì‚¬ìš© í›„
m.get("username") -> m.get(Member_.username)
```

### 10.1.3 QueryDSL ì†Œê°œ
- QueryDSLë„ Criteriaì²˜ëŸ¼ JPQL ë¹Œë” ì—­í• ì„ í•¨
- QUeryDSLì˜ ì¥ì 
    - ì½”ë“œ ê¸°ë°˜ì´ë©´ì„œ ë‹¨ìˆœí•˜ê³  ì‚¬ìš©í•˜ê¸° ì‰¬ì›€
    - ì‘ì„±í•œ ì½”ë“œë„ JPQLê³¼ ë¹„ìŠ·í•˜ì—¬ í•œëˆˆì— ë“¤ì–´ì˜´

- QueryDSLë¡œ ì‘ì„±í•œ ì½”ë“œ
```java
//ì¤€ë¹„
JPAQuery query = new JPAQuery(em);
QMember member = QMember.member;

//ì¿¼ë¦¬, ê²°ê³¼ì¡°íšŒ
List<Member> members =
    query.from(member)
    .where(member.username.eq("kim"))
    .list(member);
```

- QueryDSLë„ ì–´ë…¸í…Œì´ì…˜ í”„ë¡œì„¸ì„œë¥¼ ì‚¬ìš©í•´ì„œ ì¿¼ë¦¬ ì „ìš© í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼ í•¨
- QMemberëŠ” Member ì—”í‹°í‹° í´ë˜ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±í•œ QueryDSL ì¿¼ë¦¬ ì „ìš© í´ë˜ìŠ¤

### 10.1.4 ë„¤ì´í‹°ë¸Œ SQL ì†Œê°œ
- JPAê°€ ì œê³µí•˜ëŠ” SQLì„ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥
- JPQLì„ ì‚¬ìš©í•´ë„ ê°€ë”ì€ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì˜ì¡´í•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì•¼ í•  ë•Œê°€ ìˆìŒ
    - ì˜ˆ) ì˜¤ë¼í´ ë°ì´í„°ë² ì´ìŠ¤ë§Œ ì‚¬ìš©í•˜ëŠ” CONNECT BY ê¸°ëŠ¥
    - íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì—ì„œë§Œ ë™ì‘í•˜ëŠ” SQL íŒíŠ¸...

- ë„¤ì´í‹°ë¸Œ SQLì˜ ë‹¨ì  -> íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì˜ì¡´í•˜ëŠ” SQLì„ ì‘ì„±í•´ì•¼ í•œë‹¤ëŠ” ê²ƒ.
- ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë³€ê²½í•˜ë©´ ë„¤ì´í‹°ë¸Œ SQLë„ ìˆ˜ì •í•´ì•¼ í•¨
- ë„¤ì´í‹°ë¸Œ SQL

```java
String sql = "SELECT ID, AGE, TEAM_ID, NAME FROM MEMBER WHERE NAME = 'kim'";
List<Member> resultList = 
    em.createNativeQuery(sql, Member.class).getResultList();
```
- ë„¤ì´í‹°ë¸Œ SQLì€ em.createNativeQuery()ë¥¼ ì‚¬ìš©í•˜ë©´ ë¨
- ì‹¤í–‰í•˜ë©´ ì§ì ‘ ì‘ì„±í•œ SQLì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ë‹¬í•¨

## 10.2 JPQL
- JPQLì˜ íŠ¹ì§•
    - JPQLì€ ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ ->
        - í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ X ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒ
    - JPQLì€ SQLì„ ì¶”ìƒí™” -> íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ SQLì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ
    - JPQLì€ ê²°êµ­ SQLë¡œ ë³€í™˜

### 10.2.1 ê¸°ë³¸ ë¬¸ë²•ê³¼ ì¿¼ë¦¬ API
#### SELECT ë¬¸
```java
SELECT m FROM Member AS m where m.username = 'hello'
```
- ëŒ€ì†Œë¬¸ì êµ¬ë¶„
    - ì—”í‹°í‹°ì™€ ì†ì„±ì€ ëŒ€ì†Œë¬¸ì êµ¬ë¶„ O
        - Member, username
    - SELECT, FROM, AS -> JPQL í‚¤ì›Œë“œëŠ” ëŒ€ì†Œë¬¸ì êµ¬ë¶„ X

- ì—”í‹°í‹° ì´ë¦„
    - JPQLì˜ MemberëŠ” í´ë˜ìŠ¤ ëª… X ì—”í‹°í‹° ëª…ì„
    - ì—”í‹°í‹° ëª… ì§€ì • -> @Entity(name="XXX")
    - ë¯¸ì§€ì • ì‹œ -> í´ë˜ìŠ¤ ëª…ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ

- ë³„ì¹­ì€ í•„ìˆ˜
    - Member AS m
        - JPQLì€ ë³„ì¹­ì„ í•„ìˆ˜ë¡œ ì‚¬ìš©
        - AS ìƒëµ ê°€ëŠ¥

```java
SELECT username FROM Member m // ì˜ëª»ëœ í‘œí˜„ m.usernameìœ¼ë¡œ ê³ ì³ì•¼í•¨
```

#### TypeQuery, Query
- ì‘ì„±í•œ JPQLì„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì¿¼ë¦¬ ê°ì²´
- TypeQuery
    - ë°˜í™˜í•  íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ì§€ì •í•  ìˆ˜ ìˆì„ ë•Œ
```java
TypedQuery<Member> query = 
        em.createQuery("SELECT m FROM Member m", Member.class);

List<Member> resultList = query.getResultList();
for(Member member : resultList) {
    System.out.println("Member = "+ member);
}
```
- em.createQuery()ì˜ ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì— ë°˜í™˜í•  íƒ€ì…ì„ ì§€ì •
    - ì¡°íšŒ ëŒ€ìƒì´ Member ì—”í‹°í‹°ì´ë¯€ë¡œ ì¡°íšŒ ëŒ€ìƒ íƒ€ì…ì´ ëª…í™•í•¨


- Query
    - ë°˜í™˜ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ì§€ì •í•  ìˆ˜ ì—†ì„ ë•Œ
```java
Query query = em.createQuery("SELECT m.username, m.age from Member m");
List resultList = query.getResultList();
        
for(Object o : resultList) {
    Object[] result = (Object[]) o; //ê²°ê³¼ê°€ ë‘˜ ì´ìƒì´ë©´ Object[] ë°˜í™˜
    System.out.println("username = " + result[0]);
    System.out.println("age = " + result[1]);
}
```
- ì¡°íšŒ ëŒ€ìƒì´ ëª…í™•í•˜ì§€ ì•ŠìŒ - Query ê°ì²´ ì‚¬ìš©
    - username : String íƒ€ì…
    - age : Integer íƒ€ì…

#### ê²°ê³¼ ì¡°íšŒ
- query.getResultList() : ê²°ê³¼ë¥¼ ì˜ˆì œë¡œ ë°˜í™˜í•¨.
    - ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë¹ˆ ì»¬ë ‰ì…˜ ë°˜í™˜

- query.getSingleResult() : ê²°ê³¼ê°€ ì •í™•íˆ í•˜ë‚˜ì¼ ë•Œ ì‚¬ìš©
    - ê²°ê³¼ê°€ ì—†ìœ¼ë©´ javax.persistence.NoResultException ì˜ˆì™¸ ë°œìƒ
    - ê²°ê³¼ê°€ 1ê°œë³´ë‹¤ ë§ìœ¼ë©´ javax.persistence.NonUniqueResultException ì˜ˆì™¸ ë°œìƒ

- getStringResult()ëŠ” ê²°ê³¼ê°€ ì •í™•íˆ 1ê°œê°€ ì•„ë‹ˆë©´ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤ëŠ” ì ì— ì£¼ì˜
```java
Member member = query.getSingleResult();
```

### 10.2.2 íŒŒë¼ë¯¸í„° ë°”ì¸ë”©
- JDBC : ìœ„ì¹˜ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ë§Œ ì§€ì›
- JPQL : ì´ë¦„ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ë„ ì§€ì›

#### ì´ë¦„ ê¸°ì¤€ íŒŒë¼ë¯¸í„°
- íŒŒë¼ë¯¸í„°ë¥¼ ì´ë¦„ìœ¼ë¡œ êµ¬ë¶„í•˜ëŠ” ë°©ë²•
- ì´ë¦„ ê¸°ì¤€ íŒŒë¼ë¯¸í„°ëŠ” ì•ì— :ë¥¼ ì‚¬ìš©í•¨
```java
String usernameParam = "User1";
        
TypedQuery<Member> query = 
        em.createQuery("SELECT m FROM member m where m.username = :username", Member.class);
        
query.setParameter("username", usernameParam);
List<Member> resultList = query.getResultList();

```
- :usernameì´ë¼ëŠ” ì´ë¦„ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ì •ì˜
- query.setParameter() ì—ì„œ usernameì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ íŒŒë¼ë¯¸í„°ë¥¼ ë°”ì¸ë”©
- ì°¸ê³ ) JPQL APIëŠ” ëŒ€ë¶€ë¶„ ë©”ì†Œë“œ ì²´ì¸ ë°©ì‹ìœ¼ë¡œ ì„¤ê³„ - ì—°ì†í•´ì„œ ì‘ì„±ê°€ëŠ¥
#### ìœ„ì¹˜ ê¸°ì¤€ íŒŒë¼ë¯¸í„°
```java
List<Member> resultList = em.createQuery("SELECT m FROM Member m where m.username = ?1", Member.class)
        .setParameter(1, usernameParam)
        .getResultList();
```
- ìœ„ì¹˜ ê¸°ì¤€ íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ '?' ë‹¤ìŒì— ìœ„ì¹˜ ê°’ì„ ì£¼ë©´ ë¨
    - ìœ„ì¹˜ ê°’ì€ 1ë¶€í„° ì‹œì‘

- ìœ„ì¹˜ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ë°©ì‹ë³´ë‹¤ëŠ” ì´ë¦„ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ë°©ì‹ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ëª…í™•í•¨

### 10.2.3 í”„ë¡œì ì…˜
- SELECT ì ˆì— ì¡°íšŒí•  ëŒ€ìƒì„ ì§€ì •í•˜ëŠ” ê²ƒì„ í”„ë¡œì ì…˜ì´ë¼ í•œë‹¤.
    - (SELECT (í”„ë¡œì ì…˜ ëŒ€ìƒ) FROM)ìœ¼ë¡œ ëŒ€ìƒì„ ì„ íƒ
- í”„ë¡œì ì…˜ ëŒ€ìƒ
    - ì—”í‹°í‹°
    - ì— ë¹„ë””ë“œ íƒ€ì…
    - ìŠ¤ì¹¼ë¼ íƒ€ì… (ìˆ«ì, ë¬¸ì ë“± ê¸°ë³¸ ë°ì´í„° íƒ€ì…)

ğŸ”½ ì—”í‹°í‹° í”„ë¡œì ì…˜
```java
SELECT m FROM Member m          //íšŒì›
SELECT m.team FROM Member m     //íŒ€
```
- ì»¬ëŸ¼ì„ í•˜ë‚˜í•˜ë‚˜ ë‚˜ì—´í•´ì„œ ì¡°íšŒí•´ì•¼ í•˜ëŠ” SQLê³¼ ì°¨ì´ê°€ ìˆìŒ
- ì´ë ‡ê²Œ ì¡°íšŒí•œ ì—”í‹°í‹°ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ë¨


ğŸ”½ ì„ë² ë””ë“œ íƒ€ì… í”„ë¡œì ì…˜
```java
String query = "SELECT a FROM Address a";
```
- ì˜ëª»ëœ ì¿¼ë¦¬
- ì„ë² ë””ë“œ íƒ€ì…ì€ ì¡°íšŒì˜ ì‹œì‘ì ì´ ë  ìˆ˜ ì—†ìŒ
- ìœ„ ì½”ë“œëŠ” Address(Orderì˜ ê°ì²´íƒ€ì…)ë¥¼ ì¡°íšŒì˜ ì‹œì‘ì ìœ¼ë¡œ ì‚¬ìš©í•¨

```java
String query = "SELECT o.address FROM Order o";
List<Address> address = em.createQuery(query, Address.class)
                            .getResultList();
```
- Order ì—”í‹°í‹°ê°€ ì‹œì‘ì .
- ì—”í‹°í‹°ë¥¼ í†µí•´ ì„ë² ë””ë“œ íƒ€ì…ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŒ

ğŸ‘‰ ì‹¤í–‰ëœ SQL
```h2
select
    order.city,
    order.street,
    order.zipcode
from
    Orders order
```
- ì„ë² ë””ë“œ íƒ€ì…ì€ ì—”í‹°í‹° íƒ€ì…ì´ ì•„ë‹Œ ê°’ íƒ€ì….
- ì´ë ‡ê²Œ ì¡°íšŒí•œ ì„ë² ë””ë“œ íƒ€ì…ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ë˜ì§€ ì•ŠëŠ”ë‹¤.

ğŸ”½ ìŠ¤ì¹¼ë¼ íƒ€ì… í”„ë¡œì ì…˜
```java
List<String> username = 
        em.createQuery("SELECT m.username FROM Member m", String.class)
        .getResultList();
```
- ğŸ‘† ì „ì²´ íšŒì›ì˜ ì´ë¦„ ì¡°íšŒ
- ìˆ«ì, ë¬¸ì, ë‚ ì§œì™€ ê°™ì€ ê¸°ë³¸ ë°ì´í„° íƒ€ì…ë“¤ì„ ìŠ¤ì¹¼ë¼ íƒ€ì…ì´ë¼ í•¨

```java
SELECT DISTINCT username FROM Member m
```
- ì¤‘ë³µ ë°ì´í„° ì œê±°ì‹œ DISTINCT ì‚¬ìš©

```java
Double orderAmountAvg =
        em.createQuery("SELECT AVG(o.orderAmount) FROM Order o", Double.class)
        .getSingleResult();
```
- ìœ„ì™€ ê°™ì€ í†µê³„ ì¿¼ë¦¬ë„ ì£¼ë¡œ ìŠ¤ì¹¼ë¼ íƒ€ì…ìœ¼ë¡œ ì¡°íšŒ

ğŸ”½ ì—¬ëŸ¬ ê°’ ì¡°íšŒ
- ê¼­ í•„ìš”í•œ ë°ì´í„°ë“¤ë§Œ ì„ íƒí•´ì„œ ì¡°íšŒí•´ì•¼ í•  ë•Œ ì‚¬ìš©
- í”„ë¡œì ì…˜ì— ì—¬ëŸ¬ ê°’ì„ ì„ íƒí•˜ë©´ TypeQueryë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ê³  Query ì‚¬ìš©

```java
Query query = em.createQuery("SELECT m.username, m.age FROM Member m");
List resultList = query.getResultList();

Iterator iterator = resultList.iterator();
while (iterator.hasNext()) {
    Object[] row = (Object[]) iterator.next();
    String username = (String) row[0];
    Integer age = (Integer) row[1];
}
```
- ì œë„¤ë¦­ì— Object[] ì‚¬ìš© ì‹œ ì½”ë“œ ê°„ê²°í•´ì§
```java
List<Object[]> resultList = 
        em.createQuery("SELECT m.username, m.age FROM Member m")
        .getResultList();

for (Object[] row : resultList){
    String username = (String) row[0];
    Integer age = (Integer) row[1];
}
```
- ì—”í‹°í‹° íƒ€ì…ë„ ì—¬ëŸ¬ ê°’ì„ í•¨ê»˜ ì¡°íšŒí•  ìˆ˜ ìˆìŒ
```java
List<Object[]> resultList = 
        em.createQuery("SELECT o.member, o.product, o.orderAmount From Order o")
        .getResultList();
        
for(Object[] row : resultList) {
    Member member = (Member) row[0];    //ì—”í‹°í‹°
    Product product = (Product) row[1]; //ì—”í‹°í‹°
    int orderAmount = (Integer) row[2]; //ìŠ¤ì¹¼ë¼
}
```
- ë¬¼ë¡  ì´ë•Œë„ ì¡°íšŒí•œ ì—”í‹°í‹°ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬í•¨

ğŸ”½ NEW ëª…ë ¹ì–´
```java
List<Object[]> resultList = em.createQuery("SELECT m.username, m.age FROM Member m").getResultList();
        
//ê°ì²´ ë³€í™˜ ì‘ì—…
List<UserDTO> userDTOs = new ArrayList<UserDTO>();
for (Object[] row : resultList) {
    UserDTO userDTO = new UserDTO((String)row[0], (Integer)row[1]);
    userDTOs.add(userDTO);
}
return userDTOs;
```
```java
public class UserDTO {
    
    private String username;
    private int age;
    
    public UserDTO(String username, int age) {
        this.username = username;
        this.age = age;
    }
    
    //...
}
```
- username, age ë‘ í•„ë“œë¥¼ í”„ë¡œì ì…˜í•´ì„œ íƒ€ì…ì„ ì§€ì •í•  ìˆ˜ ì—†ë‹¤ë©´ TypeQueryë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ.
- ë”°ë¼ì„œ TypeQuery ì‚¬ìš© ë¶ˆê°€
    - Object[] ë°˜í™˜ë°›ìŒ
- ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì‹œ Object[] ì§ì ‘ ì‚¬ìš© X
    - UserDTOì²˜ëŸ¼ ì˜ë¯¸ ìˆëŠ” ê°ì²´ë¡œ ë³€í™˜ í›„ ì‚¬ìš©

- ìœ„ì™€ ê°™ì€ ê°ì²´ ë³€í™˜ ì‘ì—…ì€ ë¶ˆí¸ -> NEW ëª…ë ¹ì–´ ì‚¬ìš©í•˜ê¸°
```java
TypedQuery<UserDTO> query = 
    em.createQuery("SELECT new com.hasun.study.domain.member.UserDTO(m.username, m.age)
    FROM Member m", UserDTO.class);
        
List<UserDTO> resultList = query.getResultList();
```
- SELECT ë‹¤ìŒì— NEW ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ë°˜í™˜ë°›ì„ í´ë˜ìŠ¤ë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤.
    - ì´ í´ë˜ìŠ¤ì˜ ìƒì„±ìì— JPQL ì¡°íšŒ ê²°ê³¼ë¥¼ ë„˜ê²¨ì¤„ ìˆ˜ ìˆìŒ
- NEW ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•œ í´ë˜ìŠ¤ë¡œ TypeQuery ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

â— ì£¼ì˜
1. íŒ¨í‚¤ì§€ ëª…ì„ í¬í•¨í•œ ì „ì²´ í´ë˜ìŠ¤ ëª…ì„ ì…ë ¥
2. ìˆœì„œì™€ íƒ€ì…ì´ ì¼ì¹˜í•˜ëŠ” ìƒì„±ì í•„ìš”

### 10.2.4 í˜ì´ì§• API
- í˜ì´ì§•ì„ ì²˜ë¦¬í•˜ëŠ” SQL ë¬¸ë²•ì´ ë°ì´í„°ë² ì´ìŠ¤ë§ˆë‹¤ ë‹¤ë¥¸ ë¬¸ì œë¥¼ JPQLì„ ì‚¬ìš©í•˜ì—¬ í•´ê²°í•  ìˆ˜ ìˆìŒ
- JPAëŠ” í˜ì´ì§•ì„ ë‹¤ìŒ ë‘ APIë¡œ ì¶”ìƒí™”í–ˆìŒ
    - setFirstReulst(int startPostition): ì¡°íšŒ ì‹œì‘ ìœ„ì¹˜ (0ë¶€í„° ì‹œì‘)
    - setMaxResults(int maxResult): ì¡°íšŒí•  ë°ì´í„° ìˆ˜

```java
TypedQuery<Member> query = 
        em.createQuery("SELECT m FROM Member m ORDER BY m.username DESC", 
        Member.class);
        
query.setFirstResult(10);
query.setMaxResults(20);
query.getResultList();
```
- 10ë²ˆ ë¶€í„° ì‹œì‘í•´ì„œ ì´ 20ê±´ì˜ ë°ì´í„° ì¡°íšŒ
    - 11~30ë²ˆ ë°ì´í„° ì¡°íšŒ

### 10.2.5 ì§‘í•©ê³¼ ì •ë ¬
p367 ~ 369 ì°¸ê³ 

### 10.2.6 JPQL ì¡°ì¸
#### ë‚´ë¶€ ì¡°ì¸
- ë‚´ë¶€ ì¡°ì¸ì€ INNER JOINì„ ì‚¬ìš©í•¨ (INNER ìƒëµê°€ëŠ¥)
```java
String teamName = "íŒ€A";
String query = "SELECT m FROM Member m INNER JOIN m.team t " +
                "WHERE t.name = :teamName";
        
List<Member> members = em.createQuery(query, Member.class)
      .setParameter("teamName", teamName)
      .getResultList();
```
- ìƒì„±ëœ ë‚´ë¶€ ì¡°ì¸ SQL
```h2
SELECT
    M.ID AS ID,
    M.AGE AS AGE,
    M.TEAM_ID AS TEAM_ID,
    M.NAME AS NAME
FROM
    MEMBER M INNER JOIN TEAM T ON M.TEAM_ID=T.ID
WHERE
    T.NAME=?
```
- JPQL ì¡°ì¸ì˜ ê°€ì¥ í° íŠ¹ì§• -> ì—°ê´€ í•„ë“œë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒ
- ìœ„ ì½”ë“œì—ì„œ m.teamì´ ì—°ê´€ í•„ë“œ
    - ì—°ê´€ í•„ë“œëŠ” ë‹¤ë¥¸ ì—”í‹°í‹°ì™€ ì—°ê´€ê´€ê³„ë¥¼ ê°€ì§€ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” í•„ë“œë¥¼ ë§í•¨

- FROM Member m - íšŒì›ì„ ì„ íƒí•˜ê³  m ì´ë¼ëŠ” ë³„ì¹­ì„ ì¤Œ
- Member m JOIN m.team t - íšŒì›ì´ ê°€ì§€ê³  ìˆëŠ” ì—°ê´€ í•„ë“œë¡œ íŒ€ê³¼ ì¡°ì¸í•¨. ì¡°ì¸í•œ íŒ€ì—ëŠ” të¼ëŠ” ë³„ì¹­ì„ ì¤Œ
- ì°¸ê³ ) JPQL ì¡°ì¸ì„ ì•„ë˜ì™€ ê°™ì´ SQL ì¡°ì¸ì²˜ëŸ¼ ì‚¬ìš©í•˜ë©´ ë¬¸ë²• ì˜¤ë¥˜ ë°œìƒ
    - JPQLì€ JOIN ëª…ë ¹ì–´ ë‹¤ìŒì— ì¡°ì¸í•  ê°ì²´ì˜ ì—°ê´€ í•„ë“œë¥¼ ì‚¬ìš©í•¨
```java
FROM Member m JOIN Team t   //ì˜ëª»ëœ JPQL ì¡°ì¸, ì˜¤ë¥˜!
```

- ì¡°ì¸ ê²°ê³¼ í™œìš©
```jpaql
SELECT m.username, t.name
FROM Member m JOIN m.team t
WHERE t.name = 'íŒ€A'
ORDER BY m.age DESC
```
- ì¿¼ë¦¬ëŠ” 'íŒ€A'ì†Œì†ì¸ íšŒì›ì„ ë‚˜ì´ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬ -> íšŒì›ëª…ê³¼ íŒ€ëª…ì„ ì¡°íšŒí•¨
- ë§Œì•½ ì¡°ì¸í•œ ë‘ ê°œì˜ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ë ¤ë©° ë‹¤ìŒê³¼ ê°™ì´ JPQLì„ ì‘ì„±

```jpaql
SELECT m, t
FROM Member m JOIN m.team t
```

- ì„œë¡œ ë‹¤ë¥¸ íƒ€ì…ì˜ ë‘ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí–ˆìœ¼ë¯€ë¡œ TypeQueryë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ
- ë”°ë¼ì„œ ë‹¤ìŒì²˜ëŸ¼ ì¡°íšŒí•´ì•¼ í•¨

```java
String query = "SELECT m, t FROM Member m JOIN m.team t";
List<Object[]> result = em.createQuery(query).getResultList();

for(Object[] row : result) {
    Member member = (Member) row[0];
    Team team = (Team) row[1];
}
```

#### ì™¸ë¶€ ì¡°ì¸
```jpaql
SELECT m
FROM Member m LEFT [OUTER] JOIN m.team t
```
- ì™¸ë¶€ ì¡°ì¸ì€ ê¸°ëŠ¥ìƒ SQLì˜ ì™¸ë¶€ ì¡°ì¸ê³¼ ê°™ìŒ
- OUTERëŠ” ìƒëµ ê°€ëŠ¥í•´ì„œ ë³´í†µ LEFT JOINìœ¼ë¡œ ì‚¬ìš©í•¨

#### ì»¬ë ‰ì…˜ ì¡°ì¸
- ì¼ëŒ€ë‹¤ ê´€ê³„ë‚˜ ë‹¤ëŒ€ë‹¤ ê´€ê³„ì²˜ëŸ¼ ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ê³³ì— ì¡°ì¸í•˜ëŠ” ê²ƒ
- [íšŒì› -> íŒ€]ìœ¼ë¡œì˜ ì¡°ì¸ì€ ë‹¤ëŒ€ì¼ ì¡°ì¸ì´ë©´ì„œ ë‹¨ì¼ ê°’ ì—°ê´€ í•„ë“œ(m.team)ë¥¼ ì‚¬ìš©
- [íŒ€ -> íšŒì›]ì€ ë°˜ëŒ€ë¡œ ì¼ëŒ€ë‹¤ ì¡°ì¸ì´ë©´ì„œ ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ í•„ë“œ(m.members)ë¥¼ ì‚¬ìš©

```jpaql
SELECT t, m FROM Team t LEFT JOIN t.members m
```
- ì—¬ê¸°ì„œ t LEFT JOIN t.membersëŠ” íŒ€ê³¼ íŒ€ì´ ë³´ìœ í•œ íšŒì›ëª©ë¡ì„ ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ í•„ë“œë¡œ ì™¸ë¶€ ì¡°ì¸í–ˆë‹¤.

#### ì„¸íƒ€ ì¡°ì¸
- WHERE ì ˆì„ ì‚¬ìš©í•´ì„œ ì„¸íƒ€ ì¡°ì¸ì„ í•  ìˆ˜ ìˆìŒ
- ì°¸ê³ ë¡œ ì„¸íƒ€ ì¡°ì¸ì€ ë‚´ë¶€ ì¡°ì¸ë§Œ ì§€ì›í•¨.
- ì„¸íƒ€ ì¡°ì¸ì„ ì‚¬ìš©í•˜ë©´ ì „í˜€ ê´€ê³„ì—†ëŠ” ì—”í‹°í‹°ë„ ì¡°ì¸í•  ìˆ˜ ìˆìŒ

```jpaql
//íšŒì› ì´ë¦„ì´ íŒ€ ì´ë¦„ê³¼ ë˜‘ê°™ì€ ì‚¬ëŒ ìˆ˜ë¥¼ êµ¬í•˜ëŠ” ì˜ˆ
//JPQL
select count (m) from Member m, Team t
where m.username = t.name

//SQL
SELECT COUNT(M.ID)
FROM
    MEMBER M CROSS JOIN TEAM T
WHERE
    M.USERNAME=T.NAME    
```

#### JOIN ON ì ˆ(JPA 2.1)
- ON ì ˆì„ ì‚¬ìš©í•˜ë©´ ì¡°ì¸ ëŒ€ìƒì„ í•„í„°ë§í•˜ê³  ì¡°ì¸í•  ìˆ˜ ìˆìŒ
- ì°¸ê³ ë¡œ ë‚´ë¶€ ì¡°ì¸ì˜ ON ì ˆì€ WHERE ì ˆì„ ì‚¬ìš©í•  ë–„ì™€ ê²°ê³¼ê°€ ê°™ìœ¼ë¯€ë¡œ ë³´í†µ ON ì ˆì€ ì™¸ë¶€ ì¡°ì¸ì—ì„œë§Œ ì‚¬ìš©í•¨

```jpaql
//JPQL
select m, t from Member m
left join m.team t on t.name = 'A'

//SQL
SELECT m.*, t.* FROM Member m
LEFT JOIN Team t ON m.TEAM_ID=t.id and t.name='A'
```
- ëª¨ë“  íšŒì›ì„ ì¡°íšŒí•˜ë©´ì„œ íšŒì›ê³¼ ì—°ê´€ëœ íŒ€ë„ ì¡°íšŒ, ì´ë•Œ íŒ€ì€ ì´ë¦„ì´ 'A'ì¸ íŒ€ë§Œ ì¡°íšŒ


### 10.2.7 í˜ì¹˜ ì¡°ì¸
- í˜ì¹˜ ì¡°ì¸ì€ SQLì—ì„œ ì´ì•¼ê¸°í•˜ëŠ” ì¡°ì¸ì˜ ì¢…ë¥˜ X
- JPQLì—ì„œ ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥
- ì—°ê´€ëœ ì—”í‹°í‹°ë‚˜ ì»¬ë ‰ì…˜ì„ í•œ ë²ˆì— ê°™ì´ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥
- join fetch ëª…ë ¹ì–´ë¡œ ì‚¬ìš©
```jpaql
í˜ì¹˜ ì¡°ì¸ ::= [ LEFT [OUTER] | INNER ] JOIN FETCH ì¡°ì¸ê²½ë¡œ
```

#### ì—”í‹°í‹° í˜ì¹˜ ì¡°ì¸
- í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•´ì„œ íšŒì› ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ë©´ì„œ ì—°ê´€ëœ íŒ€ ì—”í‹°í‹°ë„ í•¨ê»˜ ì¡°íšŒí•˜ëŠ” JPQL
```jpaql
select m
from Member m join fetch m.team
```
- ì´ë ‡ê²Œ í•˜ë©´ ì—°ê´€ëœ ì—”í‹°í‹°ë‚˜ ì»¬ë ‰ì…˜ì„ í•¨ê»˜ ì¡°íšŒí•¨
- ì—¬ê¸°ì„  íšŒì›(m)ê³¼ íŒ€(m.team)ì„ í•¨ê»˜ ì¡°íšŒ
- í˜ì¹˜ ì¡°ì¸ì€ ë³„ì¹­ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

- ì‹¤í–‰ëœ SQL
```h2
SELECT
    M.*, T.*
FROM MEMBER T
INNER JOIN TEAM T ON M.TEAM_ID=T.ID
```


![img.png](img/ì—”í‹°í‹°_í˜ì¹˜_ì¡°ì¸ì‹œë„.png)
![img_1.png](img/ì—”í‹°í‹°_í˜ì¹˜_ì¡°ì¸_ê²°ê³¼_í…Œì´ë¸”.png)
![img_2.png](img/ì—”í‹°í‹°_í˜ì¹˜_ì¡°ì¸_ê²°ê³¼_ê°ì²´.png)

- ì—”í‹°í‹° í˜ì¹˜ ì¡°ì¸ JPQLì—ì„œ select mìœ¼ë¡œ íšŒì› ì—”í‹°í‹°ë§Œ ì„ íƒí–ˆëŠ”ë°
  ì‹¤í–‰ëœ SQLì—ì„œëŠ” SELECT M.* T.*ë¡œ íšŒì›ê³¼ ì—°ê´€ëœ íŒ€ë„ í•¨ê»˜ ì¡°íšŒí•¨.

- ê·¸ë¦¼ 10.5 ì—ì„œëŠ” íšŒì›ê³¼ íŒ€ ê°ì²´ê°€ ê°ì²´ ê·¸ë˜í”„ë¥¼ ìœ ì§€í•˜ë©´ì„œ ì¡°íšŒëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ.
```java
String jpql = "select m from Member m join fetch m.team";
        
List<Member> members = em.createQuery(jpql, Member.class).getResultList();
        
for (Member member : members) {
    //í˜ì¹˜ ì¡°ì¸ìœ¼ë¡œ íšŒì›ê³¼ íŒ€ì„ í•¨ê»˜ ì¡°íšŒí•´ì„œ ì§€ì—° ë¡œë”© ë°œìƒ ì•ˆí•¨
    System.out.println("username = "+member.getUsername()+", " +
}
```
- ì¶œë ¥ ê²°ê³¼
```java
username = íšŒì›1, teamname = íŒ€A
username = íšŒì›2, teamname = íŒ€A
username = íšŒì›3, teamname = íŒ€B
```

#### ì»¬ë ‰ì…˜ í˜ì¹˜ ì¡°ì¸
- ì¼ëŒ€ë‹¤ ê´€ê³„ì¸ ì»¬ë ‰ì…˜ì„ í˜ì¹˜ ì¡°ì¸í•´ë³´ì
```jpaql
select t
from Team t join fetch t.members
where t.name = 'íŒ€A'
```
- íŒ€(t)ì„ ì¡°íšŒí•˜ë©´ì„œ í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•´ì„œ ì—°ê´€ëœ íšŒì› ì»¬ë ‰ì…˜(t.members)ë„ í•¨ê»˜ ì¡°íšŒí•¨
```h2
SELECT T.*, M.*
FROM TEAM T 
INNER JOIN MEMBER M ON T.ID=M.TEAM_ID
WHERE T.NAME = 'íŒ€A'
```
![img_3.png](img/ì»¬ë ‰ì…˜_í˜ì¹˜_ì¡°ì¸_ì‹œë„.png)
![img_4.png](img/ì»¬ë ‰ì…˜_í˜ì¹˜_ì¡°ì¸_ê²°ê³¼_í…Œì´ë¸”.png)
![img_5.png](img/ì»¬ë ‰ì…˜_í˜ì¹˜_ì¡°ì¸_ê²°ê³¼_ê°ì²´.png)

- ì»¬ë ‰ì…˜ì„ í˜ì¹˜ ì¡°ì¸í•œ JPQLì—ì„œ select të¡œ íŒ€ë§Œ ì„ íƒí–ˆëŠ”ë° ì˜ˆì œì˜ ì‹¤í–‰ëœ SQLì„ ë³´ë©´
  T.*. M.*ë¡œ íŒ€ê³¼ ì—°ê´€ëœ íšŒì›ë„ í•¨ê»˜ ì¡°íšŒí•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ.

- ë˜ ê·¸ë¦¼ 10.6ì˜ TEAM í…Œì´ë¸”ì—ì„œ 'íŒ€A'ëŠ” í•˜ë‚˜ì§€ë§Œ MEMBERí…Œì´ë¸”ê³¼ ì¡°ì¸í•˜ë©´ì„œ
  ê²°ê³¼ê°€ ì¦ê°€í•˜ì—¬ ê·¸ë¦¼ 10.7ì˜ ì¡°ì¸ ê²°ê³¼ í…Œì´ë¸”ì„ ë³´ë©´ ê°™ì€ 'íŒ€A'ê°€ 2ê±´ ì¡°íšŒë˜ì—ˆìŒ

- ë”°ë¼ì„œ ê·¸ë¦¼ 10.8ì˜ ì»¬ë ‰ì…˜ íŒ¨ì¹˜ ì¡°ì¸ ê²°ê³¼ ê°ì²´ì—ì„œ teams ê²°ê³¼ ì˜ˆì œë¥¼ ë³´ë©´ ì£¼ì†Œê°€ 0x100ìœ¼ë¡œ ê°™ì€ 'íŒ€A'ë¥¼ 2ê±´ ê°€ì§€ê²Œ ë¨
```java
String jpql = "select t from Team t join fetch t.members where t.name = 'íŒ€A'";
List<Team> teams = em.createQuery(jpql, Team.class).getResultList();
        
for (Team team : teams) {

System.out.println("teamname = "+team.getName() + ", team = "+team);
            
    for (Member member : team.getMember()) {
                    
    //í˜ì¹˜ ì¡°ì¸ìœ¼ë¡œ íŒ€ê³¼ íšŒì›ì„ í•¨ê»˜ ì¡°íšŒí•´ì„œ ì§€ì—° ë¡œë”© ë°œìƒ ì•ˆ í•¨
    System.out.println("->username = "+member.getUsername()+", member = "+member);
    }
}
```

- ì¶œë ¥ ê²°ê³¼
```java
teamname = íŒ€A, team = Team@0x100
->username = íšŒì›1, member = Member@0x200
->username = íšŒì›2, member = Member@0x300
teamname = íŒ€A, team = Team@0x100
->username = íšŒì›1, member = Member@0x200
->username = íšŒì›2, member = Member@0x300
```
- ì¶œë ¥ ê²°ê³¼ë¥¼ ë³´ë©´ ê°™ì€ 'íŒ€A'ê°€ 2ê±´ ì¡°íšŒëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

#### í˜ì¹˜ ì¡°ì¸ê³¼ DISTINCT
- DISTINCTëŠ” ì¤‘ë³µëœ ê²°ê³¼ë¥¼ ì œê±°í•˜ëŠ” ëª…ë ¹
- JPQLì˜ DISTINCT ëª…ë ¹ì–´ëŠ” SQLì— DISTINCTë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì€ ë¬¼ë¡ ì´ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ í•œ ë²ˆ ë” ì¤‘ë³µì„ ì œê±°í•¨
```jpaql
select distinct t 
from Team t join fetch t.members
where t.name = 'íŒ€A'
```
- ë¨¼ì € DISTINCTë¥¼ ì‚¬ìš©í•˜ë©´ SQLì— SELECT DISTINCTê°€ ì¶”ê°€ë¨
- í•˜ì§€ë§Œ ì§€ê¸ˆì€ ê° ë¡œìš°ì˜ ë°ì´í„°ê°€ ë‹¤ë¥´ë¯€ë¡œ SQLì˜ DISTINCTëŠ” íš¨ê³¼ê°€ ì—†ìŒ
- ë‹¤ìŒìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ distinct ëª…ë ¹ì–´ë¥¼ ë³´ê³  ì¤‘ë³µëœ ë°ì´í„°ë¥¼ ê±¸ëŸ¬ëƒ„
- select distinct tì˜ ì˜ë¯¸ëŠ” íŒ€ ì—”í‹°í‹°ì˜ ì¤‘ë³µì„ ì œê±°í•˜ë¼ëŠ” ê²ƒ.
- ë”°ë¼ì„œ ì¤‘ë³µì¸ íŒ€AëŠ” í•˜ë‚˜ë§Œ ì¡°íšŒëœë‹¤.

![img_6.png](img/í˜ì¹˜_ì¡°ì¸_DISTINCT_ê²°ê³¼.png)


#### í˜ì¹˜ ì¡°ì¸ì˜ íŠ¹ì§•ê³¼ í•œê³„
- í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•˜ë©´ SQL í•œ ë²ˆìœ¼ë¡œ ì—°ê´€ëœ ì—”í‹°í‹°ë“¤ì„ í•¨ê»˜ ì¡°íšŒí•  ìˆ˜ ìˆì–´ì„œ SQL í˜¸ì¶œ íšŸìˆ˜ë¥¼ ì¤„ì—¬ ì„±ëŠ¥ì„ ìµœì í™”í•  ìˆ˜ ìˆìŒ
- ë‹¤ìŒì²˜ëŸ¼ ì—”í‹°í‹°ì— ì§ì ‘ ì ìš©í•˜ëŠ” ë¡œë”© ì „ëµì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì— ì˜í–¥ì„ ë¯¸ì¹˜ë¯€ë¡œ ê¸€ë¡œë²Œ ë¡œë”© ì „ëµì´ë¼ ë¶€ë¦„
- í˜ì¹˜ ì¡°ì¸ì€ ê¸€ë¡œë²Œ ë¡œë”© ì „ëµë³´ë‹¤ ìš°ì„ í•¨
- ì˜ˆë¥¼ ë“¤ì–´ ê¸€ë¡œë²Œ ë¡œë”© ì „ëµì„ ì§€ì—° ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•´ë„ JPQLì—ì„œ í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•˜ë©´ í˜ì¹˜ ì¡°ì¸ì„ ì ìš©í•´ì„œ í•¨ê»˜ ì¡°íšŒí•¨
```java
@OneToMany(fetch = FetchType.LAZY)  //ê¸€ë¡œë²Œ ë¡œë”© ì „ëµ
```

- ìµœì í™”ë¥¼ ìœ„í•´ ê¸€ë¡œë²Œ ë¡œë”© ì „ëµì„ ì¦‰ì‹œ ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ í•­ìƒ ì¦‰ì‹œ ë¡œë”©ì´ ì¼ì–´ë‚¨.
- ì¼ë¶€ëŠ” ë¹ ë¥¼ ìˆ˜ëŠ” ìˆì§€ë§Œ ì „ì²´ë¡œ ë³´ë©´ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì—”í‹°í‹°ë¥¼ ìì£¼ ë¡œë”©í•˜ë¯€ë¡œ
  ì„±ëŠ¥ì— ì•…ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆìŒ
    - ë”°ë¼ì„œ ê¸€ë¡œë²Œ ë¡œë”© ì „ëµì€ ë  ìˆ˜ ìˆìœ¼ë©´ ì§€ì—° ë¡œë”©ì„ ì‚¬ìš©
    - ìµœì í™”ê°€ í•„ìš”í•˜ë©´ í˜ì¹˜ ì¡°ì¸ì„ ì ìš©í•˜ëŠ” ê²ƒì´ íš¨ê³¼ì 

- ë˜í•œ í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•˜ë©´ ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì¿¼ë¦¬ ì‹œì ì— ì¡°íšŒí•˜ë¯€ë¡œ
  ì§€ì—° ë¡œë”©ì´ ë°œìƒí•˜ì§€ ì•ŠìŒ
    - ë”°ë¼ì„œ ì¤€ì˜ì† ìƒíƒœì—ì„œë„ ê°ì²´ ê·¸ë˜í”„ë¥¼ íƒìƒ‰í•  ìˆ˜ ìˆìŒ

#### í˜ì¹˜ ì¡°ì¸ì˜ í•œê³„
- í˜ì¹˜ ì¡°ì¸ ëŒ€ìƒì—ëŠ” ë³„ì¹­ì„ ì¤„ ìˆ˜ ì—†ë‹¤
- ë‘˜ ì´ìƒì˜ ì»¬ë ‰ì…˜ì„ í˜ì¹˜í•  ìˆ˜ ì—†ë‹¤
- ì»¬ë ‰ì…˜ì„ í˜ì¹˜ ì¡°ì¸í•˜ë©´ í˜ì´ì§• APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤

- ì—¬ëŸ¬ í…Œì´ë¸”ì„ ì¡°ì¸í•´ì„œ ì—”í‹°í‹°ê°€ ê°€ì§„ ëª¨ì–‘ì´ ì•„ë‹Œ ì „í˜€ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ë‚´ì•¼ í•œë‹¤ë©´?
    - ì–µì§€ë¡œ í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•˜ê¸°ë³´ë‹¤ëŠ” ì—¬ëŸ¬ í…Œì´ë¸”ì—ì„œ í•„ìš”í•œ í•„ë“œë“¤ë§Œ ì¡°íšŒí•´ì„œ DTOë¡œ ë°˜í™˜í•˜ëŠ” ê²ƒì´ ë” íš¨ê³¼ì ì„.
  

### 10.2.8 ê²½ë¡œ í‘œí˜„ì‹
- .(ì )ì„ ì°ì–´ ê°ì²´ ê·¸ë˜í”„ë¥¼ íƒìƒ‰í•˜ëŠ” ê²ƒ
```jpaql
select m.username
from Member m
    join m.team t
    join m.orders o
where t.name = 'íŒ€A'    
```
- m.username, m.team, m.orders, t.name ì´ ê²½ë¡œ í‘œí˜„ì‹ì´ë‹¤.

#### ê²½ë¡œ í‘œí˜„ì‹ì˜ ìš©ì–´ ì •ë¦¬
- ìƒíƒœ í•„ë“œ : ê°’ì„ ì €ì¥í•˜ê¸° ìœ„í•œ í•„ë“œ (í•„ë“œ or í”„ë¡œí¼í‹°)
- ì—°ê´€ í•„ë“œ : ì—°ê´€ê´€ê³„ë¥¼ ìœ„í•œ í•„ë“œ, ì„ë² ë””ë“œ íƒ€ì… í¬í•¨ (í•„ë“œ or í”„ë¡œí¼í‹°)
  - ë‹¨ì¼ ê°’ ì—°ê´€ í•„ë“œ : @ManyToOne, @OneToOne, ëŒ€ìƒì´ ì—”í‹°í‹°
  - ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ í•„ë“œ : @OneToMany, @ManyToMany, ëŒ€ìƒì´ ì»¬ë ‰ì…˜
  
#### ê²½ë¡œ í‘œí˜„ì‹ê³¼ íŠ¹ì§•
- JPQLì—ì„œ ê²½ë¡œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ì—¬ ê²½ë¡œ íƒìƒ‰ì„ í•˜ë ¤ë©´ ë‹¤ìŒ 3ê°€ì§€ ê²½ë¡œì— ë”°ë¼
ì–´ë–¤ íŠ¹ì§•ì´ ìˆëŠ”ì§€ ì´í•´í•´ì•¼ í•¨
  - ìƒíƒœ í•„ë“œ ê²½ë¡œ: ê²½ë¡œ íƒìƒ‰ì˜ ë. ë”ëŠ” íƒìƒ‰í•  ìˆ˜ ì—†ìŒ
      - ì˜ˆ) select m.username, m.age from Member m
        - m.username, m.age -> ìƒíƒœ í•„ë“œ ê²½ë¡œ íƒìƒ‰
  - ë‹¨ì¼ ê°’ ì—°ê´€ ê²½ë¡œ: ë¬µì‹œì ìœ¼ë¡œ ë‚´ë¶€ ì¡°ì¸ì´ ì¼ì–´ë‚¨. ë‹¨ì¼ ê°’ ì—°ê´€ ê²½ë¡œëŠ” ê³„ì† íƒìƒ‰ ê°€ëŠ¥
  - ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ ê²½ë¡œ: ë¬µì‹œì ìœ¼ë¡œ ë‚´ë¶€ ì¡°ì¸ì´ ì¼ì–´ë‚¨. ë”ëŠ” íƒìƒ‰í•  ìˆ˜ ì—†ìŒ.
    - ë‹¨ FROM ì ˆì—ì„œ ì¡°ì¸ì„ í†µí•´ ë³„ì¹­ì„ ì–»ìœ¼ë©´ ë³„ì¹­ìœ¼ë¡œ íƒìƒ‰ ê°€ëŠ¥
  
#### ë‹¨ì¼ ê°’ ì—°ê´€ ê²½ë¡œ íƒìƒ‰
- select o.member from Order o
  - JPQLì„ ì‹¤í–‰í•œ ê²°ê³¼ >
```sql
select m.* 
from Orders o
    inner join Member m on o.member_id = m.id
```
- ë¬µì‹œì  ì¡°ì¸
  - ìœ„ì™€ ê°™ì´ ë‹¨ì¼ ê°’ ì—°ê´€ í•„ë“œë¡œ ê²½ë¡œ íƒìƒ‰ì„ í•  ì‹œ SQLì—ì„œ ë‚´ë¶€ ì¡°ì¸ì´ ì¼ì–´ë‚¨
    - ì˜ˆ) select m.team from Member m
- ëª…ì‹œì  ì¡°ì¸
  - JOINì„ ì§ì ‘ ì ì–´ì£¼ëŠ” ê²ƒ
    - ì˜ˆ) select m from Member m Join m.team t
  
```jpaql
select o.member.team
from Order o
where o.product.name = 'productA' and o.address.city = 'JINJU'
```
- ì£¼ë¬¸ ì¤‘ì—ì„œ ìƒí’ˆëª…ì´ 'productA', ë°°ì†¡ì§€ê°€ 'JINJU'ì¸ íšŒì›ì´ ì†Œì†ëœ íŒ€ì„ ì¡°íšŒí•˜ëŠ” ì˜ˆì‹œ

ğŸ”½ ì‹¤í–‰ëœ SQL
```sql
select t.*
from Orders o
inner join Member m on o.member_id = m.id
inner join Team t on o.team_id = t.id
inner join Product p on o.product_id = p.id
where p.name = 'productA' and o.city = 'JINJU'
```  

#### ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ ê²½ë¡œ íƒìƒ‰
```jpaql
select t.members from Team t; //ì„±ê³µ
select t.members.username from Team t; //ì‹¤íŒ¨
```
- ì»¬ë ‰ì…˜ê¹Œì§€ëŠ” ê²½ë¡œ íƒìƒ‰ì´ ê°€ëŠ¥í•˜ë‚˜, ì•„ë˜ ì‹¤íŒ¨ ì½”ë“œ ì²˜ëŸ¼
ì»¬ë ‰ì…˜ì—ì„œ ê²½ë¡œ íƒìƒ‰ì„ ì‹œì‘í•˜ëŠ” ê²ƒì€ í—ˆë½í•˜ì§€ ì•ŠìŒ.
  
- ì»¬ë ‰ì…˜ì—ì„œ ê²½ë¡œ íƒìƒ‰ì´ í•„ìš”í•˜ë‹¤ë©´?
```jpaql
select m.username from Team t join t.members m
```
- ì¡°ì¸ì„ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ ë³„ì¹­ì„ íšë“í•´ì•¼ í•¨

- ì°¸ê³ ) ì»¬ë ‰ì…˜ì€ ì»¬ë ‰ì…˜ì˜ í¬ê¸°ë¥¼ êµ¬í•  ìˆ˜ ìˆëŠ” sizeë¼ëŠ” ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥
  - size -> COUNT í•¨ìˆ˜ SQLë¡œ ë³€í™˜
```jpaql
select t.members.size from Team t
```  

#### ê²½ë¡œ íƒìƒ‰ì„ ì‚¬ìš©í•œ ë¬µì‹œì  ì¡°ì¸ ì‹œ ì£¼ì˜ì‚¬í•­
- í•­ìƒ ë‚´ë¶€ ì¡°ì¸ì„
- ì»¬ë ‰ì…˜ì€ ê²½ë¡œ íƒìƒ‰ì˜ ë. ì»¬ë ‰ì…˜ì—ì„œ ê²½ë¡œ íƒìƒ‰ì„ í•˜ê¸° ìœ„í•´ì„  ëª…ì‹œì ìœ¼ë¡œ ì¡°ì¸í•´ì„œ ë³„ì¹­ì„ ì–»ì–´ì•¼ í•¨
- ê²½ë¡œ íƒìƒ‰ì€ ì£¼ë¡œ SELECT, WHERE ì ˆì—ì„œ ì‚¬ìš©í•˜ì§€ë§Œ ë¬µì‹œì  ì¡°ì¸ìœ¼ë¡œ ì¸í•´ SQLì˜ FROM ì ˆì— ì˜í–¥ì„ ì¤Œ

- ë¬µì‹œì  ì¡°ì¸ì€ ì¡°ì¸ì´ ì¼ì–´ë‚˜ëŠ” ìƒí™©ì„ í•œëˆˆì— íŒŒì•…í•˜ê¸° ì–´ë ¤ì›€
- ì„±ëŠ¥ì´ ì¤‘ìš”í•˜ë©´ ë¶„ì„í•˜ê¸° ì‰½ë„ë¡ ë¬µì‹œì  ì¡°ì¸ë³´ë‹¤ëŠ” ëª…ì‹œì  ì¡°ì¸ì„ ì‚¬ìš©í•˜ì


### 10.2.9 ì„œë¸Œì¿¼ë¦¬
- JPQLì˜ ì„œë¸Œì¿¼ë¦¬ëŠ” WHERE, HAVING ì ˆì—ì„œë§Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•¨
- FROM ì ˆì—ì„œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

ğŸ”½ EXITS
- ë¬¸ë²• ğŸ‘‰ [NOT] EXISTS (subquery)
- ì„œë¸Œì¿¼ë¦¬ì— ê²°ê³¼ê°€ ì¡´ì¬í•˜ë©´ ì°¸. NOTì€ ë°˜ëŒ€
- ì˜ˆ) íŒ€A ì†Œì†ì¸ íšŒì›
```jpaql
select m from Member m
where exists (select t from m.team t where t.name = 'íŒ€A')
```

ğŸ”½ {ALL | ANY | SOME}
- ë¬¸ë²• ğŸ‘‰ {ALL | ANY | SOME} (subquery)
- ë¹„êµ ì—°ì‚°ìì™€ ê°™ì´ ì‚¬ìš© {= | > | >= | < | <= | <>}
  - ALL: ì¡°ê±´ì„ ëª¨ë‘ ë§Œì¡±í•˜ë©´ ì°¸
  - ANY or SOME: ë‘˜ì€ ê°™ì€ ì˜ë¯¸. ì¡°ê±´ì„ í•˜ë‚˜ë¼ë„ ë§Œì¡±í•˜ë©´ ì°¸
- ì˜ˆ) ì „ì²´ ìƒí’ˆ ê°ê°ì˜ ì¬ê³ ë³´ë‹¤ ì£¼ë¬¸ëŸ‰ì´ ë§ì€ ì£¼ë¬¸ë“¤
```jpaql
select o from Order o
where o.orderAmount > ALL (select p.stockAmount from Product p)
```
- ì˜ˆ) ì–´ë–¤ íŒ€ì´ë“  íŒ€ì— ì†Œì†ëœ íšŒì›
```jpaql
select m from Member m
where m.team = ANY (select t from Team t)
```

ğŸ”½ IN
- ë¬¸ë²• ğŸ‘‰ [NOT] IN (subquery)
- ì„œë¸Œì¿¼ë¦¬ì˜ ê²°ê³¼ ì¤‘ í•˜ë‚˜ë¼ë„ ê°™ì€ ê²ƒì´ ìˆìœ¼ë©´ ì°¸.
- ì°¸ê³ ) ì„œë¸Œì¿¼ë¦¬ê°€ ì•„ë‹Œ ê³³ì—ì„œë„ ì‚¬ìš©ë¨
- ì˜ˆ) 20ì„¸ ì´ìƒì„ ë³´ìœ í•œ íŒ€
```jpaql
select t from Team t
where t IN (select t2 From Team t2 JOIN t2.members m2 where m2.age >= 20)
```


### 10.2.10 ì¡°ê±´ì‹
- ì—°ì‚°ì ìš°ì„  ìˆœìœ„
- ë…¼ë¦¬ ì—°ì‚°ê³¼ ë¹„êµì‹
- Between, IN, Like, NULL ë¹„êµ
- ì»¬ë ‰ì…˜ ì‹
- ìŠ¤ì¹¼ë¼ ì‹
- CASE ì‹
p.388 ~ p.396

### 10.2.11 ë‹¤í˜•ì„± ì¿¼ë¦¬
- JPQLë¡œ ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ë©´ ê·¸ ìì‹ ì—”í‹°í‹°ë„ í•¨ê»˜ ì¡°íšŒ
```java
List resultList = em.createQuery("select i from Item i").getResultList();
```
- ë‹¨ì¼ í…Œì´ë¸” ì „ëµ ì‚¬ìš© ì‹œ ì‹¤í–‰ëœ SQL
```sql
SELECT * FROM ITEM
```
- ì¡°ì¸ ì „ëµ ì‚¬ìš© ì‹œ ì‹¤í–‰ëœ SQL
```sql
SELECT
    i.ITEM_ID, i.DTYPE, i.name, i.price, i.stockQuantity,
    b.author, b.isbn,
    a.artist, a.etc,
    m.actor, m.director
FROM
    Item i
left outer join
    Book b on i.ITEM_ID=b.ITEM_ID
left outer join
    Album a on i.ITEM_ID=a.ITEM_ID
left outer join
    MOVIE m on i.ITEM_ID=m.ITEM_ID
```

#### TYPE
- ì—”í‹°í‹°ì˜ ìƒì† êµ¬ì¡°ì—ì„œ ì¡°íšŒ ëŒ€ìƒì„ íŠ¹ì • ìì‹ íƒ€ì…ìœ¼ë¡œ í•œì •í•  ë•Œ ì£¼ë¡œ ì‚¬ìš©
- ì˜ˆ) Item ì¤‘ì— Book, Movie ì¡°íšŒ
```jpaql
//JPQL
select i from Item i
where type(i) IN (Book, Movie)
```
```sql
//SQL
SELECT i FROM Item i
WHERE i.DTYPE in ('B', 'N')
```

#### TREAT(JPA 2.1)
- ìë°”ì˜ íƒ€ì… ìºìŠ¤íŒ…ê³¼ ë¹„ìŠ·
- ìƒì† êµ¬ì¡°ì—ì„œ ë¶€ëª¨ íƒ€ì…ì„ íŠ¹ì • ìì‹ íƒ€ì…ìœ¼ë¡œ ë‹¤ë£° ë•Œ ì‚¬ìš©
- JPA í‘œì¤€ì€ FROM , WHEREì ˆì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ,
í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” SELECT ì ˆì—ì„œë„ TREAT ì‚¬ìš©ê°€ëŠ¥
  
- ì˜ˆ) ë¶€ëª¨ì¸ Item ìì‹ì¸ Book
```jpaql
//JPQL
select i from Item i where treat(i as Book).author = 'kim'
```
```sql
//SQL
select i.* from Item i
where
    i.DTYPE = 'B'
    and i.author = 'kim'
```

### 10.2.12 ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ í˜¸ì¶œ
- ë¬¸ë²• ğŸ‘‰ function_invocation::= FUNCTION(function_name (, function_arg)*)
- ì˜ˆ) select function("group_concat", i.name) from Item i

- í•˜ì´ë²„ë„¤ì´íŠ¸ êµ¬í˜„ì²´ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë°©ì–¸ í´ë˜ìŠ¤ë¥¼ ìƒì†í•´ì„œ êµ¬í˜„í•˜ê³ 
ì‚¬ìš©í•  ë°ì´í„°ë² ì´ìŠ¤ í•¨ìˆ˜ë¥¼ ë¯¸ë¦¬ ë“±ë¡í•´ì•¼ í•¨
  
- p.398 - 399 ì°¸ê³ 

### 10.2.13 ê¸°íƒ€ ì •ë¦¬
- enumì€ = ë¹„êµ ì—°ì‚°ë§Œ ì§€ì›
- ì„ë² ë””ë“œ íƒ€ì…ì€ ë¹„êµ ì§€ì› X

#### EMPTY STRING
- ë°ì´í„°ë² ì´ìŠ¤ì— ë”°ë¼ '' -> NULL í˜¹ì€ ê¸¸ì´ 0ì¸ Empty String

#### NULL ì •ì˜
- ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë°ì´í„°ê°€ í•˜ë‚˜ë„ ì—†ìŒ
- NULLê³¼ì˜ ëª¨ë“  ìˆ˜í•™ì  ê³„ì‚° ê²°ê³¼ëŠ” NULL
- Null == Null -> ì•Œ ìˆ˜ ì—†ëŠ” ê°’
- Null is Null -> ì°¸

### 10.2.14 ì—”í‹°í‹° ì§ì ‘ ì‚¬ìš©
#### ê¸°ë³¸ í‚¤ ê°’
- ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ : ì°¸ì¡° ê°’ìœ¼ë¡œ ì‹ë³„
- í…Œì´ë¸” ë¡œìš° : ê¸°ë³¸ í‚¤ ê°’ìœ¼ë¡œ ì‹ë³„
- JPQLì—ì„œ ì—”í‹°í‹° ê°ì²´ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ë©´ SQLì—ì„œëŠ” í•´ë‹¹ ì—”í‹°í‹°ì˜ ê¸°ë³¸ í‚¤ê°’ì„ ì‚¬ìš©
```sql
select count(m.id) from Member m    //ì—”í‹°í‹°ì˜ ì•„ì´ë””ë¥¼ ì‚¬ìš©
select count(m) from Member m       //ì—”í‹°í‹°ë¥¼ ì§ì ‘ ì‚¬ìš©
```
- ì—”í‹°í‹° ì§ì ‘ ì‚¬ìš© ì‹œ JPQL-> SQL ë³€í™˜ ê³¼ì •ì—ì„œ ì—”í‹°í‹°ì˜ ê¸°ë³¸ í‚¤ë¥¼ ì‚¬ìš©í•¨
- ë”°ë¼ì„œ ì‹¤ì œ ì‹¤í–‰ëœ SQLì€ ë‘˜ ë‹¤ ê°™ìŒ

### 10.2.15 Named ì¿¼ë¦¬: ì •ì  ì¿¼ë¦¬
- ë™ì  ì¿¼ë¦¬: em.createQuery("select ..") -> JPQLì„ ë¬¸ìë¡œ ì™„ì„±í•´ì„œ ë„˜ê¸°ëŠ” ê²ƒ
- ì •ì  ì¿¼ë¦¬: ë¯¸ë¦¬ ì •ì˜í•œ ì¿¼ë¦¬ì— ì´ë¦„ì„ ë¶€ì—¬í•´ì„œ í•„ìš”í•  ë•Œ ì‚¬ìš©ê°€ëŠ¥ (Named ì¿¼ë¦¬)

```java
@Entity
@NamedQuery(
        name = "Member.findByUsername",
        query = "select m from Member m where m.username = :username"
)
public class Member { ... }
```
- Named ì¿¼ë¦¬ ì‚¬ìš©
```java
List<Member> resultList = em.createNamedQuery("Member.findByUsername",
        Member.class)
                .setParameter("username", "íšŒì›1")
                .getResultList();
```
- 2ê°œ ì´ìƒì˜ Named ì¿¼ë¦¬
```java
@NamedQueries({
        @NamedQuery(
                name = "Member.findByUsername",
                query = "select m from Member m where m.username = :username"),
        @NamedQuery(
                name = "Member.count",
                query = "select count(m) from Member m")
})
```

## 10.3 Criteria
- JPQLì„ ìë°” ì½”ë“œë¡œ ì‘ì„±í•˜ë„ë¡ ë„ì™€ì£¼ëŠ” ë¹Œë” í´ë˜ìŠ¤ API
- Criteriaë¥¼ ì‚¬ìš©í•˜ë©´ ë¬¸ìê°€ ì•„ë‹Œ ì½”ë“œë¡œ JPQLì„ ì‘ì„±í•œë‹¤.
  - ë¬¸ë²• ì˜¤ë¥˜ë¥¼ ì»´íŒŒì¼ ë‹¨ê³„ì—ì„œ ì¡ì„ ìˆ˜ ìˆìŒ.
  - ë¬¸ì ê¸°ë°˜ì˜ JPQLë³´ë‹¤ ë™ì  ì¿¼ë¦¬ë¥¼ ì•ˆì „í•˜ê²Œ ìƒì„±í•  ìˆ˜ ìˆìŒ.
  
- Criteriaì˜ ë‹¨ì 
  - ì½”ë“œê°€ ë³µì¡í•˜ê³  ì¥í™©í•´ì„œ ì§ê´€ì ìœ¼ë¡œ ì´í•´ê°€ í˜ë“¤ë‹¤.
  

### 10.3.1 Criteria ê¸°ì´ˆ
```java
//JPQL: select m from Member m

CriteriaBuilder cb = em.getCriteriaBuilder();   //1. Criteria ì¿¼ë¦¬ ë¹Œë”

//2. Criteria ìƒì„±, ë³€í™˜ íƒ€ì… ì§€ì •
CriteriaQuery<Member> cq = cb.createQuery(Member.class);

Root<Member> m = cq.from(Member.class);     //3. FROM ì ˆ
cq.select(m);   //4. SELECT ì ˆ

TypedQuery<Member> query = em.createQuery(cq);
List<Member> members = query.getResultList();
```
- ëª¨ë“  íšŒì› ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ëŠ” JPQLì„ Criteriaë¡œ ì‘ì„±í•œ ì½”ë“œì´ë‹¤.
1. Criteria ì¿¼ë¦¬ë¥¼ ìƒì„±í•˜ë ¤ë©´ ë¨¼ì € Criteria ë¹Œë”(CriteriaBuilder)ë¥¼ ì–»ì–´ì•¼ í•¨
  - Criteria ë¹Œë”ëŠ” EntityManagerë‚˜ EntityManagerFactoryì—ì„œ ì–»ì„ ìˆ˜ ìˆìŒ
2. Criteria ì¿¼ë¦¬ ë¹Œë”ì—ì„œ Criteria ì¿¼ë¦¬ë¥¼ ìƒì„±í•œë‹¤. ì´ë•Œ ë°˜í™˜íƒ€ì…ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.
3. From ì ˆì„ ìƒì„±í•¨
  - ë°˜í™˜ëœ ê°’ mì€ Criteriaì—ì„œ ì‚¬ìš©í•˜ëŠ” íŠ¹ë³„í•œ ë³„ì¹­ì„.
  - mì„ ì¡°íšŒì˜ ì‹œì‘ì ì´ë¼ëŠ” ì˜ë¯¸ë¡œ ì¿¼ë¦¬ ë£¨íŠ¸ë¼ í•œë‹¤.
4. SELECT ì ˆì„ ìƒì„±í•œë‹¤.

ì´ ê³¼ì •ì„ í†µí•´ Criteria ì¿¼ë¦¬ë¥¼ ì™„ì„±í•˜ê³  ë‚˜ë©´ ë‹¤ìŒ ìˆœì„œëŠ” JPQLê³¼ ê°™ìŒ.
em.createQuery(cq)ì— ì™„ì„±ëœ Criteria ì¿¼ë¦¬ë¥¼ ë„£ì–´ì£¼ë©´ ëœë‹¤.

- ê²€ìƒ‰ ì¡°ê±´ê³¼ ì •ë ¬ì„ ì¶”ê°€ í•œ ì˜ˆì œ
```java
CriteriaBuilder cb = em.getCriteriaBuilder();
        
CriteriaQuery<Member> cq = cb.createQuery(Member.class);
Root<Member> m = cq.from(Member.class); //FROM ì ˆ ìƒì„±
        
//1. ê²€ìƒ‰ ì¡°ê±´ ì •ì˜
Predicate usernameEqual = cb.equal(m.get("username"), "íšŒì›1");
        
//2. ì •ë ¬ ì¡°ê±´ ì •ì˜
Order ageDesc = cb.desc(m.get("age"));
        
//3. ì¿¼ë¦¬ ìƒì„±
cq.select(m)
    .where(usernameEqual)   //WHERE ì ˆ ìƒì„±
    .orderBy(ageDesc);      //ORDER BY ì ˆ ìƒì„±
        
List<Member> resultList = em.createQuery(cq).getResultList();
```

1. ê²€ìƒ‰ ì¡°ê±´ì„ ì •ì˜í•œ ë¶€ë¶„ì„ ë³´ë©´ m.get("username")ìœ¼ë¡œ ë˜ì–´ ìˆëŠ”ë° mì€ íšŒì› ì—”í‹°í‹°ì˜ ë³„ì¹­ì„.
  - JPQLì˜ m.usernameê³¼ ê°™ì€ í‘œí˜„.
  - cb.equal(A, B)ëŠ” ì´ë¦„ ê·¸ëŒ€ë¡œ A = B ë¼ëŠ” ëœ».
  - cb.equal(m.get("username"), "íšŒì›1") = (JPQL) m.username = 'íšŒì›1'

2. ì •ë ¬ ì¡°ê±´ì„ ì •ì˜í•˜ëŠ” ì½”ë“œì¸ cb.desc(m.get("age")) = (JPQL) m.age desc
3. ë§Œë“¤ì–´ë‘” ì¡°ê±´ì„ where, orderBy ì— ë„£ì–´ì„œ ì›í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ìƒì„±í•œë‹¤.

- CriteriaëŠ” ê²€ìƒ‰ ì¡°ê±´ë¶€í„° ì •ë ¬ê¹Œì§€ Criteria ë¹Œë”(CriteriaBuilder)ë¥¼ ì‚¬ìš©í•´ì„œ ì½”ë“œë¥¼ ì™„ì„±í•¨

âœ¨ ì¿¼ë¦¬ ë£¨íŠ¸(Query Root)ì™€ ë³„ì¹­
- Root<Member> m = cq.from(Member.class); ì—¬ê¸°ì„œ mì´ ì¿¼ë¦¬ ë£¨íŠ¸ì´ë‹¤.
- ì¿¼ë¦¬ ë£¨íŠ¸ëŠ” ì¡°íšŒì˜ ì‹œì‘ì ì´ë‹¤.
- Criteriaì—ì„œ ì‚¬ìš©ë˜ëŠ” íŠ¹ë³„í•œ ë³„ì¹­ì„. JPQLì˜ ë³„ì¹­ì´ë¼ ìƒê°í•˜ë©´ ëœë‹¤.
- ë³„ì¹­ì€ ì—”í‹°í‹°ì—ë§Œ ë¶€ì—¬í•  ìˆ˜ ìˆë‹¤.

âœ¨ Criteriaì˜ ê²½ë¡œ í‘œí˜„ì‹
- m.get("username") -> (JPQL) m.username
- m.get("team").get("name") -> (JPQL) m.team.name

#### 10ì‚´ì„ ì¡°ê³¼í•˜ëŠ” íšŒì›ì„ ì¡°íšŒí•˜ê³  ë‚˜ì´ ì—­ìˆœìœ¼ë¡œ ì •ë ¬í•˜ëŠ” ì˜ˆì œ
```java
//select m from Member m
//where m.age > 10 order by m.age desc;

Root<Member> m = cq.from(Member.class);

//íƒ€ì… ì •ë³´ í•„ìš”
Predicate ageGt = cb.greaterThan(m.<Integer>get("age"), 10);

cq.select(m);
cq.where(ageGt);
cq.orderBy(cb.desc(m.get("age")));
```

- cb.greaterThan(m.<Integer>get("age"), 10)
  - A > B
  - m.<Integer>get("age") ì™œ ì œë„¤ë¦­ìœ¼ë¡œ íƒ€ì… ì •ë³´ë¥¼ ì£¼ì—ˆì„ê¹Œ?
    - m.get("age")ëŠ” "age"ì˜ íƒ€ì… ì •ë³´ë¥¼ ì•Œì§€ ëª»í•œë‹¤.
    - ë”°ë¼ì„œ ì œë„¤ë¦­ìœ¼ë¡œ ë°˜í™˜ íƒ€ì… ì •ë³´ë¥¼ ëª…ì‹œí•´ì•¼ í•¨
    - (ë³´í†µ String ê°™ì€ ë¬¸ì íƒ€ì…ì€ ì§€ì •í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.)
  - greaterThan() = gt()
  
### 10.3.2 Criteria ì¿¼ë¦¬ ìƒì„±
- Criteriaë¥¼ ìƒì„±í•˜ë ¤ë©´ CriteriaBuilder.createQuery() ë©”ì†Œë“œë¡œ Criteria ì¿¼ë¦¬ë¥¼ ìƒì„±í•œë‹¤.
- Criteria ì¿¼ë¦¬ë¥¼ ìƒì„±í•  ë•Œ íŒŒë¼ë¯¸í„°ë¡œ ì¿¼ë¦¬ ê²°ê³¼ì— ëŒ€í•œ ë°˜í™˜ íƒ€ì…ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.
  - CriteriaQueryë¥¼ ìƒì„±í• ë•Œ Member.classë¥¼ ë°˜í™˜íƒ€ì…ìœ¼ë¡œ ì§€ì •í•˜ë©´
  em.createQuery(cq)ì—ì„œ ë°˜í™˜ íƒ€ì…ì„ ì§€ì •í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.
```java
CriteriaBuilder cb = em.getCriteriaBuilder();

//Memberë¥¼ ë°˜í™˜íƒ€ì…ìœ¼ë¡œ ì§€ì •
CriteriaQuery<Member> cq = cb.createQuery(Member.class);
//...
        
//ìœ„ì—ì„œ Memberë¥¼ íƒ€ì…ìœ¼ë¡œ ì§€ì •í–ˆìœ¼ë¯€ë¡œ ì§€ì •í•˜ì§€ ì•Šì•„ë„ Member íƒ€ì…ì„ ë°˜í™˜
List<Member> resultList = em.createQuery(cq).getResultList();
```    

- ë°˜í™˜ íƒ€ì…ì„ ì§€ì •í•  ìˆ˜ ì—†ê±°ë‚˜ ë°˜í™˜ íƒ€ì…ì´ ë‘˜ ì´ìƒì´ë©´ ì•„ë˜ì™€ ê°™ì´ íƒ€ì…ì„ ì§€ì •í•˜ì§€ ì•Šê³  Objectë¡œ ë°˜í™˜ë°›ìœ¼ë©´ ëœë‹¤.
```java
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Object> cq = cb.createQuery();        //ì¡°íšŒê°’ ë°˜í™˜ íƒ€ì…: Object
//...
List<Object> resultList = em.createQuery(cq).getResultList();
```

- ë°˜í™˜ íƒ€ì…ì´ ë‘˜ ì´ìƒì´ë©´ Object[]ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í¸ë¦¬í•¨.
```java
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Object[]> cq = cb.createQuery(Object[].class);
//...
List<Object[]> resultList = em.createQuery(cq).getResultList();
```

- ë°˜í™˜ íƒ€ì…ì„ íŠœí”Œë¡œ ë°›ê³  ì‹¶ìœ¼ë©´ íŠœí”Œì„ ì‚¬ìš©í•œë‹¤.
```java
CriteriaBuilder cb = em.getCriteriaBuilder();

//ì¡°íšŒê°’ ë°˜í™˜ íƒ€ì…: Turple
CriteriaQuery<Tuple> cq = cb.createTupleQuery();
//...
TypedQuery<Tuple> query = em.createQuery(cq);
```


### 10.3.3 ì¡°íšŒ
```java
public interface CriteriaQuery<T> extends AbstractQuery<T> {

    //í•œ ê±´ ì§€ì •
    CriteriaQuery<T> select(Selection<? extends T> selection);
    
    //ì—¬ëŸ¬ ê±´ ì§€ì •
    CriteriaQuery<T> multiselect(Selection<?>... selections);
    
    //ì—¬ëŸ¬ ê±´ ì§€ì •
    CriteriaQuery<T> multiselect(List<Selection<?>> selectionList);
}
```

#### ì¡°íšŒ ëŒ€ìƒì„ í•œ ê±´, ì—¬ëŸ¬ ê±´ ì§€ì •
selectì— ì¡°íšŒ ëŒ€ìƒì„ í•˜ë‚˜ë§Œ ì§€ì •
```java
cq.select(m) //JPQL select m
```
ì¡°íšŒ ëŒ€ìƒì„ ì—¬ëŸ¬ ê±´ì„ ì§€ì •í•˜ë ¤ë©´ multiselectë¥¼ ì‚¬ìš©
```java
//JPQL: select m.username, m.age
cq.multiselect(m.get("username"), m.get("age"))
```
ì—¬ëŸ¬ ê±´ ì§€ì •ì€ ë‹¤ìŒì²˜ëŸ¼ cb.arrayë¥¼ ì‚¬ìš©í•´ë„ ëœë‹¤.
```java
CriteriaBuilder cb = em.getCriteriaBuilder();
//JPQL: select m.username, m.age
CriteriaQuery<Object[]> cq = cb.createQuery(Object[].class);
Root<Member> m = cq.from(Member.class);
cq.select(cb.array(m.get("username"), m.get("age")));
```

#### DISTINCT
distinctëŠ” select, multiselect ë‹¤ìŒì— distinct(true)ë¥¼ ì‚¬ìš©í•˜ë©´ ë¨
```java
//JPQL: select distinct m.username, m.age
cq.multiselect(m.get("username"), m.get("age")).distinct(true);
```

- ìœ„ ì„¤ëª…ë“¤ì„ ì ìš©ì‹œí‚¨ ì½”ë“œ
```java
//JPQL: select distinct m.username, m.age from Member m
        
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Object[]> cq = cb.createQuery(Object[].class);
Root<Member> m = cq.from(Member.class);
cq.multiselect(m.get("username"), m.get("age")).distinct(true);
//cq.select(cb.array(m.get("username"), m.get("age"))).distinct(true); //ìœ„ ì½”ë“œì™€ ê°™ë‹¤.
        
TypedQuery<Object[]> query = em.createQuery(cq);
List<Object[]> resultList = query.getResultList();
```

#### NEW, construct()
JPQLì—ì„œ select new ìƒì„±ì() êµ¬ë¬¸ì„ Criteriaì—ì„œëŠ” cb.construct(í´ë˜ìŠ¤ íƒ€ì…, ...)ë¡œ ì‚¬ìš©í•¨
```java
<Y> CompoundSelection<Y> construct(Class<Y> resultClass, Selection<?>... selections);
```

construct()ë¥¼ ì‚¬ìš©í•œ ì˜ˆì œ
```java
//JPQL: select new hasun.domain.MemberDTO(m.username, m.age)
//from Member m

CriteriaQuery<MemberDTO> cq = cb.createQuery(MemberDTO.class);
Root<Member> m = cq.from(Member.class);

cq.select(cb.construct(MemberDTO.class, m.get("username"), m.get("age")));

TypedQuery<MemberDTO> query = em.createQuery(cq);
List<MemberDTO> resultList = query.getResultList();
```
- JPQLì—ì„œëŠ” select new hasun.domain.MemberDTO()ì²˜ëŸ¼ íŒ¨í‚¤ì§€ëª…ì„ ë‹¤ ì ìŒ.
- CriteriaëŠ” ì½”ë“œë¥¼ ì§ì ‘ ë‹¤ë£¨ê¸° ë•Œë¬¸ì— MemberDTO.classì²˜ëŸ¼ ê°„ëµí•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

#### íŠœí”Œ
CriteriaëŠ” Mapê³¼ ë¹„ìŠ·í•œ íŠœí”Œì´ë¼ëŠ” íŠ¹ë³„í•œ ë°˜í™˜ ê°ì²´ë¥¼ ì œê³µí•œë‹¤.

```java
//JPQL: select m.username, m.age from Member m

CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Tuple> cq = cb.createTupleQuery();
//CriteriaQuery<Tuple> cq = cb.createQuery(Tuple.class); //ìœ„ì™€ ê°™ë‹¤
        
Root<Member> m = cq.from(Member.class);
cq.multiselect(
        m.get("username").alias("username"),    //íŠœí”Œì—ì„œ ì‚¬ìš©í•  íŠœí”Œ ë³„ì¹­
        m.get("age").alias("age")
);

TypedQuery<Tuple> query = em.createQuery(cq);
List<Tuple> resultList = query.getResultList();
for (Tuple tuple : resultList) {
    //íŠœí”Œ ëª…ì¹­ìœ¼ë¡œ ì¡°íšŒ
    String username = tuple.get("username", String.class);
    Integer age = tuple.get("age", Integer.class);
}
```
íŠœí”Œì„ ì‚¬ìš©í•˜ë ¤ë©´ cb.createTypleQuery() ë˜ëŠ” cb.createQuery(Tuple.class)ë¡œ Criteriaë¥¼ ìƒì„±í•¨
1. íŠœí”Œì€ íŠœí”Œì˜ ê²€ìƒ‰ í‚¤ë¡œ ì‚¬ìš©í•  íŠœí”Œ ì „ìš© ë³„ì¹­ì„ í•„ìˆ˜ë¡œ í• ë‹¹í•´ì•¼ í•œë‹¤.
  - ë³„ì¹­ì€ alias()ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ì„œ ì§€ì •í•  ìˆ˜ ìˆë‹¤.
2. ì„ ì–¸í•´ë‘” íŠœí”Œ ë³„ì¹­ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

- íŠœí”Œì€ ì´ë¦„ ê¸°ë°˜ì´ë¯€ë¡œ ìˆœì„œ ê¸°ë°˜ì˜ Object[]ë³´ë‹¤ ì•ˆì „í•¨
- tuple.getElements() ê°™ì€ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ì„œ í˜„ì¬ íŠœí”Œì˜ ë³„ì¹­ê³¼ ìë°” íƒ€ì…ë„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

ğŸ“Œ ì°¸ê³ ) íŠœí”Œì— ë³„ì¹­ì„ ì¤€ë‹¤ê³  í•´ì„œ ì‹¤ì œ SQLì— ë³„ì¹­ì´ ë‹¬ë¦¬ëŠ” ê²ƒì€ ì•„ë‹˜. íŠœí”Œì€ Mapê³¼ ë¹„ìŠ·í•œ êµ¬ì¡°ì—¬ì„œ ë³„ì¹­ì„ í‚¤ë¡œ ì‚¬ìš©í•¨.

- íŠœí”Œì€ ì—”í‹°í‹°ë„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤. íŠœí”Œì„ ì‚¬ìš©í•  ë•ŒëŠ” ë³„ì¹­ì„ í•„ìˆ˜ë¡œ ì£¼ì–´ì•¼ í•˜ëŠ” ê²ƒì— ì£¼ì˜
```java
CriteriaBuilder cb = em.getCriteriaBuilder();

CriteriaQuery<Tuple> cq = cb.createTupleQuery();
Root<Member> m = cq.from(Member.class);
cq.select(cb.tuple(
        m.alias("m"),   //íšŒì› ì—”í‹°í‹°, ë³„ì¹­ m
        m.get("username").alias("uesrname") //ë‹¨ìˆœ ê°’ ì¡°íšŒ, ë³„ì¹­ username
));

TypedQuery<Tuple> query = em.createQuery(cq);
List<Tuple> resultList = query.getResultList();
for (Tuple tuple : resultList) {
    Member member = tuple.get("m", Member.class);
    String username = tuple.get("username", String.class);
}
```
- cq.select(cb.tuple(...)) = cq.multiselect(...)

### 10.3.4 ì§‘í•©
#### GROUP BY
- íŒ€ ì´ë¦„ë³„ë¡œ ë‚˜ì´ê°€ ê°€ì¥ ë§ì€ ì‚¬ëŒê³¼ ê°€ì¥ ì ì€ ì‚¬ëŒì„ êµ¬í•˜ëŠ” ì˜ˆì œ
```java
/*
    JPQL:
    select m.team.name, max(m.age), min(m.age)
    from Member m
    group by m.team.name
*/        

CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Object[]> cq = cb.createQuery(Object[].class);
Root<Member> m = cq.from(Member.class);

Expression maxAge = cb.max(m.<Integer>get("age"));
Expression minAge = cb.min(m.<Integer>get("age"));

cq.multiselect(m.get("team").get("name"), maxAge, minAge);
cq.groupBy(m.get("team").get("name"));  //GROUP BY
        
TypedQuery<Object[]> query = em.createQuery(cq);
List<Object[]> resultList = query.getResultList();
```
- cq.groupBy(m.get("team").get("name")) = (JPQL) group by m.team.name

#### HAVING
- íŒ€ì— ê°€ì¥ ë‚˜ì´ ì–´ë¦° ì‚¬ëŒì´ 10ì‚´ì„ ì´ˆê³¼í•˜ëŠ” íŒ€ì„ ì¡°íšŒí•œë‹¤ëŠ” ì¡°ê±´ì„ ì¶”ê°€
```java
cq.multiselect(m.get("team").get("name"), maxAge, minAge)
    .groupBy(m.get("team").get("name"))
    .having(cb.gt(minAge, 10));  //HAVING
```
- having(cb.gt(minAge, 10)) = (JPQL) having min(m.age) > 10

### 10.3.5 ì •ë ¬
- ì •ë ¬ ì¡°ê±´ë„ Criteria ë¹Œë”ë¥¼ í†µí•´ ìƒì„±
- cb.desc(...) ë˜ëŠ” cb.asc(...)ë¡œ ìƒì„±
```java
cq.select(m)
    .where(ageGt)
    .orderBy(cb.desc(m.get("age"))); //JPQL: order by m.age desc
```

### 10.3.6 ì¡°ì¸
- ì¡°ì¸ì€ join() ë©”ì†Œë“œì™€ JoinType í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•¨
```java
/*
    JPQL:
    select m, t from Member m
    inner join m.team t
    where t.name = 'íŒ€A'
*/
        
Root<Member> m = cq.from(Member.class);
Join<Member, Team> t = m.join("team", JoinType.INNER);  //ë‚´ë¶€ ì¡°ì¸
        
cq.multiselect(m, t)
    .where(cb.equal(t.get("name"), "íŒ€A"))        

```
- ì¿¼ë¦¬ ë£¨íŠ¸(m)ì—ì„œ ë°”ë¡œ m.join("team") ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ì„œ íšŒì›ê³¼ íŒ€ì„ ì¡°ì¸í–ˆë‹¤.
- ê·¸ë¦¬ê³  ì¡°ì¸í•œ teamì— të¼ëŠ” ë³„ì¹­ì„ ì£¼ì—ˆë‹¤.
- ì—¬ê¸°ì„œëŠ” JoinType.INNERë¥¼ ì„¤ì •í•´ì„œ ë‚´ë¶€ ì¡°ì¸ì„ ì‚¬ìš©í–ˆë‹¤.
- ì°¸ê³ ) ì¡°ì¸ íƒ€ì…ì„ ìƒëµí•˜ë©´ ë‚´ë¶€ ì¡°ì¸ì„ ì‚¬ìš©í•¨.

```java
m.join("team")  //ë‚´ë¶€ì¡°ì¸
m.join("team", JoinType.INNER) //ë‚´ë¶€ ì¡°ì¸
m.join("team", JoinType.LEFT) //ì™¸ë¶€ ì¡°ì¸
```

FETCH JOINì€ ë‹¤ìŒ ê°™ì´ ì‚¬ìš©í•¨
```java
Root<Member> m = cq.from(Member.class);
m.fetch("team", JoinType.LEFT);

cq.select(m);
```
í˜ì¹˜ ì¡°ì¸ì€ fetch(ì¡°ì¸ëŒ€ìƒ, JoinType)ì„ ì‚¬ìš©í•¨. í˜ì¹˜ ì¡°ì¸ ì‹œ ì£¼ì˜ì‚¬í•­ì€ JPQLê³¼ ê°™ë‹¤.

### 10.3.7 ì„œë¸Œ ì¿¼ë¦¬
- ê°„ë‹¨í•œ ì„œë¸Œ ì¿¼ë¦¬
  - ë©”ì¸ ì¿¼ë¦¬ì™€ ì„œë¸Œ ì¿¼ë¦¬ ê°„ì— ê´€ë ¨ì´ ì—†ëŠ” ë‹¨ìˆœí•œ ì„œë¸Œ ì¿¼ë¦¬
  - í‰ê·  ë‚˜ì´ ì´ìƒì˜ íšŒì›ì„ êµ¬í•˜ëŠ” ì„œë¸Œ ì¿¼ë¦¬ ì˜ˆì œ
```java
/*
    JPQL:
    select m. from Member m
    where m.age >=
        (select AVG(m2.age) from Member m2)
*/
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Member> mainQuery = cb.createQuery(Member.class);

//ì„œë¸Œ ì¿¼ë¦¬ ìƒì„±
Subquery<Double> subQuery = mainQuery.subquery(Double.class);
Root<Member> m2 = subQuery.from(Member.class);
subQuery.select(cb.avg(m2.<Integer>get("age")));

//ë©”ì¸ ì¿¼ë¦¬ ìƒì„±
Root<Member> m = mainQuery.from(Member.class);
mainQuery.select(m).where(cb.ge(m.<Integer>get("age"), subQuery));
```  
1. ì„œë¸Œ ì¿¼ë¦¬ ìƒì„± ë¶€ë¶„ì„ ë³´ë©´ ì„œë¸Œ ì¿¼ë¦¬ëŠ” mainQuery.subquery(...)ë¡œ ìƒì„±
2. ë©”ì¸ ì¿¼ë¦¬ ìƒì„± ë¶€ë¶„ì„ ë³´ë©´ where(... subQuery)ì—ì„œ ìƒì„±í•œ ì„œë¸Œ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤.

- ìƒí˜¸ ê´€ë ¨ ì„œë¸Œ ì¿¼ë¦¬
  - ë©”ì¸ ì¿¼ë¦¬ì™€ ì„œë¸Œ ì¿¼ë¦¬ ê°„ì— ì„œë¡œ ê´€ë ¨ì´ ìˆì„ ë•Œ Criteriaë¥¼ ì–´ë–»ê²Œ ì‘ì„±í•˜ëŠ”ì§€ ì•Œì•„ë³´ì.
  - ì„œë¸Œ ì¿¼ë¦¬ì—ì„œ ë©”ì¸ ì¿¼ë¦¬ì˜ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë©”ì¸ ì¿¼ë¦¬ì—ì„œ ì‚¬ìš©í•œ ë³„ì¹­ì„ ì–»ì–´ì•¼ í•¨.
  - ì„œë¸Œ ì¿¼ë¦¬ëŠ” ë©”ì¸ ì¿¼ë¦¬ì˜ Root Joinì„ í†µí•´ ìƒì„±ëœ ë³„ì¹­ì„ ë°›ì•„ ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•¨
  
```java
.where(cb.equal(subM.get("username"), m.get("username")));
```

- íŒ€Aì— ì†Œì†ëœ íšŒì›ì„ ì°¾ëŠ” ì˜ˆì œ
- ì¡°ì¸ìœ¼ë¡œ í•´ê²°í•˜ëŠ” ê²ƒì´ íš¨ìœ¨ì ì´ë‚˜ ìƒí˜¸ ê´€ë ¨ ì„œë¸Œ ì¿¼ë¦¬ì— ì´ˆì ì„ ë§ì¶˜ë‹¤.
```java
/*
    JPQL:
    select m from Member m
    where exists
        (select t from m.team t where t.name='íŒ€A')
*/
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Member> mainQuery = cb.createQuery(Member.class);

//ì„œë¸Œ ì¿¼ë¦¬ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë©”ì¸ ì¿¼ë¦¬ì˜ m
Root<Member> m = mainQuery.from(Member.class);

//ì„œë¸Œ ì¿¼ë¦¬ ìƒì„±
Subquery<Team> subQuery = mainQuery.subquery(Team.class);
Root<Member> subM = subQuery.correlate(m);  //ë©”ì¸ ì¿¼ë¦¬ì˜ ë³„ì¹­ì„ ê°€ì ¸ì˜´
Join<Member, Team> t = subM.join("team");
subQuery.select(t)
        .where(cb.equal(t.get("name"), "íŒ€A"));

//ë©”ì¸ ì¿¼ë¦¬ ìƒì„±
mainQuery.select(m)
    .where(cb.exists(subQuery));

List<Member> resultList = em.createQuery(mainQuery).getResultList();
```
- í•µì‹¬) subQuery.correlate(m)
  - correlate(...) ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ë©”ì¸ ì¿¼ë¦¬ì˜ ë³„ì¹­ì„ ì„œë¸Œ ì¿¼ë¦¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
  
### 10.3.8 IN ì‹
- IN ì‹ì€ Criteria ë¹Œë”ì—ì„œ in(...) ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•¨
```java
/*
    JPQL:
    select m from Member m
    where m.username in ("íšŒì›1", "íšŒì›2)
 */
        
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Member> cq = cb.createQuery(Member.class);
Root<Member> m = cq.from(Member.class);

cq.select(m)
        .where(cb.in(m.get("username"))
            .value("íšŒì›1")
            .value("íšŒì›2"));
```

### 10.3.9 CASE ì‹
- CASE ì‹ì—ëŠ” selectCase() ë©”ì†Œë“œì™€ when(), otherwise() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•¨
```java
/*
    JPQL:
    select m.username,
        case when m.age>=60 then 600
            when m.age<=15 then 500
            else 1000
        end
    from Member m        
 */

Root<Member> m = cq.from(Member.class);

cq.multiselect(
        m.get("username"),
        cb.selectCase()
            .when(cb.ge(m.<Integer>get("age"), 60), 600)
            .when(cb.le(m.<Integer>get("age"), 15), 500)
            .otherwise(1000)
);
```

### 10.3.10 íŒŒë¼ë¯¸í„° ì •ì˜
- JPQLì—ì„œ :PARAM1 ì²˜ëŸ¼ íŒŒë¼ë¯¸í„°ë¥¼ ì •ì˜í•œ ê²ƒ ì²˜ëŸ¼ Criteriaë„ íŒŒë¼ë¯¸í„°ë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŒ
```java
/*
    JPQL:
    select m from Member m
    where m.uesrname = :usernameParam
*/

CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Member> cq = cb.createQuery(Member.class);

Root<Member> m = cq.from(Member.class);

//ì •ì˜
cq.select(m)
        .where(cb.equal(m.get("username"), cb.parameter(String.class,
                "usernameParam")));

List<Member> resultList = em.createQuery(cq)
        .setParameter("usernameParam", "íšŒì›1")   //ë°”ì¸ë”©
        .getResultList();
```
1. cb.parameter(íƒ€ì…, íŒŒë¼ë¯¸í„° ì´ë¦„) ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ì„œ íŒŒë¼ë¯¸í„°ë¥¼ ì •ì˜í–ˆë‹¤.
2. setParameter("usernameParam", "íšŒì›1")ì„ ì‚¬ìš©í•´ì„œ í•´ë‹¹ íŒŒë¼ë¯¸í„°ì— ì‚¬ìš©í•  ê°’ì„ ë°”ì¸ë”©í–ˆë‹¤.

### 10.3.11 ë„¤ì´í‹°ë¸Œ í•¨ìˆ˜ í˜¸ì¶œ
- ë„¤ì´í‹°ë¸Œ SQL í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë ¤ë©´ cb.function(..) ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ë¨.
```java
Root<Member> m = cq.from(Member.class);
Expression<Long> function = cb.function("SUM", Long.class,
        m.get("age"));
cq.select(function);
```
- ì—¬ê¸°ì„œëŠ” ì „ì²´ íšŒì›ì˜ ë‚˜ì´ í•©ì„ êµ¬í•¨ "SUM" ëŒ€ì‹ ì— ì›í•˜ëŠ” ë„¤ì´í‹°ë¸Œ SQLí•¨ìˆ˜ë¥¼ ì…ë ¥í•˜ë©´ ë¨

### 10.3.12 ë™ì  ì¿¼ë¦¬
#### JPQLë¡œ ë™ì  ì¿¼ë¦¬ë¥¼ ë§Œë“¤ë©´?
```java
//ê²€ìƒ‰ ì¡°ê±´
Integer age = 10;
String username = null;
String teamName = "íŒ€A";

//JPQL ë™ì  ì¿¼ë¦¬ ìƒì„±
StringBuilder jpql = new StringBuilder("select m from Member m join m.team t");
List<String> criteria = new ArrayList<String>();

if (age != null) criteria.add(" m.age = :age ");
if (username != null) criteria.add(" m.username = :username ");
if (teamName != null) criteria.add(" t.name = :teamName ");

if (criteria.size() > 0) jpql.append(" where ");

for (int i = 0; i < criteria.size(); i++) {
    if (i > 0) jpql.append(" and ");
    jpql.append(criteria.get(i));
}

TypedQuery<Member> query = em.createQuery(jpql.toString(), Member.class);
if (age != null) query.setParameter("age", age);
if (username != null) query.setParameter("username", username);
if (teamName != null) query.setParameter("teamName", teamName);

List<Member> resultList = query.getResultList();
```
- JPQLë¡œ ë™ì  ì¿¼ë¦¬ë¥¼ êµ¬ì„±í•˜ëŠ” ê²ƒì€ ì•„ìŠ¬ì•„ìŠ¬í•œ ì¤„íƒ€ê¸°
- ìœ„ì™€ ê°™ì´ ë‹¨ìˆœí•œ ë™ì  ì¿¼ë¦¬ ì½”ë“œë¥¼ ê°œë°œí•´ë„ ë¬¸ì ë”í•˜ê¸°ë¡œ ì¸í•´ ì—¬ëŸ¬ë²ˆ ë²„ê·¸ë¥¼ ë§Œë‚  ê²ƒ.
- íŠ¹íˆ ë¬¸ì ì‚¬ì´ì— ê³µë°±ì„ ì…ë ¥í•˜ì§€ ì•Šì•„ì„œ age=:ageanduesrname=:usernameì²˜ëŸ¼
ë˜ëŠ” ê²ƒì€ ë‹¤ë“¤ í•œ ë²ˆì”©ì€ ê²ªëŠ” ë¬¸ì œ. whereì™€ andì˜ ìœ„ì¹˜ë¥¼ êµ¬ì„±í•˜ëŠ” ê²ƒë„ ì‹ ê²½ ì¨ì•¼ë¨
  

#### Criteriaë¡œ ë™ì  ì¿¼ë¦¬ë¥¼ ë§Œë“¤ë©´?
```java
//ê²€ìƒ‰ ì¡°ê±´
Integer age = 10;
String username = null;
String teamName = "íŒ€A";

//Criteria ë™ì  ì¿¼ë¦¬ ìƒì„±
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Member> cq = cb.createQuery(Member.class);

Root<Member> m = cq.from(Member.class);
Join<Member, Team> t = m.join("team");

List<Predicate> criteria = new ArrayList<Predicate>();

if (age != null) criteria.add(cb.equal(m.<Integer>get("age"),
        cb.parameter(Integer.class, "age")));
if (username != null) criteria.add(cb.equal(m.get("username"),
        cb.parameter(String.class, "username")));
if (teamName != null) criteria.add(cb.equal(m.get("name"),
        cb.parameter(String.class, "teamName")));

cq.where(cb.and(criteria.toArray(new Predicate[0])));

TypedQuery<Member> query = em.createQuery(cq);
if (age != null) query.setParameter("age", age);
if (username != null) query.setParameter("username", username);
if (teamName != null) query.setParameter("teamName", teamName);

List<Member> resultList = query.getResultList();
```
- Criteriaë¡œ ë™ì  ì¿¼ë¦¬ë¥¼ êµ¬ì„±í•˜ë©´ ìµœì†Œí•œ ê³µë°±ì´ë‚˜ where, andì˜ ìœ„ì¹˜ë¡œ ì¸í•´ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.
- í•˜ì§€ë§Œ Criteriaì˜ ì¥í™©í•˜ê³  ë³µì¡í•¨ìœ¼ë¡œ ì¸í•´ ì½”ë“œê°€ ì½ê¸° í˜ë“¤ë‹¤ëŠ” ë‹¨ì ì€ ì—¬ì „íˆ ë‚¨ì•„ ìˆë‹¤.

### 10.3.13 í•¨ìˆ˜ ì •ë¦¬
p.424 ~ p.426 ì°¸ê³ 

## 10. 4 QueryDSL
JPA CriteriaëŠ” ë„ˆë¬´ ë³µì¡í•˜ê³  ì–´ë µë‹¤. ì‘ì„±ëœ ì½”ë“œë¥¼ ë³´ë©´ ë³µì¡ì„±ìœ¼ë¡œ ì¸í•´ ì–´ë–¤ jPQLì´ ìƒì„±ë ì§€ íŒŒì•…ì´ ì–´ë ¤ì›€.
QueryDSLëŠ” Criteriaë³´ë‹¤ ì‰½ê³  ê°„ê²°í•˜ë©° ì¿¼ë¦¬ì™€ ëª¨ì–‘ì´ ë¹„ìŠ·í•˜ê²Œ ê°œë°œí•  ìˆ˜ ìˆë‹¤. Query DSLì€ ì¿¼ë¦¬ ì¦‰
ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ëŠ” ë° ê¸°ëŠ¥ì´ íŠ¹í™”ë˜ì–´ ìˆë‹¤.

### 10.4.1 QueryDSL ì„¤ì •
[Spring Boot Data Jpa í”„ë¡œì íŠ¸ì— Querydsl ì ìš©í•˜ê¸°](https://jojoldu.tistory.com/372)

### 10.4.2 ì‹œì‘
- QueryDSLì„ ì‚¬ìš©í•˜ë ¤ë©´ JPAQuery ê°ì²´ë¥¼ ìƒì„±í•´ì•¼ í•˜ëŠ”ë° ì´ë•Œ ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ ìƒì„±ìì— ë„˜ê²¨ì¤€ë‹¤.
- ë‹¤ìŒìœ¼ë¡œ ì‚¬ìš©í•  ì¿¼ë¦¬ íƒ€ì…(Q)ë¥¼ ìƒì„±í•˜ëŠ”ë° ìƒì„±ìì—ëŠ” ë³„ì¹­ì„ ì£¼ë©´ ëœë‹¤. ì´ ë³„ì¹­ì„ JPQlì—ì„œ ë³„ì¹­ìœ¼ë¡œ ìƒìš©í•¨.

```java
public void queryDSL() {
    EntityManager em = emf.createEntityManager();
    
    JPAQuery query = new JPAQuery(em);
    QMember qMember = new Qmember("m"); //ìƒì„±ë˜ëŠ” JPQLì˜ ë³„ì¹­ì´ m
    List<Member> members =
        query.from(qMember)
            .where(qMember.name.eq("íšŒì›1"))
            .orderBy(qMember.name.desc())
            .list(qMember);
}
```
- ì‹¤í–‰ëœ JPQL
```jpaql
select m from Member m
where m.name = ?1
order by m.name desc
```

#### ê¸°ë³¸ Q ìƒì„±
- ì¿¼ë¦¬ íƒ€ì… (Q)ì€ ì‚¬ìš©í•˜ê¸° í¸ë¦¬í•˜ë„ë¡ ê¸°ë³¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë³´ê´€í•˜ê³  ìˆìŒ.
- but, ê°™ì€ ì—”í‹°í‹°ë¥¼ ì¡°ì¸í•˜ê±°ë‚˜ ê°™ì€ ì—”í‹°í‹°ë¥¼ ì„œë¸Œì¿¼ë¦¬ì— ì‚¬ìš©í•˜ë©´ ê°™ì€ ë³„ì¹­ì´ ì‚¬ìš©ë˜ë¯€ë¡œ ì´ë•ŒëŠ” ë³„ì¹­ì„ ì§ì ‘ ì§€ì •í•´ì„œ ì‚¬ìš©í•œë‹¤.

```java
public class QMember extends EntityPachBase<Member> {
    
    public static final QMember member = new QMember("member1");
    ...
}
``` 
- ì¿¼ë¦¬ íƒ€ì…ì€ ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•œë‹¤.
```java
QMember qMember = new QMember("m"); //ì§ì ‘ ì§€ì •
QMember qMember = QMember.member;   //ê¸°ë³¸ ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš©
```
- ì¿¼ë¦¬ íƒ€ì…ì˜ ê¸°ë³¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ import staticì„ í™œìš©í•´ì„œ ì½”ë“œë¥¼ ë” ê°„ê²°í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
```java
import static hasun.study.jpa.domain.QMember.member; //ê¸°ë³¸ ì¸ìŠ¤í„´ìŠ¤

public void basic() {
    
    EntityManager em = emf.createEntityManager();
    
    JPAQuery query = new JPAQuery(em);
    List<Member> members =
        query.from(member)
            .where(member.name.eq("íšŒì›1"))
            .orderBy(member.name.desc())
            .list(member);
}
```

### 10.4.3 ê²€ìƒ‰ ì¡°ê±´ ì¿¼ë¦¬
- QueryDSLì˜ ê¸°ë³¸ ì¿¼ë¦¬ ê¸°ëŠ¥ì„ ë‹¤ìŒ ì˜ˆì œë¥¼ í†µí•´ ì•Œì•„ë³¸ë‹¤.
```java
JPAQuery query = new JPAQuery(em);
QItem item = QItem.item;
List<Item> list = query.from(item)
    .where(item.name.eq("ì¢‹ì€ìƒí’ˆ")).and(item.price.gt(20000))
    .list(item);    //ì¡°íšŒí•  í”„ë¡œì ì…˜ ì§€ì •
```
- ìœ„ ì˜ˆì œë¥¼ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ JPQLì´ ìƒì„±ë˜ê³  ì‹¤í–‰ëœë‹¤.
```java
select item
from Item item
where item.name = ?1 and item.price > ?2
```
- QueryDSLì˜ where ì ˆì—ëŠ” andë‚˜ orì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
- ì—¬ëŸ¬ ê²€ìƒ‰ ì¡°ê±´ì„ ì‚¬ìš©í•´ë„ ë¨.
```java
.where(item.name.eq("ì¢‹ì€ìƒí’ˆ"), item.price.gt(20000))
```
- ì¿¼ë¦¬ íƒ€ì…ì˜ í•„ë“œëŠ” í•„ìš”í•œ ëŒ€ë¶€ë¶„ì˜ ë©”ì†Œë“œë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì œê³µí•¨.
- ëª‡ê°€ì§€ ì˜ˆë¥¼ í†µí•´ ì•Œì•„ë³´ì.
- ë‹¤ìŒì€ where()ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë©”ì†Œë“œ
```java
item.price.between(10000, 20000);  //ê°€ê²©ì´ 10000ì› ~ 20000ì› ìƒí’ˆ
item.name.contains("ìƒí’ˆ1");        //ìƒí’ˆ1ì´ë¼ëŠ” ì´ë¦„ì„ í¬í•¨í•œ ìƒí’ˆ,
                                   //SQLì—ì„œ like '%ìƒí’ˆ1%'ì„ ê²€ìƒ‰
item.name.startsWith("ê³ ê¸‰");       //ì´ë¦„ì´ ê³ ê¸‰ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ìƒí’ˆ,
                                    //SQLì—ì„œ like 'ê³ ê¸‰%' ê²€ìƒ‰
```
- ì½”ë“œë¡œ ì‘ì„±ë˜ì–´ ìˆìœ¼ë¯€ë¡œ IDEê°€ ì œê³µí•˜ëŠ” ì½”ë“œ ìë™ ì™„ì„± ê¸°ëŠ¥ì˜ ë„ì›€ì„ ë°›ìœ¼ë©´ í•„ìš”í•œ ë©”ì†Œë“œë¥¼ ì‰½ê²Œ ì°¾ì„ ìˆ˜ ìˆë‹¤.

### 10.4.4 ê²°ê³¼ ì¡°íšŒ
- ì¿¼ë¦¬ ì‘ì„±ì´ ëë‚˜ê³  ê²°ê³¼ ì¡°íšŒ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¡°íšŒí•œë‹¤.
- ë³´í†µ uniqueResult()ë‚˜ list()ë¥¼ ì‚¬ìš©í•˜ê³  íŒŒë¼ë¯¸í„°ë¡œ í”„ë¡œì ì…˜ ëŒ€ìƒì„ ë„˜ê²¨ì¤€ë‹¤.
- ê²°ê³¼ ì¡°íšŒ APIëŠ” com.mysema,query.Projectableì— ì •ì˜ë˜ì–´ ìˆìŒ
- ëŒ€í‘œì ì¸ ê²°ê³¼ ì¡°íšŒ ë©”ì†Œë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

1. uniqueResult() : ì¡°íšŒ ê²°ê³¼ê°€ í•œ ê±´ì¼ ë•Œ ì‚¬ìš©. ì¡°íšŒ ê²°ê³¼ê°€ ì—†ìœ¼ë©´ nullì„ ë°˜í™˜í•˜ê³  ê²°ê³¼ê°€ í•˜ë‚˜ ì´ìƒì´ë©´ com.mysema.query.NonUniqueResultException ì˜ˆì™¸ê°€ ë°œìƒí•¨.
2. singleReuslt() : uniqueResult()ì™€ ê°™ì§€ë§Œ ê²°ê³¼ê°€ í•˜ë‚˜ ì´ìƒì´ë©´ ì²˜ìŒ ë°ì´í„°ë¥¼ ë°˜í™˜í•œë‹¤.
3. list() : ê²°ê³¼ê°€ í•˜ë‚˜ ì´ìƒì¼ ë•Œ ì‚¬ìš©í•¨. ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë¹ˆ ì»¬ë ‰ì…˜ì„ ë°˜í™˜í•œë‹¤.

### 10.4.5 í˜ì´ì§•ê³¼ ì •ë ¬
```java
QItem item = QItem.item;

query.from(item)
    .where(item.price.gt(20000))
    .orderBy(item.price.desc(), item.stockQuantity.asc())
    .offset(10), limit(20)
    .list(item);
```
- ì •ë ¬ì€ orderByë¥¼ ì‚¬ìš©í•˜ëŠ”ë° ì¿¼ë¦¬ íƒ€ì…(Q)ì´ ì œê³µí•˜ëŠ” asc(), desc()ë¥¼ ì‚¬ìš©í•œë‹¤.
- í˜ì´ì§•ì€ offsetê³¼ limitì„ ì ì ˆíˆ ì¡°í•©í•´ì„œ ì‚¬ìš©í•˜ë©´ ë¨.
- í˜ì´ì§•ì€ ë‹¤ìŒ ì˜ˆì œê³¼ ê°™ì´ restrict() ë©”ì†Œë“œì— com.mysema.query.QueryModifiersë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì‚¬ìš©í•´ë„ ëœë‹¤.

```java
QueryModifiers queryModifiers = new QueryModifiers(20L, 10L); //limit, offset
List<Item> list =
    query.from(item)
    .restrict(queryModifiers)
    .list(item);
```
- ì‹¤ì œ í˜ì´ì§• ì²˜ë¦¬ë¥¼ í•˜ë ¤ë©´ ê²€ìƒ‰ëœ ì „ì²´ ë°ì´í„° ìˆ˜ë¥¼ ì•Œì•„ì•¼ í•œë‹¤. ì´ë•ŒëŠ” list() ëŒ€ì‹  listResults()ë¥¼ ì‚¬ìš©í•œë‹¤.
```java
SearchResults(Item) reuslt =
    query.from(item)
        .where(item.price.gt(10000))
        .offset(10).limit(20)
        .listResults(item);

long total = result.getTotal();     //ê²€ìƒ‰ëœ ì „ì²´ ë°ì´í„° ìˆ˜
long limit = result.getLimit();
long offset = result.getOffset();
List<Item> results = result.getResults();   //ì¡°íšŒëœ ë°ì´í„°
```
- listResult()ë¥¼ ì‚¬ìš©í•˜ë©´ ì „ì²´ ë°ì´í„° ì¡°íšŒë¥¼ ìœ„í•œ count ì¿¼ë¦¬ë¥¼ í•œ ë²ˆ ë” ì‹¤í–‰í•œë‹¤.
- ê·¸ë¦¬ê³  SearchResultsë¥¼ ë°˜í™˜í•˜ëŠ”ë° ì´ ê°ì²´ì—ì„œ ì „ì²´ ë°ì´í„° ìˆ˜ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.


### 10.4.6 ê·¸ë£¹
- ê·¸ë£¹ì€ groupByë¥¼ ì‚¬ìš©í•˜ê³  ê·¸ë£¹í™”ëœ ê²°ê³¼ë¥¼ ì œí•œí•˜ë ¤ë©´ havingì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
```java
query.from(item)
    .groupBy(item.price)
    .having(item.price.gt(1000))
    .list(item);
```

### 10.4.7 ì¡°ì¸
- ì¡°ì¸ì€ innerJoin(join), leftJoin, rightJoin, fullJoinì„ ì‚¬ìš©í•  ìˆ˜ ìˆê³ 
ì¶”ê°€ë¡œ JPQLì˜ onê³¼ ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ fetch ì¡°ì¸ë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- ì¡°ì¸ì˜ ê¸°ë³¸ ë¬¸ë²•ì˜ ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì— ì¡°ì¸ ëŒ€ìƒì„ ì§€ì •í•˜ê³  ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì— ë³„ì¹­ìœ¼ë¡œ ì‚¬ìš©í•  ì¿¼ë¦¬ íƒ€ì…ì„ ì§€ì •í•˜ë©´ ëœë‹¤.
```java
join(ì¡°ì¸ ëŒ€ìƒ, ë³„ì¹­ìœ¼ë¡œ ì‚¬ìš©í•  ì¿¼ë¦¬ íƒ€ì…)
```
- ë‹¤ìŒ ì˜ˆì œëŠ” ê°€ì¥ ê¸°ë³¸ì ì¸ ì¡°ì¸ ë°©ë²•ì´ë‹¤.
```java
QOrder order = QOrder.order;
QMember member = QMember.member;
QOrderItem orderItem = QOrderItem.orderItem;

query.from(order)
    .join(order.member, member)
    .leftJoint(order.orderItems, orderItem)
    .list(order);
```
- ë‹¤ìŒ ì˜ˆì œì—ì„œëŠ” ì¡°ì¸ì— onì„ ì‚¬ìš©í–ˆë‹¤.
```java
query.from(order)
    .leftJoin(order.orderItem, orderItem)
    .on(orderItem.count.gt(2))
    .list(order);
```
- ë‹¤ìŒ ì˜ˆì œëŠ” í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ë‹¤.
```java
query.from(order)
    .innerJoin(order.member, member).fetch()
    .leftJoin(order.orderItems, orderItem).fetch()
    .list(order);
```
- ë‹¤ìŒ ì˜ˆì œëŠ” from ì ˆì— ì—¬ëŸ¬ ì¡°ì¸ì„ ì‚¬ìš©í•˜ëŠ” ì„¸íƒ€ ì¡°ì¸ ë°©ë²•ì´ë‹¤.
```java
QOrder order = QOrder.order;
QMember member = QMember.member;

query.from(order, member)
    .where(order.member.eq(member))
    .list(order);
```

### 10.4.8 ì„œë¸Œ ì¿¼ë¦¬
- ì„œë¸Œ ì¿¼ë¦¬ëŠ” ë‹¤ìŒ ì˜ˆì œì™€ ê°™ì´ com.mysema.query.jpa.JPASubQueryë¥¼ ìƒì„±í•´ì„œ ì‚¬ìš©í•œë‹¤.
- ì„œë¸Œ ì¿¼ë¦¬ì˜ ê²°ê³¼ê°€ í•˜ë‚˜ë©´ unique(), ì—¬ëŸ¬ ê±´ì´ë©´ list()ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
```java
QItem item = QItem.item;
QItem itemSub = new QItem("itemSub");

query.from(item)
    .where(item.price.eq(
            new JPASubQuery().from(itemSub).unique(itemSub.price.max())
        ))
    .list(item);
```
- ë‹¤ìŒ ì˜ˆì œëŠ” ì—¬ëŸ¬ ê±´ì˜ ì„œë¸Œ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ë‹¤.
```java
QItem item = QItem.item;
QItem itemSub = new QItem("itemSub";)

query.from(item)
    .where(item.in(
            new JPASubQuery().from(itemSub)
                .where(item.name.eq(itemSub.name))
                .list(itemSub)
        ))
    .list(item);
```

### 10.4.9 í”„ë¡œì ì…˜ê³¼ ê²°ê³¼ ë°˜í™˜
- select ì ˆì— ì¡°íšŒ ëŒ€ìƒì„ ì§€ì •í•˜ëŠ” ê²ƒì„ í”„ë¡œì ì…˜ì´ë¼ í•œë‹¤.

### í”„ë¡œì ì…˜ ëŒ€ìƒì´ í•˜ë‚˜
- í”„ë¡œì ì…˜ ëŒ€ìƒì´ í•˜ë‚˜ë©´ ë‹¤ìŒ ì˜ˆì œì™€ ê°™ì´ í•´ë‹¹ íƒ€ì…ìœ¼ë¡œ ë°˜í™˜í•œë‹¤.
```java
QItem item = QItem.item;
List<String> result = query.from(item).list(item.name);

for (String name : reuslt) {
    System.out.println("name = "+name);    
}
```

### ì—¬ëŸ¬ ì»¬ëŸ¼ ë°˜í™˜ê³¼ íŠœí”Œ
- í”„ë¡œì ì…˜ ëŒ€ìƒìœ¼ë¡œ ì—¬ëŸ¬ í•„ë“œë¥¼ ì„ íƒí•˜ë©´ QueryDSLì€ ê¸°ë³¸ìœ¼ë¡œ com.mysema.query.Tupleì´ë¼ëŠ” Mapê³¼ ë¹„ìŠ·í•œ ë‚´ë¶€ íƒ€ì…ì„ ì‚¬ìš©í•¨.
- ì¡°íšŒ ê²°ê³¼ëŠ” tuple.get() ë©”ì†Œë“œì— ì¡°íšŒí•œ ì¿¼ë¦¬ íƒ€ì…ì„ ì§€ì •í•˜ë©´ ë¨.
```java
QItem item = QItem.item;

List<Tuple> result = query.from(item).list(item.name, item.price);
//List<Tuple> result = query.from(item).list(new QTuple(item.name, item.price)); ì™€ ê°™ë‹¤.

for (Tuple tuple : result) {
    System.out.println("name = "+tuple.get(item.name));
    System.out.println("price = "+tuple.get(item.price));
}
```

### ë¹ˆ ìƒì„±
- ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ì—”í‹°í‹°ê°€ ì•„ë‹Œ íŠ¹ì • ê°ì²´ë¡œ ë°›ê³  ì‹¶ìœ¼ë©´ ë¹ˆ ìƒì„± ê¸°ëŠ¥ì„ ì‚¬ìš©í•¨.
- QueryDSLì€ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì„ ì œê³µí•œë‹¤.
  - í”„ë¡œí¼í‹° ì ‘ê·¼
  - í•„ë“œ ì§ì ‘ ì ‘ê·¼
  - ìƒì„±ì ì‚¬ìš©
  
- ì›í•˜ëŠ” ë°©ë²•ì„ ì§€ì •í•˜ê¸° ìœ„í•´ com.mysema.query.types.Projectionsë¥¼ ì‚¬ìš©í•˜ë©´ ë¨.

```java
public class ItemDTO {
    
    private String username;
    private int price;
    
    public ItemDTO() {}
  
    public ItemDTO(String username, int price) {
        this.username = username;
        this.price = price;
    }
    
    //Getter, Setter
    public String getUsername() {...}
    public void setUsername(String username) {...}
    public int getPrice() {...}
    public void setPrice(int price) {...}
}
```
#### í”„ë¡œí¼í‹° ì ‘ê·¼(setter)
```java
QItem item = QItem.item;
List<ItemDTO> result = query.from(item).list(
        Projections.bean(ItemDTO.class, item.name.as("usrename"), item.price));
```
- Projections.bean() ë©”ì†Œë“œëŠ” ìˆ˜ì •ìë¥¼ ì‚¬ìš©í•´ì„œ ê°’ì„ ì±„ìš´ë‹¤.
- ì˜ˆì œë¥¼ ë³´ë©´ ì¿¼ë¦¬ ê²°ê³¼ëŠ” nameì¸ë° ItemDTO username í”„ë¡œí¼í‹°ë¥¼ ê°€ì§€ê³  ìˆë‹¤.
- ì´ì²˜ëŸ¼ ì¿¼ë¦¬ ê²°ê³¼ì™€ ë§¤í•‘í•  í”„ë¡œí¼í‹° ì´ë¦„ì´ ë‹¤ë¥´ë©´ asë¥¼ ì‚¬ìš©í•´ì„œ ë³„ì¹­ì„ ì£¼ë©´ ëœë‹¤.

#### í•„ë“œ ì§ì ‘ ì ‘ê·¼
```java
QItem item = QItem.item;
List<ItemDTO> result = query.from(item).list(
        Projections.fields(ItemDTO.class, item.name.as("username"),
            item.price));
```
- Proejctions.fields() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ í•„ë“œì— ì§ì ‘ ì ‘ê·¼í•´ì„œ ê°’ì„ ì±„ì›Œì¤€ë‹¤.
- í•„ë“œë¥¼ privateë¡œ ì„¤ì •í•´ë„ ë™ì‘í•œë‹¤.

#### ìƒì„±ì ì‚¬ìš©
```java
QItem item = QItem.item;
List<ItemDTo> result = query.from(item).list(
        Projections.constructor(ItemDTO.class, item.name, item.price));
```
- Projections.constructor() ë©”ì†Œë“œëŠ” ìƒì„±ìë¥¼ ì‚¬ìš©í•¨.
- ë¬¼ë¡  ì§€ì •í•œ í”„ë¡œì ì…˜ê³¼ íŒŒë¼ë¯¸í„° ìˆœì„œê°€ ê°™ì€ ìƒì„±ìê°€ í•„ìš”í•˜ë‹¤.


### DISTINCT
- distinctëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•œë‹¤.
```java
query.distinct().from(item)...
```

### 10.4.10 ìˆ˜ì •, ì‚­ì œ, ë°°ì¹˜ ì¿¼ë¦¬
- QueryDSLë„ ìˆ˜ì •, ì‚­ì œ ê°™ì€ ë°°ì¹˜ ì¿¼ë¦¬ë¥¼ ì§€ì›í•œë‹¤.
- JPQL ë°°ì¹˜ ì¿¼ë¦¬ì™€ ê°™ì´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¬´ì‹œí•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì§ì ‘ ì¿¼ë¦¬í•œë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì.

```java
QItem item = QItem.item;
JPAUpdateClause updateClause = new JPAUpdateClause(em, item);
long count = updateClause.where(item.name.eq("ì‹œê³¨ê°œë°œìì˜ JPA ì±…"))
    .set(item.price, item.price.add(100))
    .excute();
```
- ìœ„ ì˜ˆì œì™€ ê°™ì´ ìˆ˜ì • ë°°ì¹˜ ì¿¼ë¦¬ëŠ” com.mysema.query.jpa.impl.JPAUpdateClauseë¥¼ ì‚¬ìš©í•¨.
- ìœ„ ì˜ˆì œëŠ” ìƒí’ˆì˜ ê°€ê²©ì„ 100ì› ì¦ê°€ì‹œí‚¤ëŠ” ì˜ˆì œì´ë‹¤.

- ì‚­ì œ ë°°ì¹˜ ì¿¼ë¦¬
```java
QItem item = QItem.item;
JPADeleteClause deleteClause = new JPADeleteClause(em, item);
long count = deleteClause.where(item.name.eq("ì‹œê³¨ê°œë°œìì˜ JPA ì±…"))
    .excute();
```
- ì‚­ì œ ë°°ì¹˜ ì¿¼ë¦¬ëŠ” com.mysema.query.jpa.impl.JPADeleteClauseë¥¼ ì‚¬ìš©í•¨
- ìœ„ ì˜ˆì œëŠ” ì´ë¦„ì´ ê°™ì€ ìƒí’ˆì„ ì‚­ì œí•œë‹¤.

### 10.4.11 ë™ì  ì¿¼ë¦¬
= com.mysema.query.BooleanBuilderë¥¼ ì‚¬ìš©í•˜ë©´ íŠ¹ì • ì¡°ê±´ì— ë”°ë¥¸ ë™ì  ì¿¼ë¦¬ë¥¼ í¸ë¦¬í•˜ê²Œ ìƒì„±í•  ìˆ˜ ìˆìŒ
```java
SearchParam param = new SearchParam();
param.setName("ì‹œê³¨ê°œë°œì");
param.setPrice(10000);

QItem item = QItem.item;

BooleanBuilder builder = new BooleanBuilder();
if (StringUtils.hasText(param.getName())) {
    builder.and(item.name.contains(param.getName()));    
}
if (param.getPrice() != null) {
    builder.and(item.price.gt(param.getPrice()));    
}
List<Item> result = query.from(item)
    .where(builder)
    .list(item);
```
- ìœ„ ì˜ˆì œëŠ” ìƒí’ˆ ì´ë¦„ê³¼ ê°€ê²© ìœ ë¬´ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìƒì„±í•¨.

### 10.4.12 ë©”ì†Œë“œ ìœ„ì„
- ë©”ì†Œë“œ ìœ„ì„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ ì¿¼ë¦¬ íƒ€ì…ì— ê²€ìƒ‰ ì¡°ê±´ì„ ì§ì ‘ ì •ì˜í•  ìˆ˜ ìˆë‹¤.
```java
public class ItemExpression {
    
    @QueryDelegate(Item.class)
    public static BooleanEcpression isExpensive(QItem item, Integer price) {
        return item.price.gt(price);
    }
}
```
- ë©”ì†Œë“œ ìœ„ì„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ ìœ„ ì˜ˆì œì™€ ê°™ì´ ì •ì  (static) ë©”ì†Œë“œë¥¼ ë§Œë“¤ê³ 
@com.mtsema.query.annotations.QueryDelegate ì–´ë…¸í…Œì´ì…˜ì— ì†ì„±ìœ¼ë¡œ ì´ ê¸°ëŠ¥ì„ ì ìš©í•  ì—”í‹°í‹°ë¥¼ ì§€ì •í•œë‹¤.
- ì •ì  ë©”ì†Œë“œì˜ ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì—ëŠ” ëŒ€ìƒ ì—”í‹°í‹°ì˜ ì¿¼ë¦¬ íƒ€ì…(Q)ë¥¼ ì§€ì •í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” í•„ìš”í•œ íŒŒë¼ë¯¸í„°ë¥¼ ì •ì˜í•œë‹¤.

```java
public class QItem extends EntityPathBase<Item> {
    ... 
    public com.mysema.query.types.expr.BooleanExpression
        isExpensive(Integer price) {
        return ItemExpression.isExpensive(this, price);
    }
}
```
- ìœ„ ì˜ˆì œì˜ ìƒì„±ëœ ì¿¼ë¦¬ íƒ€ì…ì„ ë³´ë©´ ê¸°ëŠ¥ì´ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
- ì´ì œ ë©”ì†Œë“œ ìœ„ì„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ë³¸ë‹¤.
```java
query.from(item).where(item.isExpensive(30000)).list(item);
```
- í•„ìš”í•˜ë‹¤ë©´ String, Date ê°™ì€ ìë°” ê¸°ë³¸ ë‚´ì¥ íƒ€ì…ì—ë„ ë©”ì†Œë“œ ìœ„ì„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```java
@QueryDelegate(String.class)
public static BooleanExpression isHelloStart(StringPath stringPath) {
    return stringPath.startWith("Hello");    
}
```

#### 10.4.13 QueryDSL ì •ë¦¬
- JPAë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ìƒê¸°ëŠ” ê³ ë¯¼ ë‘ê°€ì§€
  - ë¬¸ìê°€ ì•„ë‹Œ ì½”ë“œë¡œ ì•ˆì „í•˜ê²Œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê³  ì‹¶ë‹¤.
  - ë³µì¡í•œ ë™ì  ì¿¼ë¦¬ë¥¼ ì–´ë–»ê²Œ í•´ê²°í•´ì•¼ í•˜ëŠ”ê°€?
  
- JPA Criteriaê°€ í•´ê²°í•´ ì£¼ê¸°ëŠ” í–ˆì§€ë§Œ, CriteriaëŠ” ë§‰ìƒ ì‚¬ìš©í•´ë³´ë©´ ë„ˆë¬´ ë³µì¡í•´ì„œ
ì˜¤íˆë ¤ JPQLì„ ì§ì ‘ ì‚¬ìš©í•˜ê³  ì‹¶ì–´ì§.
- ë°˜ë©´, QueryDSLì€ ë‘ ê°€ì§€ë¥¼ ëª¨ë‘ ë§Œì¡±í•˜ë©´ì„œ, ì‰½ê³  ë‹¨ìˆœí•˜ë‹¤.

